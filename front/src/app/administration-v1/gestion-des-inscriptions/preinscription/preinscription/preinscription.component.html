<div class="card">
    <div class="col-12 card" *ngIf="showEmail">
        <div style="width: 100%;text-align: right;">
            <i class="pi pi-times-circle" style=" color: red; cursor: pointer;" (click)="showEmail = null"
                aria-hidden="true"> </i>
        </div>

        <p-tabView>
            <p-tabPanel header="Email personnalisé">
                <form class="p-fluid p-formgrid grid col-12" [formGroup]="formEmailPerso">
                    <div class="field col-6">
                        <label>Objet: </label>
                        <input type="text" formControlName="objet" pInputText>
                    </div>
                    <div class="field col-6">
                        <label>Email du destinataire: </label>
                        <p>{{prospectSendTo.user_id.email_perso}}</p>
                    </div>
                    <div class="field col-12">
                        <p-editor formControlName="body" [style]="{'height':'320px'}"></p-editor>
                    </div>
                    <div class="field col-6">
                        <label>Email de l'envoyeur: </label>
                        <p-dropdown placeholder="Choisissez une adresse mail" filter="true" formControlName="send_from"
                            [options]="mailDropdown" autoWidth="false" [style]="{'width':'100%'}">
                        </p-dropdown>
                    </div>
                    <div class="field col-6">
                        <label>Email(s)en cc: </label>
                        <p-chips formControlName="cc" separator=","
                            placeholder="email1@email.com , email2.email.com"></p-chips>
                    </div>
                    <div class="field col-12">
                        <input type="file" (change)="FileUploadPJ($event.target.files)" id="selectedFilePJ"
                            #selectedFilePJ style="display: none;" pInputFile />
                        <p-table styleClass="p-datatable-gridlines" [value]="piece_jointes" responsiveLayout="scroll"
                            dataKey="_id" class="col-12" responsiveLayout="scroll">
                            <ng-template pTemplate="header" let-columns>
                                <tr>
                                    <th>
                                        Date d'upload
                                    </th>
                                    <th>
                                        Nom du document
                                    </th>
                                    <th>
                                        Lien de téléchargement
                                    </th>
                                    <th>
                                        Action
                                    </th>
                                </tr>
                            </ng-template>
                            <ng-template pTemplate="body" let-rowData let-editing="editing" let-ri="rowIndex">
                                <tr>
                                    <td>
                                        {{rowData.date | date:'dd MMMM yy'}}
                                    </td>
                                    <td *ngIf="rowData.nom && rowData.nom!='Téléverser le fichier s\'il vous plaît'">
                                        {{rowData.nom}}
                                    </td>
                                    <td
                                        *ngIf="(!rowData.nom || rowData.nom=='Téléverser le fichier s\'il vous plaît') && rowData.path">
                                        {{rowData?.path}}
                                    </td>
                                    <td
                                        *ngIf="(!rowData.nom || rowData.nom=='Téléverser le fichier s\'il vous plaît') && !rowData.path">
                                        Téléverser le fichier s'il vous plaît
                                    </td>
                                    <td *ngIf="rowData.path">
                                        <a style="cursor: pointer;" (click)="downloadPJFile(rowData)">Télécharger</a>
                                        {{rowData.path}}
                                    </td>
                                    <td *ngIf="!rowData.path">
                                        <a style="cursor: pointer;" (click)="onUploadPJ(rowData)">Upload</a>
                                    </td>
                                    <td>
                                        <i pTooltip="Uploader un fichier" tooltipPosition="bottom"
                                            class="pi pi-cloud-upload mr-2" style="cursor: pointer;"
                                            (click)="onUploadPJ(rowData)">
                                        </i>
                                        <i pTooltip="Supprimer un fichier" tooltipPosition="bottom"
                                            class="pi pi-trash mr-2" style="cursor: pointer;" (click)="onDeletePJ(ri)">
                                        </i>
                                    </td>
                                </tr>
                            </ng-template>
                        </p-table>
                        <div class="mt-2 col-12">
                            <button pButton (click)="onAddPj()" icon="pi pi-paperclip"
                                pTooltip="Ajouter une pièce jointe" tooltipPosition="bottom" autoWidth="false"></button>
                        </div>
                    </div>
                    <button pButton [disabled]="formEmailPerso.invalid" pTooltip="Envoyer l'email"
                        tooltipPosition="bottom" (click)="onEmailPerso()" icon="pi pi-send"></button>
                </form>
            </p-tabPanel>
            <p-tabPanel header="Depuis un mail type">
                <form class="p-fluid p-formgrid grid col-12" [formGroup]="formEmailType">
                    <div class="field col-12">
                        <label>Email Type: </label>
                        <p-dropdown placeholder="Choisissez un mail type" filter="true"
                            (onChange)="onMailType($event.value)" [options]="mailTypeDropdown" autoWidth="false"
                            [style]="{'width':'100%'}">
                        </p-dropdown>
                    </div>
                    <div class="field col-6">
                        <label>Objet: </label>
                        <input type="text" formControlName="objet" pInputText>
                    </div>
                    <div class="field col-6">
                        <label>Email du destinataire: </label>
                        <p>{{prospectSendTo.user_id.email_perso}}</p>
                    </div>
                    <div class="field col-12">
                        <p-editor formControlName="body" [style]="{'height':'320px'}"></p-editor>
                    </div>
                    <div class="field col-6">
                        <label>Email de l'envoyeur: </label>
                        <p-dropdown placeholder="Choisissez une adresse mail" filter="true" formControlName="send_from"
                            [options]="mailDropdown" autoWidth="false" [style]="{'width':'100%'}">
                        </p-dropdown>
                    </div>
                    <div class="field col-6">
                        <label>Email(s) en cc: (Écrivez un , après chaque email)</label>
                        <p-chips formControlName="cc" separator=","
                            placeholder="email1@email.com,email2.email.com"></p-chips>
                    </div>
                    <div class="field col-12">
                        <input type="file" (change)="FileUploadPJ($event.target.files)" id="selectedFilePJ"
                            #selectedFilePJ style="display: none;" pInputFile />
                        <p-table styleClass="p-datatable-gridlines" [value]="piece_jointes" responsiveLayout="scroll"
                            dataKey="_id" class="col-12" responsiveLayout="scroll">
                            <ng-template pTemplate="header" let-columns>
                                <tr>
                                    <th>
                                        Date d'upload
                                    </th>
                                    <th>
                                        Nom du document
                                    </th>
                                    <th>
                                        Lien de téléchargement
                                    </th>
                                    <th>
                                        Action
                                    </th>
                                </tr>
                            </ng-template>
                            <ng-template pTemplate="body" let-rowData let-editing="editing" let-ri="rowIndex">
                                <tr>
                                    <td>
                                        {{rowData.date | date:'dd MMMM yy'}}
                                    </td>
                                    <td *ngIf="rowData.nom && rowData.nom!='Téléverser le fichier s\'il vous plaît'">
                                        {{rowData.nom}}
                                    </td>
                                    <td
                                        *ngIf="(!rowData.nom || rowData.nom=='Téléverser le fichier s\'il vous plaît') && rowData.path">
                                        {{rowData?.path}}
                                    </td>
                                    <td
                                        *ngIf="(!rowData.nom || rowData.nom=='Téléverser le fichier s\'il vous plaît') && !rowData.path">
                                        Téléverser le fichier s'il vous plaît
                                    </td>
                                    <td *ngIf="rowData.path">
                                        <a style="cursor: pointer;" (click)="downloadPJFile(rowData)">Télécharger</a>
                                        {{rowData.path}}
                                    </td>
                                    <td *ngIf="!rowData.path">
                                        <a style="cursor: pointer;" (click)="onUploadPJ(rowData)">Upload</a>
                                    </td>
                                    <td>
                                        <i pTooltip="Uploader un fichier" tooltipPosition="bottom"
                                            class="pi pi-cloud-upload mr-2" style="cursor: pointer;"
                                            (click)="onUploadPJ(rowData)">
                                        </i>
                                        <i pTooltip="Supprimer un fichier" tooltipPosition="bottom"
                                            class="pi pi-trash mr-2" style="cursor: pointer;" (click)="onDeletePJ(ri)">
                                        </i>
                                    </td>
                                </tr>
                            </ng-template>
                        </p-table>
                        <div class="mt-2 col-12">
                            <button pButton (click)="onAddPj()" icon="pi pi-paperclip"
                                pTooltip="Ajouter une pièce jointe" tooltipPosition="bottom" autoWidth="false"></button>
                        </div>
                    </div>
                    <button pButton [disabled]="formEmailType.invalid" icon="pi pi-send" pTooltip="Envoyer l'email"
                        tooltipPosition="bottom" (click)="onEmailType()"></button>
                </form>
            </p-tabPanel>
            <p-tabPanel header="Historique des emails">
                <p-table #dt1 dataKey="_id" [rows]="8" [rowHover]="true" [paginator]="true" [value]="historiqueEmails"
                    [paginator]="true" [pageLinks]="5" selectionMode="single" class="col-12" responsiveLayout="scroll"
                    styleClass="p-datatable-gridlines">
                    <ng-template pTemplate="header">
                        <tr>
                            <th style="width: 3rem" scope="col"></th>
                            <th pSortableColumn="date_creation" scope="col" style="text-align: center;">
                                Date de l'envoie <p-sortIcon field="date_creation"></p-sortIcon>
                            </th>
                            <th pSortableColumn="objet" scope="col" style="text-align: center;">
                                Objet du mail <p-sortIcon field="objet"></p-sortIcon>
                            </th>
                            <th pSortableColumn="send_by.firstname" scope="col" style="text-align: center;">
                                Envoyé par <p-sortIcon field="send_by.firstname"></p-sortIcon>
                            </th>
                            <th pSortableColumn="cc" scope="col" style="text-align: center;">
                                Envoyé à <p-sortIcon field="cc"></p-sortIcon>
                            </th>
                            <th pSortableColumn="send_from" scope="col" style="text-align: center;">
                                Envoyé depuis <p-sortIcon field="send_from"></p-sortIcon>
                            </th>
                        </tr>
                    </ng-template>
                    <ng-template pTemplate="body" let-email let-expanded="expanded">
                        <tr>

                            <td>
                                <button type="button" pButton pRipple [pRowToggler]="email"
                                    class="p-button-text p-button-rounded p-button-plain"
                                    [icon]="expanded ? 'pi pi-chevron-down' : 'pi pi-chevron-right'"></button>
                            </td>
                            <td>
                                {{email.date_creation|date:'dd MMMM yy'}}
                            </td>
                            <td>
                                {{email.objet}}
                            </td>
                            <td>
                                {{email?.send_by?.firstname | titlecase}} {{email?.send_by?.lastname | uppercase}}
                            </td>
                            <td>
                                <strong>{{prospectSendTo?.user_id?.email_perso }}</strong> {{cc}}
                            </td>
                            <td>
                                {{email.send_from}}
                            </td>
                        </tr>
                    </ng-template>
                    <ng-template pTemplate="rowexpansion" let-email>
                        <div [innerHTML]="email.body">

                        </div>
                    </ng-template>
                </p-table>
            </p-tabPanel>
        </p-tabView>
    </div>
    <div *ngIf="showupdateLeadForm" class="col-12 card">
        <i class="pi pi-times-circle" style="float:right; color: red; cursor: pointer;"
            (click)="showupdateLeadForm = null" aria-hidden="true"> </i>
        <h4 style="text-align: center;">Modifier </h4>
        <div style="text-align: center;">
            <small>Tous les champs marqués d'un astérisque <span style="color: red;"> * </span> sont
                obligatoires</small><br>
        </div>
        <br>
        <form class="p-fluid p-formgrid grid" (ngSubmit)="UpdateProspect()" [formGroup]="updateLeadForm">
            <h5 class="col-12" style="text-align: center;">Etudiant</h5> <br>
            <!--<div class="field col-12 md:col-12">
                <label For="type">Type <span style="color:red"> *</span></label>
                <p-dropdown [options]="typeList" placeholder="Choisissez le type du lead" (onChange)="onSelectEcole()"
                    formControlName="lead_type"></p-dropdown>
            </div>-->


            <div class="field col-12 md:col-2">
                <label For="civilite">Civilité<span style="color: red;"> * </span></label>
                <p-dropdown [options]="civiliteList" placeholder="Choisissez une civilité"
                    formControlName="civilite"></p-dropdown>
            </div>
            <div class="field col-12 md:col-5">
                <label For="nom">Nom <span style="color: red;"> * </span></label>
                <input pInputText id="nom" type="text" placeholder="Entrez votre nom" formControlName="lastname" />
            </div>
            <div class="field col-12 md:col-5">
                <label For="prenom">Prénom <span style="color: red;"> * </span></label>
                <input pInputText id="prenom" type="text" placeholder="Entrez votre prénom"
                    formControlName="firstname" />
            </div>
            <div class="field col-12 md:col-6">
                <label For="date_naissance">Date de naissance <span style="color: red;"> *
                    </span></label>
                <input type="date" formControlName="date_naissance" pInputText />
            </div>
            <div class="field col-12 md:col-6">
                <label>Pays de résidence :<span style="color:red"> *</span></label><br>
                <p-dropdown formControlName="pays" [options]="paysList" placeholder="Pays"
                    emptyFilterMessage="Pas de pays trouvé" filterPlaceholder="Pays" filter="true"
                    optionDisabled="actif"></p-dropdown>
            </div>
            <div class="field col-12 md:col-6">
                <label For="nationalite">Nationalité <span style="color: red;"> * </span></label>
                <p-dropdown formControlName="nationalite" [options]="nationList"
                    emptyFilterMessage="Pas de nationalité trouvé" filterPlaceholder="Nationalité"
                    filter="true"></p-dropdown>
            </div>
            <h5 class="col-12" style="text-align: center;">Contact</h5> <br>
            <div class="field col-12 md:col-3">
                <label For="indicatif">Indicatif <span style="color: red;"> * </span></label>
                <input pInputText id="indicatif" type="text" placeholder="+33" formControlName="indicatif" />
            </div>
            <div class="field col-12 md:col-9">
                <label For="telephone">Numéro de téléphone <span style="color: red;"> *
                    </span></label>
                <input pInputText id="telephone" type="number" placeholder="Entrez votre numéro de téléphone"
                    formControlName="phone" />
            </div>
            <div class="field col-12 md:col-6">

                <label>Email :<span style="color:red"> *</span></label>
                <input type="email" formControlName="email_perso" placeholder="Email" (blur)="verifEmailInBD()"
                    pInputText>
            </div>
            <div class="field col-12 md:col-6">

                <label>Numéro de rue:<span style="color:red"> *</span></label>
                <input formControlName="rue_adresse" placeholder="Ex: 20 Place de l'église" pInputText>
            </div>
            <div class="field col-12 md:col-6">

                <label>Ville:<span style="color:red"> *</span></label>
                <input formControlName="ville_adresse" placeholder="Ex: Paris" pInputText>
            </div>
            <div class="field col-12 md:col-6">

                <label>Code postale:<span style="color:red"> *</span></label>
                <input formControlName="postal_adresse" placeholder="Ex: 15555" pInputText>
            </div>


            <h5 class="col-12" style="text-align: center;">Choix académique</h5><br>
            <div class="field col-12 md:col-12">
                <label For="role">Ecole <span style="color:red"> *</span></label>
                <p-dropdown [options]="EcoleListRework" placeholder="Choisissez l'école du lead"
                    (onChange)="onSelectEcole()" formControlName="type_form"></p-dropdown>
            </div>
            <div class="field col-12">
                <label>Choix du campus <span style="color: red;"> * </span></label>
                <p-dropdown [options]="campusDropdown" formControlName="campus_choix_1"
                    placeholder="Choisissez un campus">
                </p-dropdown>
            </div>

            <div class="field col-12 md:col-12">
                <label>Choix de la rentrée <span style="color: red;"> * </span></label>
                <p-dropdown [options]="rentreeList" formControlName="rentree_scolaire"
                    placeholder="Choisissez une rentrée" placeholder="Choisissez la rentrée scolaire">
                </p-dropdown>
            </div>

            <!--<div class="field col-12 md:col-4">
                <label>Choix du programme <span style="color: red;"> * </span></label>
                <p-dropdown [options]="programList" optionLabel="value" optionValue="value" formControlName="programme"
                    placeholder="Choisissez un programme">
                </p-dropdown>
            </div>-->
            <div class="field col-12 md:col-8" *ngIf="updateLeadForm.value.programme.value=='Programme Anglais'">
                <label For="formation">Choix de la formation <span style="color: red;">
                        *</span></label>
                <p-dropdown [options]="programEnDropdown" placeholder="Choose a english program" autoWidth="false"
                    [filter]="true" [group]="true" [style]="{'width':'100%'}" formControlName="formation"></p-dropdown>
            </div>
            <div class="field col-12 md:col-8" *ngIf="updateLeadForm.value.programme.value=='Programme Français'">
                <label For="programme_fr">Choix de la formation <span style="color: red;"> *
                    </span></label>
                <p-dropdown [options]="programeFrDropdown" placeholder="Choissiez un programme français" [filter]="true"
                    [group]="true" [style]="{'width':'100%'}" autoWidth="false"
                    formControlName="formation"></p-dropdown>
            </div>
            <div class="field col-12 md:col-12">
                <label For="rythme">Rythme de la formation <span style="color: red;"> *
                    </span></label>
                <p-dropdown [options]="typeFormationDropdown" optionLabel="value" optionValue="value" autoWidth="false"
                    placeholder="Choisissez un rythme" [style]="{'width':'100%'}"
                    formControlName="rythme_formation"></p-dropdown>
            </div>

            <div class="field col-12 md:col-6" *ngIf="!isPartenaireExterne">
                <label For="role">Source <span style="color:red"> *</span></label> <!--SI INTERNE-->
                <p-dropdown [options]="sourceList" placeholder="Choisissez la provenance du lead"
                    (onChange)="changeSource($event.value)" formControlName="source"></p-dropdown>
            </div>
            <div *ngIf="!itslead" class="field col-12 md:col-6"> <!--SI INTERNE-->
                <label For="role">Commercial</label>
                <p-dropdown [options]="commercialList" filter="true"
                    placeholder="Choisissez le commercial qui a ajouté le lead"
                    formControlName="commercial"></p-dropdown>
            </div>
            <div *ngIf="itslead" class="field col-12 md:col-6">
                <label>Nom et prénom :<span style="color:red"> *</span></label>
                <input formControlName="nomlead" placeholder="nom et pénom" pInputText>
            </div> <br>
            <div style="justify-content: right;">
                <button pButton type="submit" label="Modifier" [disabled]="updateLeadForm.invalid"></button>
            </div>
        </form>
    </div>
    <p-tabView [(activeIndex)]="selectedTabIndex" (onClose)="onTabClose($event)" (onChange)="handleChange($event)">
        <p-tabPanel header="Ajouter">
            <div class="col-12">
                <h4 style="text-align: center;">Ajouter un nouveau lead </h4>
                <div style="text-align: center;">
                    <small>Tous les champs marqués d'un astérisque <span style="color: red;"> * </span> sont
                        obligatoires</small><br>
                </div>
                <br>
                <form class="p-fluid p-formgrid grid" (ngSubmit)="addNewProspect()" [formGroup]="newLeadForm">
                    <h5 class="col-12" style="text-align: center;">Etudiant</h5> <br>
                    <!--<div class="field col-12 md:col-12">
                        <label For="type">Type <span style="color:red"> *</span></label>
                        <p-dropdown [options]="typeList" placeholder="Choisissez le type du lead"
                            formControlName="type"></p-dropdown>
                    </div>-->


                    <div class="field col-12 md:col-2">
                        <label For="civilite">Civilité<span style="color: red;"> * </span></label>
                        <p-dropdown [options]="civiliteList" optionLabel="value" optionDisabled="actif"
                            placeholder="Choisissez une civilité" formControlName="civilite"></p-dropdown>
                    </div>
                    <div class="field col-12 md:col-5">
                        <label For="nom">Nom <span style="color: red;"> * </span></label>
                        <input pInputText id="nom" type="text" placeholder="Entrez votre nom"
                            formControlName="lastname" />
                    </div>
                    <div class="field col-12 md:col-5">
                        <label For="prenom">Prénom <span style="color: red;"> * </span></label>
                        <input pInputText id="prenom" type="text" placeholder="Entrez votre prénom"
                            formControlName="firstname" />
                    </div>
                    <div class="field col-12 md:col-6">
                        <label For="date_naissance">Date de naissance <span style="color: red;"> *
                            </span></label>
                        <input type="date" formControlName="date_naissance" pInputText />
                    </div>
                    <div class="field col-12 md:col-6">
                        <label>Pays de résidence :<span style="color:red"> *</span></label><br>
                        <p-dropdown formControlName="pays" [options]="paysList" placeholder="Pays" optionLabel="value"
                            emptyFilterMessage="Pas de pays trouvé" filterPlaceholder="Pays" filter="true"
                            optionDisabled="actif"></p-dropdown>
                    </div>
                    <div class="field col-12 md:col-6">
                        <label For="nationalite">Nationalité <span style="color: red;"> * </span></label>
                        <p-dropdown formControlName="nationalite" [options]="nationList" optionLabel="label"
                            emptyFilterMessage="Pas de nationalité trouvé" filterPlaceholder="Nationalité"
                            filter="true"></p-dropdown>
                    </div>
                    <h5 class="col-12" style="text-align: center;">Contact</h5> <br>
                    <div class="field col-12 md:col-3">
                        <label For="indicatif">Indicatif <span style="color: red;"> * </span></label>
                        <input pInputText id="indicatif" type="text" placeholder="+33" formControlName="indicatif" />
                    </div>
                    <div class="field col-12 md:col-9">
                        <label For="telephone">Numéro de téléphone <span style="color: red;"> *
                            </span></label>
                        <input pInputText id="telephone" type="number" placeholder="Entrez votre numéro de téléphone"
                            formControlName="phone" />
                    </div>
                    <div class="field col-12 md:col-6">

                        <label>Email :<span style="color:red"> *</span></label>
                        <input type="email" formControlName="email_perso" placeholder="Email" (blur)="verifEmailInBD()"
                            pInputText>
                    </div>
                    <div class="field col-12 md:col-6">

                        <label>Rue:</label>
                        <input formControlName="rue" placeholder="Ex: 20 Place de l'église" pInputText>
                    </div>
                    <div class="field col-12 md:col-6">

                        <label>Ville:</label>
                        <input formControlName="ville" placeholder="Ex: Paris" pInputText>
                    </div>
                    <div class="field col-12 md:col-6">

                        <label>Code postale:</label>
                        <input formControlName="codep" placeholder="Ex: 14950" pInputText>
                    </div>


                    <h5 class="col-12" style="text-align: center;">Choix académique</h5><br>
                    <div class="field col-12 md:col-12">
                        <label For="role">Ecole <span style="color:red"> *</span></label>
                        <p-dropdown [options]="EcoleListRework" placeholder="Choisissez l'école du lead"
                            (onChange)="onSelectEcole()" formControlName="ecole"></p-dropdown>
                    </div>
                    <div class="field col-12">
                        <label>Choix du campus <span style="color: red;"> * </span></label>
                        <p-dropdown [options]="campusDropdown" optionLabel="value" formControlName="campus"
                            placeholder="Choisissez un campus">
                        </p-dropdown>
                    </div>

                    <div class="field col-12 md:col-12">
                        <label>Choix de la rentrée <span style="color: red;"> * </span></label>
                        <p-dropdown [options]="rentreeList" formControlName="rentree_scolaire"
                            placeholder="Choisissez une rentrée" placeholder="Choisissez la rentrée scolaire">
                        </p-dropdown>
                    </div>

                    <!--<div class="field col-12 md:col-4">
                        <label>Choix du programme <span style="color: red;"> * </span></label>
                        <p-dropdown [options]="programList" optionLabel="value" formControlName="programme"
                            placeholder="Choisissez un programme">
                        </p-dropdown>
                    </div>-->
                    <div class="field col-12 md:col-12" *ngIf="newLeadForm.value.programme?.value=='Programme Anglais'">
                        <label For="formation">Choix de la formation <span style="color: red;">
                                *</span></label>
                        <p-dropdown [options]="programEnDropdown" placeholder="Choose a english program"
                            autoWidth="false" [filter]="true" [group]="true" [style]="{'width':'100%'}"
                            formControlName="formation"></p-dropdown>
                    </div>
                    <div class="field col-12 md:col-12" *ngIf="newLeadForm.value.programme?.value=='Programme Français'">
                        <label For="programme_fr">Choix de la formation <span style="color: red;"> *
                            </span></label>
                        <p-dropdown [options]="programeFrDropdown" placeholder="Choisissez un programme français"
                            [filter]="true" [group]="true" [style]="{'width':'100%'}" autoWidth="false"
                            formControlName="formation"></p-dropdown>
                    </div>
                    <div class="field col-12 md:col-12">
                        <label For="rythme">Rythme de la formation <span style="color: red;"> *
                            </span></label>
                        <p-dropdown [options]="typeFormationDropdown" optionLabel="value" autoWidth="false"
                            placeholder="Choisissez un rythme" [style]="{'width':'100%'}"
                            formControlName="rythme_formation"></p-dropdown>
                    </div>

                    <div class="field col-12 md:col-6" *ngIf="!isPartenaireExterne">
                        <label For="role">Source <span style="color:red"> *</span></label> <!--SI INTERNE-->
                        <p-dropdown [options]="sourceList" placeholder="Choisissez la provenance du lead"
                            (onChange)="changeSource($event.value)" formControlName="source"></p-dropdown>
                    </div>
                    <div *ngIf="!itslead" class="field col-12 md:col-6"> <!--SI INTERNE-->
                        <label For="role">Commercial</label>
                        <p-dropdown [options]="commercialList" filter="true"
                            placeholder="Choisissez le commercial qui a ajouté le lead"
                            formControlName="commercial"></p-dropdown>
                    </div>
                    <div *ngIf="itslead" class="field col-12 md:col-6">
                        <label>Nom et prénom :<span style="color:red"> *</span></label>
                        <input formControlName="nomlead" placeholder="nom et pénom" pInputText>
                    </div> <br>
                    <div style="justify-content: right;">
                        <button pButton type="submit" label="Ajouter"
                            [disabled]="(newLeadForm.invalid && !isPartenaireExterne) || (!newLeadForm.value.ecole)"></button>
                    </div>
                </form>
            </div>
        </p-tabPanel>
        <p-tabPanel header="Local">

            <p-dataView [value]="['']" layout="grid">
                <ng-template pTemplate="header">
                    <div class="grid ">
                        <div class="field col-12 grid">
                            <div *ngIf="filtre_value.rythme" class="field col-4">
                                <label for="rythme">Rythme</label> <br>
                                <p-dropdown [style]="{'width':'17em'}" [options]="rythme_filtre" filter="true"
                                    [(ngModel)]="filtre_value.rythme"
                                    (onChange)="dt1.filter($event.value, 'rythme_formation', 'equals');"
                                    emptyFilterMessage="Type non trouvé" filterPlaceholder="Type"></p-dropdown>
                            </div>
                            <div *ngIf="filtre_value.rentree" class="field col-4">
                                <label for="rythme">Rentrée</label> <br>
                                <p-dropdown [style]="{'width':'17em'}" [options]="rentreeFiltere" filter="true"
                                    [(ngModel)]="filtre_value.rentree"
                                    (onChange)="dt1.filter($event.value, 'rentree_scolaire', 'equals');"
                                    emptyFilterMessage="Type non trouvé" filterPlaceholder="Type"></p-dropdown>
                            </div>
                            <div *ngIf="filtre_value.source" class="field col-4">
                                <label for="rythme">Etape</label> <br>
                                <p-dropdown [style]="{'width':'17em'}" [options]="sourceFiltre" filter="true"
                                    [(ngModel)]="filtre_value.source"
                                    (onChange)="dt1.filter($event.value, 'source', 'equals');"
                                    emptyFilterMessage="Type non trouvé" filterPlaceholder="Type"></p-dropdown>
                            </div>


                        </div>

                        <div class="md:col-1 col-12" style="text-align: center;">
                            <button pButton label="Filtrer" class="p-button" icon="pi pi-filter"
                                (click)="displayFilter=true"></button>
                        </div>
                        <div class="md:col-1 col-12" style="text-align: center;">
                            <button pButton label="Vider&nbsp;" class="p-button" icon="pi pi-filter-slash"
                                (click)="clearFilter()"></button>
                        </div>
                        <div class="md:col-1 col-12" style="text-align: center;">
                            <input pInputText type="text" style="width: 100%;"
                                (input)="dt1.filterGlobal($event.target.value, 'contains')" placeholder="Recherche" />
                        </div>
                        <div class="md:col-2 col-12">
                            <p-dropdown [options]="campusfiltre" filter="true" [(ngModel)]="filtre_value.campus" autoWidth="false"
                                [style]="{'width':'100%'}"
                                (onChange)="dt1.filter($event.value, 'campus_choix_1', 'equals');"
                                emptyFilterMessage="Type non trouvé" filterPlaceholder="Type"></p-dropdown>
                        </div>
                        <div class="md:col-2 col-12">
                            <p-dropdown [options]="formationsFitre" filter="true" [(ngModel)]="filtre_value.formation"
                                autoWidth="false" [style]="{'width':'100%'}"
                                (onChange)="dt1.filter($event.value, 'formation', 'equals');"
                                emptyFilterMessage="Type non trouvé" filterPlaceholder="Type"></p-dropdown>
                        </div>
                        <div class="md:col-2 col-12">
                            <p-dropdown [options]="EcoleFiltre" filter="true" autoWidth="false"  [(ngModel)]="filtre_value.campus"
                                [style]="{'width':'100%'}" (onChange)="dt1.filter($event.value,'type_form', 'equals')"
                                emptyFilterMessage="Role non trouvé" filterPlaceholder="Rôle"></p-dropdown>
                        </div>
                        <div class="md:col-2 col-12">
                            <p-dropdown [style]="{'width':'100%'}" [options]="filterPhase" filter="true"
                                [(ngModel)]="filtre_value.phase"
                                (onChange)="dt1.filter($event.value, 'phase_candidature', 'equals')"
                                emptyFilterMessage="Type non trouvé" filterPlaceholder="Type"></p-dropdown>
                        </div>
                        <div class="md:col-1 col-12">
                            <p-dataViewLayoutOptions></p-dataViewLayoutOptions>
                        </div>
                    </div>
                </ng-template>
                <ng-template let-car pTemplate="listItem">
                    <p-table #dt1 [value]="prospects" dataKey="_id" responsiveLayout="scroll"
                        [globalFilterFields]="['nom', 'choix', 'rythme']" [rows]="8" [pageLinks]="5" [paginator]="true"
                        rowExpandMode="single" [totalRecords]="" styleClass="p-datatable-gridlines">

                        <ng-template pTemplate="header">
                            <tr>
                                <th style="width: 5em"></th>
                                <th pSortableColumn="id">
                                    ID<p-sortIcon field="id"> </p-sortIcon>
                                </th>
                                <th pSortableColumn="nom">
                                    Prénom et Nom<p-sortIcon field="nom"> </p-sortIcon>
                                </th>
                                <th pSortableColumn="choix">
                                    Choix académique <p-sortIcon field="choix"> </p-sortIcon>
                                </th>
                                <th pSortableColumn="rythme">
                                    Rythme <p-sortIcon field="rythme"> </p-sortIcon>
                                </th>
                                <th pSortableColumn="decision">
                                    Décision admission<p-sortIcon field="decision"> </p-sortIcon>
                                </th>

                                <th>
                                    Paiement
                                </th>

                                <th pSortableColumn="phase_candidature">
                                    Etape<p-sortIcon field="phase_candidature"> </p-sortIcon>
                                </th>

                                <th pSortableColumn="date">
                                    Date d'inscription<p-sortIcon field="date">
                                    </p-sortIcon>

                                <th>Action</th>
                            </tr>
                        </ng-template>
                        <ng-template pTemplate="body" let-prospect let-expanded="expanded">
                            <tr [pEditableRow]="prospect">
                                <td>
                                    <button type="button" pButton pRipple [pRowToggler]="prospect"
                                        (click)="rowExpand(prospect)"
                                        class="p-button-text p-button-rounded p-button-plain" [icon]="
                                    expanded
                                        ? 'pi pi-chevron-down'
                                        : 'pi pi-chevron-right'
                                "></button>
                                </td>
                                <td>
                                    {{ prospect.customid}}
                                </td>
                                <td>
                                    {{ prospect.user_id.firstname | titlecase }}
                                    {{ prospect.user_id.lastname | uppercase }}
                                </td>
                                <td>
                                    {{prospect.rentree_scolaire}}, {{ prospect.formation}}, {{prospect.campus_choix_1}},
                                    {{prospect.type_form|titlecase}}
                                </td>
                                <td>
                                    {{prospect?.rythme_formation}}
                                </td>
                                <td>
                                    {{ prospect?.decision_admission}}
                                </td>
                                <td>
                                    {{ calculPayement(prospect)}}
                                </td>


                                <td pEditableColumn>
                                    <p-cellEditor>
                                        <ng-template pTemplate="input">
                                            <p-dropdown [options]="phaseDropdown"
                                                [(ngModel)]="prospect.phase_candidature" appendTo="body"
                                                (onChange)="onSelectEtat(prospect.etat_dossier,prospect)"
                                                placeholder="Choisissez une étape"></p-dropdown>
                                        </ng-template>
                                        <ng-template pTemplate="output">
                                            {{prospect.phase_candidature}}
                                        </ng-template>
                                    </p-cellEditor>
                                </td>
                                <td>
                                    {{ prospect?.date_creation| date:'dd MMMM yy'}}
                                </td>
                                <td>
                                    <i *ngIf="candidatureDic && candidatureDic[prospect._id]"
                                        style="padding-left: 3%;color: rgb(11, 36, 0);" class="pi pi-book m-1" pBadge
                                        value="1" pTooltip="Candidature" aria-hidden="true"
                                        (click)="goToCandidature(prospect)" tooltipPosition="bottom"></i>
                                    <i pTooltip="Envoyer un mail" tooltipPosition="bottom" class="pi pi-at m-1"
                                        style="padding-left: 3%" aria-hidden="true"
                                        (click)="initSendEmail(prospect);scrollToTop()">
                                    </i>
                                    <i *ngIf="!candidatureDic || !candidatureDic[prospect._id]"
                                        style="padding-left: 3%;color: rgb(11, 36, 0);" class="pi pi-book m-1"
                                        pTooltip="Candidature" aria-hidden="true" (click)="goToCandidature(prospect)"
                                        tooltipPosition="bottom"></i>
                                    <i style="padding-left: 3%;color: rgb(11, 36, 0);" class="pi pi-euro m-1"
                                        (click)="initPaiement(prospect);scrollToTop()" pTooltip="Paiement"
                                        aria-hidden="true" tooltipPosition="bottom"></i>
                                    <i pTooltip="Documents" tooltipPosition="bottom" class="pi pi-file m-1"
                                        (click)="AddDocumentOnglet(prospect);scrollToTop();showDocumentB=true;"
                                        aria-hidden="true"></i>
                                    <i style="padding-left: 3%;" class="pi pi-building m-1" pTooltip="Admission"
                                        (click)="onshowDossier(prospect)" aria-hidden="true"
                                        tooltipPosition="bottom"></i>
                                    <i style="padding-left: 3%;color: rgb(72, 72, 255);
                                " class="pi pi-pencil m-1" (click)="initupdateLeadForm(prospect); scrollToTop()"
                                        pTooltip="Modifier" aria-hidden="true" tooltipPosition="bottom"></i>
                                    <i style="padding-left: 3%; color: rgb(255, 0, 0)" class="pi pi-trash m-1"
                                        (click)="deletePro(prospect)" pTooltip="Supprimer" aria-hidden="true"
                                        tooltipPosition="bottom"></i>
                                </td>
                            </tr>
                        </ng-template>
                        <ng-template pTemplate="rowexpansion" let-user>
                            <tr>
                                <td colspan="10">


                                    <h5 style="color: rgb(48, 121, 230);font-weight: bold;">
                                        Détails
                                    </h5>
                                    <p-table responsiveLayout="scroll">
                                        <ng-template pTemplate="header">
                            <tr>

                                <th>ID</th>
                                <th>Prénom et Nom </th>
                                <th>Date de naissance</th>
                                <th>Pays de résidence</th>
                                <th>Nationalité</th>
                                <th>Action</th>

                            </tr>
                        </ng-template>
                        <ng-template pTemplate="emptymessage">
                            <tr>
                                <td>{{ user.customid }}</td>
                                <td pEditableColumn>
                                    <p-cellEditor>
                                        <ng-template pTemplate="input">
                                            <input type="text" pInputText placeholder="Prénom"
                                                [(value)]="user.user_id.firstname">
                                            <input type="text" pInputText placeholder="Nom"
                                                [(value)]="user.user_id.lastname">
                                        </ng-template>
                                        <ng-template pTemplate="output">
                                            {{ user.user_id.firstname | titlecase }}
                                            {{ user.user_id.lastname | uppercase }}
                                        </ng-template>
                                    </p-cellEditor>
                                </td>
                                <td pEditableColumn>
                                    <p-cellEditor>
                                        <ng-template pTemplate="input">
                                            <input type="date" pInputText placeholder="Date de naissance"
                                                [(value)]="user.date_naissance">
                                        </ng-template>
                                        <ng-template pTemplate="output">
                                            {{
                                            user.date_naissance | date:'dd MMMM yy'
                                            }}
                                        </ng-template>
                                    </p-cellEditor>
                                </td>
                                <td pEditableColumn>
                                    <p-cellEditor>
                                        <ng-template pTemplate="input">
                                            <p-dropdown [(ngModel)]="user.user_id.pays_adresse" [options]="paysList"
                                                placeholder="Pays" optionValue="value" optionLabel="value"
                                                appendTo="body" emptyFilterMessage="Pas de pays trouvé"
                                                filterPlaceholder="Pays" filter="true"
                                                optionDisabled="actif"></p-dropdown>
                                        </ng-template>
                                        <ng-template pTemplate="output">
                                            {{ user.user_id.pays_adresse}}
                                        </ng-template>
                                    </p-cellEditor>
                                </td>
                                <td pEditableColumn>
                                    <p-cellEditor>
                                        <ng-template pTemplate="input">
                                            <p-dropdown [(ngModel)]="user.user_id.nationnalite" [options]="nationList"
                                                emptyFilterMessage="Pas de nationalité trouvé" appendTo="body"
                                                filterPlaceholder="Nationalité" filter="true"></p-dropdown>
                                        </ng-template>
                                        <ng-template pTemplate="output">
                                            {{ user.user_id.nationnalite}}
                                        </ng-template>
                                    </p-cellEditor>
                                </td>

                                <td>
                                    <i style="padding-left: 3%;color: green;" class="pi pi-save m-1"
                                        (click)="onSelectEtat(user.etat_dossier,user);"
                                        pTooltip="Sauvegardez les modification" aria-hidden="true"
                                        tooltipPosition="bottom"></i>
                                </td>
                            </tr>


                        </ng-template>

                    </p-table>
                    <h5 style="color: rgb(48, 121, 230);font-weight: bold;">
                        Contact
                    </h5>
                    <p-table responsiveLayout="scroll">
                        <ng-template pTemplate="header">
                            <tr>
                                <th>Adresse mail</th>
                                <th>Adresse mail école </th>
                                <th>numéro de téléphone</th>
                                <th>Adresse</th>
                                <th>Action</th>
                            </tr>
                        </ng-template>
                        <ng-template pTemplate="emptymessage">
                            <tr>
                                <td>
                                    {{ user.user_id.email_perso}}
                                </td>
                                <td>
                                    <ng-container *ngIf="user.user_id.email!=user.user_id.email_perso">
                                        {{ user.user_id.email}}
                                    </ng-container>
                                </td>
                                <td pEditableColumn>
                                    <p-cellEditor>
                                        <ng-template pTemplate="input">
                                            <input type="text" pInputText placeholder="Téléphone"
                                                [(value)]="user.user_id.phone">
                                        </ng-template>
                                        <ng-template pTemplate="output">
                                            {{ user.user_id.phone}}
                                        </ng-template>
                                    </p-cellEditor>
                                </td>
                                <td pEditableColumn>
                                    <p-cellEditor>
                                        <ng-template pTemplate="input">
                                            <input type="text" pInputText placeholder="Rue"
                                                [(value)]="user.user_id.rue_adresse">
                                            <input type="text" pInputText placeholder="Ville"
                                                [(value)]="user.user_id.ville_adresse">
                                            <p-dropdown [(ngModel)]="user.user_id.pays_adresse" [options]="paysList"
                                                placeholder="Pays" optionValue="value" optionLabel="value"
                                                appendTo="body" emptyFilterMessage="Pas de pays trouvé"
                                                filterPlaceholder="Pays" filter="true"
                                                optionDisabled="actif"></p-dropdown>
                                        </ng-template>
                                        <ng-template pTemplate="output">
                                            {{ user.user_id.rue_adresse}} {{user.user_id.ville_adresse}}, {{
                                            user.user_id.pays_adresse}}
                                        </ng-template>
                                    </p-cellEditor>
                                </td>
                                <td>
                                    <i style="padding-left: 3%;color: green;" class="pi pi-save m-1"
                                        (click)="onSelectEtat(user.etat_dossier,user);"
                                        pTooltip="Sauvegardez les modification" aria-hidden="true"
                                        tooltipPosition="bottom"></i>
                                </td>

                            </tr>


                        </ng-template>

                    </p-table>
                    <h5 style="color: rgb(48, 121, 230);font-weight: bold;">
                        Choix académique
                    </h5>
                    <p-table responsiveLayout="scroll">
                        <ng-template pTemplate="header">
                            <tr>
                                <th>Session</th>
                                <th>Ecole </th>
                                <th>Campus</th>
                                <th>Formation</th>
                                <th>Groupe</th>
                                <th>Rythme</th>
                                <th>Action</th>
                            </tr>
                        </ng-template>
                        <ng-template pTemplate="emptymessage">
                            <tr>
                                <td pEditableColumn>
                                    <p-cellEditor>
                                        <ng-template pTemplate="input">
                                            <input type="text" pInputText placeholder="Formation"
                                                [(value)]="user.formation">
                                        </ng-template>
                                        <ng-template pTemplate="output">
                                            {{ user.formation}}
                                        </ng-template>
                                    </p-cellEditor>
                                </td>
                                <td>
                                    {{ user.type_form | titlecase}}
                                </td>
                                <td pEditableColumn>
                                    <p-cellEditor>
                                        <ng-template pTemplate="input">
                                            <input type="text" pInputText placeholder="Campus"
                                                [(value)]="user.campus_choix_1">
                                        </ng-template>
                                        <ng-template pTemplate="output">
                                            {{ user.campus_choix_1}}
                                        </ng-template>
                                    </p-cellEditor>
                                </td>
                                <td pEditableColumn>
                                    <p-cellEditor>
                                        <ng-template pTemplate="input">
                                            <input type="text" pInputText placeholder="Formation"
                                                [(value)]="user.formation">
                                        </ng-template>
                                        <ng-template pTemplate="output">
                                            {{ user.formation}}
                                        </ng-template>
                                    </p-cellEditor>
                                </td>
                                <td>
                                    {{ user.groupe}}
                                </td>
                                <td pEditableColumn>
                                    <p-cellEditor>
                                        <ng-template pTemplate="input">
                                            <p-dropdown [options]="typeFormationDropdown" optionValue="value"
                                                optionLabel="value" autoWidth="false" placeholder="Choisissez un rythme"
                                                [style]="{'width':'100%'}" appendTo="body"
                                                [(ngModel)]="user.rythme_formation"></p-dropdown>
                                        </ng-template>
                                        <ng-template pTemplate="output">
                                            {{ user.rythme_formation}}
                                        </ng-template>
                                    </p-cellEditor>
                                </td>
                                <td>
                                    <i style="padding-left: 3%;color: green;" class="pi pi-save m-1"
                                        (click)="onSelectEtat(user.etat_dossier,user);"
                                        pTooltip="Sauvegardez les modification" aria-hidden="true"
                                        tooltipPosition="bottom"></i>
                                </td>

                            </tr>


                        </ng-template>

                    </p-table>
                    <h5 style="color: rgb(48, 121, 230);font-weight: bold;">
                        Source
                    </h5>
                    <p-table responsiveLayout="scroll">
                        <ng-template pTemplate="header">
                            <tr>
                                <th>Source</th>
                                <th>Commercial </th>
                                <th>Adresse mail</th>
                                <th>Téléphone</th>
                                <th>Action</th>
                            </tr>
                        </ng-template>
                        <ng-template pTemplate="emptymessage">
                            <tr>
                                <td pEditableColumn>
                                    <p-cellEditor>
                                        <ng-template pTemplate="input">
                                            <input type="text" pInputText placeholder="Formation"
                                                [(value)]="user.source">
                                        </ng-template>
                                        <ng-template pTemplate="output">
                                            {{ user.source}}
                                        </ng-template>
                                    </p-cellEditor>
                                </td>
                                <td>
                                    {{ commercialOwned?.user_id?.firstname}} {{ commercialOwned?.user_id?.lastname}}
                                </td>
                                <td>
                                    {{ commercialOwned?.user_id?.email}}
                                </td>
                                <td>
                                    {{ commercialOwned?.user_id?.indicatif}} {{ commercialOwned?.user_id?.phone}}
                                </td>

                                <td>
                                    <i style="padding-left: 3%;color: green;" class="pi pi-save m-1"
                                        (click)="onSelectEtat(user.etat_dossier,user);"
                                        pTooltip="Sauvegardez les modification" aria-hidden="true"
                                        tooltipPosition="bottom"></i>
                                </td>

                            </tr>


                        </ng-template>

                    </p-table>
                    </td>
                    </tr>

                </ng-template>

                </p-table>
                </ng-template>
                <ng-template let-car pTemplate="gridItem">
                    <div class="col-12 md:col-4" *ngFor="let prospect of prospects">
                        <div class="offre-card row grid mt-3">
                            <div class="col-5 card-right">

                                <div class="img-card"
                                    style="background-image: url('../../../assets/images/imatch/male.png');">
                                </div>
                                <p>{{prospect?.customid}}</p>
                            </div>
                            <div class="col-7 card-right">
                                <div style="text-align: right;">
                                    <p>{{prospect.date_creation|date:'dd MMMM yy'}}</p>
                                </div>
                                <div class="offre-card-main">
                                    <h4 class="offre-card-title">
                                        {{prospect.user_id.firstname}} {{prospect.user_id.lastname}}</h4>
                                    <p class="offre-card-lieu"> {{prospect?.campus_choix_1 }} - {{prospect?.formation }}
                                    </p>
                                </div>
                                <!--<a class="offres-btns postuler" [badge]="dicOffreNB[annonce._id]"
                            (click)="showPostuler = true; annonceSelected = annonce"><i
                                class="pi pi-arrow-right"></i>Postuler</a>-->

                            </div>
                            <div class="col-12" style="text-align: center;"
                                [ngClass]="{'insc-def':prospect.phase_candidature=='Inscription définitive','non-traite':prospect.phase_candidature=='Non traité','other':(prospect.phase_candidature!='Non traité' && prospect.phase_candidature!='Inscription définitive' )}">
                                <p>{{prospect.phase_candidature}}</p>
                            </div>
                            <div class="col-12 grid">
                                <div class="col-4">
                                    <p-button label="Admission" icon="pi pi-users" [style]="{'width':'100%'}"
                                        (click)="onshowDossier(prospect)" autoWidth="false"></p-button>
                                </div>
                                <div class="col-4">
                                    <p-button label="Document" icon="pi pi-file" [style]="{'width':'100%'}"
                                        (click)="AddDocumentOnglet(prospect);" autoWidth="false"></p-button>
                                </div>

                                <div class="col-4">
                                    <p-button label="Détail" icon="pi pi-briefcase" [style]="{'width':'100%'}"
                                        (click)="onshowDossier(prospect)" autoWidth="false"></p-button>
                                </div>

                            </div>
                        </div>
                    </div>
                </ng-template>
            </p-dataView>
        </p-tabPanel>
        <p-tabPanel header="International">
            <p-dataView [value]="['']" layout="grid">
                <ng-template pTemplate="header">
                    <div class="grid ">
                        <div class="field col-12 grid ">
                            <div *ngIf="filtre_value.rythme" class="field col-4">
                                <label for="rythme">Rythme</label> <br>
                                <p-dropdown [style]="{'width':'17em'}" [options]="rythme_filtre" filter="true"
                                    [(ngModel)]="filtre_value.rythme"
                                    (onChange)="dt1.filter($event.value, 'rythme_formation', 'equals');"
                                    emptyFilterMessage="Type non trouvé" filterPlaceholder="Type"></p-dropdown>
                            </div>
                            <div *ngIf="filtre_value.rentree" class="field col-4">
                                <label for="rythme">Rentrée</label> <br>
                                <p-dropdown [style]="{'width':'17em'}" [options]="rentreeFiltere" filter="true"
                                    [(ngModel)]="filtre_value.rentree"
                                    (onChange)="dt1.filter($event.value, 'rentree_scolaire', 'equals');"
                                    emptyFilterMessage="Type non trouvé" filterPlaceholder="Type"></p-dropdown>
                            </div>
                            <div *ngIf="filtre_value.phase" class="field col-4">
                                <label for="rythme">Etape</label> <br>
                                <p-dropdown [style]="{'width':'17em'}" [options]="filterPhase" filter="true"
                                    [(ngModel)]="filtre_value.phase"
                                    (onChange)="dt1.filter($event.value, 'phase_candidature', 'equals');"
                                    emptyFilterMessage="Type non trouvé" filterPlaceholder="Type"></p-dropdown>
                            </div>
                            <div *ngIf="filtre_value.source" class="field col-4">
                                <label for="rythme">Etape</label> <br>
                                <p-dropdown [style]="{'width':'17em'}" [options]="sourceFiltre" filter="true"
                                    [(ngModel)]="filtre_value.source"
                                    (onChange)="dt1.filter($event.value, 'source', 'equals');"
                                    emptyFilterMessage="Type non trouvé" filterPlaceholder="Type"></p-dropdown>
                            </div>


                        </div>
                        <div class="md:col-1 col-6" style="text-align: center;">
                            <button pButton label="Filtrer" class="p-button" icon="pi pi-filter"
                                (click)="displayFilter=true"></button>
                        </div>
                        <div class="md:col-1 col-6" style="text-align: center;">
                            <button pButton label="Vider&nbsp;" class="p-button" icon="pi pi-filter-slash"
                                (click)="clearFilter()"></button>
                        </div>
                        <div class="md:col-2 col-9" style="text-align: center;">
                            <input pInputText type="text" style="width: 100%;"
                                (input)="dt1.filterGlobal($event.target.value, 'contains')" placeholder="Recherche" />
                        </div>
                        <div class="md:col-2 col-12">
                            <p-dropdown autoWidth="false" [style]="{'width':'100%'}" [options]="campusfiltre"
                                filter="true" [(ngModel)]="filtre_value.campus"
                                (onChange)="dt1.filter($event.value, 'campus_choix_1', 'equals');"
                                emptyFilterMessage="Type non trouvé" filterPlaceholder="Type"></p-dropdown>
                        </div>
                        <div class="md:col-2 col-12">
                            <p-dropdown autoWidth="false" [style]="{'width':'100%'}" [options]="formationsFitre"
                                filter="true" [(ngModel)]="filtre_value.formation"
                                (onChange)="dt1.filter($event.value, 'formation', 'equals');"
                                emptyFilterMessage="Type non trouvé" filterPlaceholder="Type"></p-dropdown>
                        </div>
                        <div class="md:col-2 col-12">
                            <p-dropdown autoWidth="false" [style]="{'width':'100%'}" [options]="EcoleFiltre"
                                filter="true" (onChange)="dt1.filter($event.value,'type_form', 'equals')"
                                emptyFilterMessage="Role non trouvé" filterPlaceholder="Rôle"></p-dropdown>
                        </div>
                        <div class="md:col-2 col-12">
                            <p-dataViewLayoutOptions></p-dataViewLayoutOptions>
                        </div>
                    </div>
                </ng-template>
                <ng-template let-car pTemplate="listItem">

                    <p-table #dt1 [value]="prospectI" dataKey="_id" responsiveLayout="scroll"
                        [globalFilterFields]="['nom', 'choix', 'rythme']" [rows]="8" [pageLinks]="5" [paginator]="true"
                        rowExpandMode="single" [totalRecords]="" styleClass="p-datatable-gridlines">

                        <ng-template pTemplate="header">
                            <tr>
                                <th style="width: 5em"></th>
                                <th pSortableColumn="id">
                                    ID<p-sortIcon field="id"> </p-sortIcon>
                                </th>
                                <th pSortableColumn="nom">
                                    Prénom et Nom<p-sortIcon field="nom"> </p-sortIcon>
                                </th>
                                <th pSortableColumn="choix">
                                    Choix académique <p-sortIcon field="choix"> </p-sortIcon>
                                </th>
                                <th pSortableColumn="rythme">
                                    Rythme <p-sortIcon field="rythme"> </p-sortIcon>
                                </th>
                                <th pSortableColumn="decision">
                                    Décision admission<p-sortIcon field="decision"> </p-sortIcon>
                                </th>

                                <th pSortableColumn="paiement">
                                    Paiement<p-sortIcon field="paiement"> </p-sortIcon>
                                </th>

                                <th pSortableColumn="etape">
                                    Etape<p-sortIcon field="etape"> </p-sortIcon>
                                </th>

                                <th pSortableColumn="date">
                                    Date d'inscription<p-sortIcon field="date">
                                    </p-sortIcon>

                                <th>Action</th>
                            </tr>
                        </ng-template>
                        <ng-template pTemplate="body" let-prospect>
                            <tr>
                                <td>
                                    <button type="button" pButton pRipple [pRowToggler]="prospect"
                                        (click)="rowExpand(prospect)"
                                        class="p-button-text p-button-rounded p-button-plain" [icon]="
                                        expanded
                                            ? 'pi pi-chevron-down'
                                            : 'pi pi-chevron-right'
                                    "></button>
                                </td>
                                <td>
                                    {{ prospect.customid}}
                                </td>
                                <td>
                                    {{ prospect.user_id.firstname | titlecase }}
                                    {{ prospect.user_id.lastname | uppercase }}
                                </td>
                                <td>
                                    {{prospect.rentree_scolaire}}, {{ prospect.formation}}, {{prospect.campus_choix_1}},
                                    {{prospect.type_form|titlecase}}
                                </td>
                                <td>
                                    {{prospect.rythme_formation}}
                                </td>
                                <td>
                                    {{ prospect?.niveau}}
                                </td>
                                <td>
                                    {{ calculPayement(prospect)}}
                                </td>
                                <td pEditableColumn>
                                    <p-cellEditor>
                                        <ng-template pTemplate="input">
                                            <p-dropdown [options]="phaseDropdown"
                                                [(ngModel)]="prospect.phase_candidature" appendTo="body"
                                                (onChange)="onSelectEtat(prospect.etat_dossier,prospect)"
                                                placeholder="Choisissez une étape"></p-dropdown>
                                        </ng-template>
                                        <ng-template pTemplate="output">
                                            {{prospect.phase_candidature}}
                                        </ng-template>
                                    </p-cellEditor>
                                </td>
                                <td>
                                    {{ prospect?.date_creation | date:'dd MMMM yy'}}
                                </td>
                                <td>
                                    <i *ngIf="candidatureDic && candidatureDic[prospect._id]"
                                        style="padding-left: 3%;color: rgb(11, 36, 0);" class="pi pi-book m-1" pBadge
                                        value="1" pTooltip="Candidature" aria-hidden="true"
                                        (click)="goToCandidature(prospect)" tooltipPosition="bottom"></i>
                                    <i pTooltip="Envoyer un mail" tooltipPosition="bottom" class="pi pi-at m-1"
                                        style="padding-left: 3%" aria-hidden="true"
                                        (click)="initSendEmail(prospect);scrollToTop()">
                                    </i>
                                    <i *ngIf="!candidatureDic || !candidatureDic[prospect._id]"
                                        style="padding-left: 3%;color: rgb(11, 36, 0);" class="pi pi-book m-1"
                                        pTooltip="Candidature" aria-hidden="true" (click)="goToCandidature(prospect)"
                                        tooltipPosition="bottom"></i>

                                    <i style="padding-left: 3%;color: rgb(11, 36, 0);" class="pi pi-euro m-1"
                                        (click)="initPaiement(prospect);scrollToTop()" pTooltip="Paiement"
                                        aria-hidden="true" tooltipPosition="bottom"></i>

                                    <i pTooltip="Documents administratif" tooltipPosition="bottom"
                                        class="pi pi-file m-1" (click)="AddDocumentOnglet(prospect);"
                                        aria-hidden="true"></i>

                                    <i style="padding-left: 3%; " class="pi pi-building m-1" pTooltip="Admission"
                                        (click)="onshowDossier(prospect)" aria-hidden="true"
                                        tooltipPosition="bottom"></i>

                                    <i style="padding-left: 3%;color: rgb(72, 72, 255);
                                    " class="pi pi-pencil m-1" (click)="initupdateLeadForm(prospect); scrollToTop()"
                                        pTooltip="Modifier" aria-hidden="true" tooltipPosition="bottom"></i>

                                    <i style="padding-left: 3%; color: rgb(255, 0, 0)" class="pi pi-trash m-1"
                                        (click)="deletePro(prospect)" pTooltip="Supprimer" aria-hidden="true"
                                        tooltipPosition="bottom"></i>
                                </td>
                            </tr>
                        </ng-template>
                        <ng-template pTemplate="rowexpansion" let-user>
                            <tr>
                                <td colspan="10">


                                    <h5 style="color: rgb(48, 121, 230);font-weight: bold;">
                                        Détails
                                    </h5>
                                    <p-table responsiveLayout="scroll">
                                        <ng-template pTemplate="header">
                            <tr>

                                <th>ID</th>
                                <th>Prénom et Nom </th>
                                <th>Date de naissance</th>
                                <th>Pays de résidence</th>
                                <th>Nationalité</th>
                                <th>Action</th>

                            </tr>
                        </ng-template>
                        <ng-template pTemplate="emptymessage">
                            <tr>
                                <td>{{ user.customid }}</td>
                                <td pEditableColumn>
                                    <p-cellEditor>
                                        <ng-template pTemplate="input">
                                            <input type="text" pInputText placeholder="Prénom"
                                                [(value)]="user.user_id.firstname">
                                            <input type="text" pInputText placeholder="Nom"
                                                [(value)]="user.user_id.lastname">
                                        </ng-template>
                                        <ng-template pTemplate="output">
                                            {{ user.user_id.firstname | titlecase }}
                                            {{ user.user_id.lastname | uppercase }}
                                        </ng-template>
                                    </p-cellEditor>
                                </td>
                                <td pEditableColumn>
                                    <p-cellEditor>
                                        <ng-template pTemplate="input">
                                            <input type="date" pInputText placeholder="Date de naissance"
                                                [(value)]="user.date_naissance">
                                        </ng-template>
                                        <ng-template pTemplate="output">
                                            {{
                                            user.date_naissance | date:'dd MMMM yy'
                                            }}
                                        </ng-template>
                                    </p-cellEditor>
                                </td>
                                <td pEditableColumn>
                                    <p-cellEditor>
                                        <ng-template pTemplate="input">
                                            <p-dropdown [(ngModel)]="user.user_id.pays_adresse" [options]="paysList"
                                                placeholder="Pays" optionValue="value" optionLabel="value"
                                                appendTo="body" emptyFilterMessage="Pas de pays trouvé"
                                                filterPlaceholder="Pays" filter="true"
                                                optionDisabled="actif"></p-dropdown>
                                        </ng-template>
                                        <ng-template pTemplate="output">
                                            {{ user.user_id.pays_adresse}}
                                        </ng-template>
                                    </p-cellEditor>
                                </td>
                                <td pEditableColumn>
                                    <p-cellEditor>
                                        <ng-template pTemplate="input">
                                            <p-dropdown [(ngModel)]="user.user_id.nationnalite" [options]="nationList"
                                                emptyFilterMessage="Pas de nationalité trouvé" appendTo="body"
                                                filterPlaceholder="Nationalité" filter="true"></p-dropdown>
                                        </ng-template>
                                        <ng-template pTemplate="output">
                                            {{ user.user_id.nationnalite}}
                                        </ng-template>
                                    </p-cellEditor>
                                </td>

                                <td>
                                    <i style="padding-left: 3%;color: green;" class="pi pi-save m-1"
                                        (click)="onSelectEtat(user.etat_dossier,user);"
                                        pTooltip="Sauvegardez les modification" aria-hidden="true"
                                        tooltipPosition="bottom"></i>
                                </td>
                            </tr>


                        </ng-template>

                    </p-table>
                    <h5 style="color: rgb(48, 121, 230);font-weight: bold;">
                        Contact
                    </h5>
                    <p-table responsiveLayout="scroll">
                        <ng-template pTemplate="header">
                            <tr>
                                <th>Adresse mail</th>
                                <th>Adresse mail école </th>
                                <th>numéro de téléphone</th>
                                <th>Adresse</th>
                                <th>Action</th>
                            </tr>
                        </ng-template>
                        <ng-template pTemplate="emptymessage">
                            <tr>
                                <td>
                                    {{ user.user_id.email_perso}}
                                </td>
                                <td>
                                    <ng-container *ngIf="user.user_id.email!=user.user_id.email_perso">
                                        {{ user.user_id.email}}
                                    </ng-container>
                                </td>
                                <td pEditableColumn>
                                    <p-cellEditor>
                                        <ng-template pTemplate="input">
                                            <input type="text" pInputText placeholder="Téléphone"
                                                [(value)]="user.user_id.phone">
                                        </ng-template>
                                        <ng-template pTemplate="output">
                                            {{ user.user_id.phone}}
                                        </ng-template>
                                    </p-cellEditor>
                                </td>
                                <td pEditableColumn>
                                    <p-cellEditor>
                                        <ng-template pTemplate="input">
                                            <input type="text" pInputText placeholder="Rue"
                                                [(value)]="user.user_id.rue_adresse">
                                            <input type="text" pInputText placeholder="Ville"
                                                [(value)]="user.user_id.ville_adresse">
                                            <p-dropdown [(ngModel)]="user.user_id.pays_adresse" [options]="paysList"
                                                placeholder="Pays" optionValue="value" optionLabel="value"
                                                appendTo="body" emptyFilterMessage="Pas de pays trouvé"
                                                filterPlaceholder="Pays" filter="true"
                                                optionDisabled="actif"></p-dropdown>
                                        </ng-template>
                                        <ng-template pTemplate="output">
                                            {{ user.user_id.rue_adresse}} {{user.user_id.ville_adresse}}, {{
                                            user.user_id.pays_adresse}}
                                        </ng-template>
                                    </p-cellEditor>
                                </td>
                                <td>
                                    <i style="padding-left: 3%;color: green;" class="pi pi-save m-1"
                                        (click)="onSelectEtat(user.etat_dossier,user);"
                                        pTooltip="Sauvegardez les modification" aria-hidden="true"
                                        tooltipPosition="bottom"></i>
                                </td>

                            </tr>


                        </ng-template>

                    </p-table>
                    <h5 style="color: rgb(48, 121, 230);font-weight: bold;">
                        Choix académique
                    </h5>
                    <p-table responsiveLayout="scroll">
                        <ng-template pTemplate="header">
                            <tr>
                                <th>Session</th>
                                <th>Ecole </th>
                                <th>Campus</th>
                                <th>Formation</th>
                                <th>Groupe</th>
                                <th>Rythme</th>
                                <th>Action</th>
                            </tr>
                        </ng-template>
                        <ng-template pTemplate="emptymessage">
                            <tr>
                                <td pEditableColumn>
                                    <p-cellEditor>
                                        <ng-template pTemplate="input">
                                            <input type="text" pInputText placeholder="Formation"
                                                [(value)]="user.formation">
                                        </ng-template>
                                        <ng-template pTemplate="output">
                                            {{ user.formation}}
                                        </ng-template>
                                    </p-cellEditor>
                                </td>
                                <td>
                                    {{ user.type_form | titlecase}}
                                </td>
                                <td pEditableColumn>
                                    <p-cellEditor>
                                        <ng-template pTemplate="input">
                                            <input type="text" pInputText placeholder="Campus"
                                                [(value)]="user.campus_choix_1">
                                        </ng-template>
                                        <ng-template pTemplate="output">
                                            {{ user.campus_choix_1}}
                                        </ng-template>
                                    </p-cellEditor>
                                </td>
                                <td pEditableColumn>
                                    <p-cellEditor>
                                        <ng-template pTemplate="input">
                                            <input type="text" pInputText placeholder="Formation"
                                                [(value)]="user.formation">
                                        </ng-template>
                                        <ng-template pTemplate="output">
                                            {{ user.formation}}
                                        </ng-template>
                                    </p-cellEditor>
                                </td>
                                <td>
                                    {{ user.groupe}}
                                </td>
                                <td pEditableColumn>
                                    <p-cellEditor>
                                        <ng-template pTemplate="input">
                                            <p-dropdown [options]="typeFormationDropdown" optionValue="value"
                                                optionLabel="value" autoWidth="false" placeholder="Choisissez un rythme"
                                                [style]="{'width':'100%'}" ppendTo="body"
                                                [(ngModel)]="user.rythme_formation"></p-dropdown>
                                        </ng-template>
                                        <ng-template pTemplate="output">
                                            {{ user.rythme_formation}}
                                        </ng-template>
                                    </p-cellEditor>
                                </td>
                                <td>
                                    <i style="padding-left: 3%;color: green;" class="pi pi-save m-1"
                                        (click)="onSelectEtat(user.etat_dossier,user);"
                                        pTooltip="Sauvegardez les modification" aria-hidden="true"
                                        tooltipPosition="bottom"></i>
                                </td>

                            </tr>


                        </ng-template>

                    </p-table>
                    <h5 style="color: rgb(48, 121, 230);font-weight: bold;">
                        Source
                    </h5>
                    <p-table responsiveLayout="scroll">
                        <ng-template pTemplate="header">
                            <tr>
                                <th>Source</th>
                                <th>Commercial </th>
                                <th>Adresse mail</th>
                                <th>Téléphone</th>
                                <th>Action</th>
                            </tr>
                        </ng-template>
                        <ng-template pTemplate="emptymessage">
                            <tr>
                                <td pEditableColumn>
                                    <p-cellEditor>
                                        <ng-template pTemplate="input">
                                            <input type="text" pInputText placeholder="Formation"
                                                [(value)]="user.source">
                                        </ng-template>
                                        <ng-template pTemplate="output">
                                            {{ user.source}}
                                        </ng-template>
                                    </p-cellEditor>
                                </td>
                                <td>
                                    {{ commercialOwned?.user_id?.firstname}} {{ commercialOwned?.user_id?.lastname}}
                                </td>
                                <td>
                                    {{ commercialOwned?.user_id?.email}}
                                </td>
                                <td>
                                    {{ commercialOwned?.user_id?.indicatif}} {{ commercialOwned?.user_id?.phone}}
                                </td>

                                <td>
                                    <i style="padding-left: 3%;color: green;" class="pi pi-save m-1"
                                        (click)="onSelectEtat(user.etat_dossier,user);"
                                        pTooltip="Sauvegardez les modification" aria-hidden="true"
                                        tooltipPosition="bottom"></i>
                                </td>

                            </tr>


                        </ng-template>

                    </p-table>
                    </td>
                    </tr>
                </ng-template>

                </p-table>
                </ng-template>
                <ng-template let-car pTemplate="gridItem">
                    <div class="col-12 md:col-4" *ngFor="let prospect of prospectI">
                        <div class="offre-card row grid mt-3">
                            <div class="col-5 card-right">

                                <div class="img-card"
                                    style="background-image: url('../../../assets/images/imatch/male.png');">
                                </div>
                                <p>{{prospect?.customid}}</p>
                            </div>
                            <div class="col-7 card-right">
                                <div style="text-align: right;">
                                    <p>{{prospect.date_creation|date:'dd MMMM yy'}}</p>
                                </div>
                                <div class="offre-card-main">
                                    <h4 class="offre-card-title">
                                        {{prospect.user_id.firstname}} {{prospect.user_id.lastname}}</h4>
                                    <p class="offre-card-lieu"> {{prospect?.campus_choix_1 }} -
                                        {{prospect?.user_id?.pays_adresse}} - {{prospect?.formation }}
                                    </p>
                                </div>
                                <!--<a class="offres-btns postuler" [badge]="dicOffreNB[annonce._id]"
                            (click)="showPostuler = true; annonceSelected = annonce"><i
                                class="pi pi-arrow-right"></i>Postuler</a>-->

                            </div>
                            <div class="col-12" style="text-align: center;"
                                [ngClass]="{'insc-def':prospect.phase_candidature=='Inscription définitive','non-traite':prospect.phase_candidature=='Non traité','other':(prospect.phase_candidature!='Non traité' && prospect.phase_candidature!='Inscription définitive' )}">
                                <p>{{prospect.phase_candidature}}</p>
                            </div>
                            <div class="col-12 grid">
                                <div class="col-4">
                                    <p-button label="Admission" icon="pi pi-users" [style]="{'width':'100%'}"
                                        (click)="onshowDossier(prospect)" autoWidth="false"></p-button>
                                </div>
                                <div class="col-4">
                                    <p-button label="Document" icon="pi pi-file" [style]="{'width':'100%'}"
                                        (click)="AddDocumentOnglet(prospect);" autoWidth="false"></p-button>
                                </div>

                                <div class="col-4">
                                    <p-button label="Détail" icon="pi pi-briefcase" [style]="{'width':'100%'}"
                                        (click)="onshowDossier(prospect)" autoWidth="false"></p-button>
                                </div>

                            </div>
                        </div>
                    </div>
                </ng-template>
            </p-dataView>

        </p-tabPanel>
        <p-tabPanel header="Réinscription">
            <div *ngIf="shownewRIForm" class="col-12 card">
                <h4 style="text-align: center;"> Réinscription </h4>
                <div style="text-align: center;">
                    <small>Tous les champs marqués d'un astérisque <span style="color: red;"> * </span> sont
                        obligatoires</small><br>
                </div>
                <br>
                <form class="p-fluid p-formgrid grid" (ngSubmit)="addNewProspect()" [formGroup]="RIForm">
                    <h5 class="col-12" style="text-align: center;">Etudiant</h5> <br>
                    <div class="field col-12 md:col-12">
                        <label For="etudiant">Etudiant <span style="color:red"> *</span></label>
                        <p-dropdown [options]="typeList" placeholder="Choisissez l'étudiant"
                            (onChange)="onSelectEtudiat()" formControlName="etudiant"></p-dropdown>
                    </div>


                    <div class="field col-12 md:col-2">
                        <label For="civilite">Civilité<span style="color: red;"> * </span></label>
                        <p-dropdown [options]="civiliteList" optionLabel="value" optionDisabled="actif"
                            placeholder="Choisissez une civilité" formControlName="civilite"></p-dropdown>
                    </div>
                    <div class="field col-12 md:col-5">
                        <label For="nom">Nom <span style="color: red;"> * </span></label>
                        <input pInputText id="nom" type="text" placeholder="Entrez votre nom"
                            formControlName="lastname" />
                    </div>
                    <div class="field col-12 md:col-5">
                        <label For="prenom">Prénom <span style="color: red;"> * </span></label>
                        <input pInputText id="prenom" type="text" placeholder="Entrez votre prénom"
                            formControlName="firstname" />
                    </div>
                    <div class="field col-12 md:col-6">
                        <label For="date_naissance">Date de naissance <span style="color: red;"> *
                            </span></label>
                        <input type="date" formControlName="date_naissance" pInputText />
                    </div>
                    <div class="field col-12 md:col-6">
                        <label>Pays de résidence :<span style="color:red"> *</span></label><br>
                        <p-dropdown formControlName="pays" [options]="paysList" placeholder="Pays" optionLabel="value"
                            emptyFilterMessage="Pas de pays trouvé" filterPlaceholder="Pays" filter="true"
                            optionDisabled="actif"></p-dropdown>
                    </div>
                    <div class="field col-12 md:col-6">
                        <label For="nationalite">Nationalité <span style="color: red;"> * </span></label>
                        <p-dropdown formControlName="nationalite" [options]="nationList" optionLabel="label"
                            emptyFilterMessage="Pas de nationalité trouvé" filterPlaceholder="Nationalité"
                            filter="true"></p-dropdown>
                    </div>
                    <h5 class="col-12" style="text-align: center;">Contact</h5> <br>
                    <div class="field col-12 md:col-3">
                        <label For="indicatif">Indicatif <span style="color: red;"> * </span></label>
                        <input pInputText id="indicatif" type="text" placeholder="+33" formControlName="indicatif" />
                    </div>
                    <div class="field col-12 md:col-9">
                        <label For="telephone">Numéro de téléphone <span style="color: red;"> *
                            </span></label>
                        <input pInputText id="telephone" type="number" placeholder="Entrez votre numéro de téléphone"
                            formControlName="phone" />
                    </div>
                    <div class="field col-12 md:col-6">

                        <label>Email :<span style="color:red"> *</span></label>
                        <input type="email" formControlName="email_perso" placeholder="Email" (blur)="verifEmailInBD()"
                            pInputText>
                    </div>
                    <div class="field col-12 md:col-6">

                        <label>Numéro rue:<span style="color:red"> *</span></label>
                        <input formControlName="rue" placeholder="rue" pInputText>
                    </div>
                    <div class="field col-12 md:col-6">

                        <label>ville:<span style="color:red"> *</span></label>
                        <input formControlName="ville" placeholder="ville" pInputText>
                    </div>
                    <div class="field col-12 md:col-6">

                        <label>code postale:<span style="color:red"> *</span></label>
                        <input formControlName="codep" placeholder="code postale" pInputText>
                    </div>


                    <h5 class="col-12" style="text-align: center;">Choix académique</h5><br>
                    <div class="field col-12 md:col-12">
                        <label For="role">Ecole <span style="color:red"> *</span></label>
                        <p-dropdown [options]="EcoleListRework" placeholder="Choisissez l'école du lead"
                            (onChange)="onSelectEcole()" formControlName="ecole"></p-dropdown>
                    </div>
                    <div class="field col-12">
                        <label>Choix du campus <span style="color: red;"> * </span></label>
                        <p-dropdown [options]="campusDropdown" optionLabel="value" formControlName="campus"
                            placeholder="Choisissez un campus">
                        </p-dropdown>
                    </div>

                    <div class="field col-12 md:col-12">
                        <label>Choix de la rentrée <span style="color: red;"> * </span></label>
                        <p-dropdown [options]="rentreeList" formControlName="rentree_scolaire"
                            placeholder="Choisissez une rentrée" placeholder="Choisissez la rentrée scolaire">
                        </p-dropdown>
                    </div>

                    <!--<div class="field col-12 md:col-4">
                        <label>Choix du programme <span style="color: red;"> * </span></label>
                        <p-dropdown [options]="programList" optionLabel="value" formControlName="programme"
                            placeholder="Choisissez un programme">
                        </p-dropdown>
                    </div>-->
                    <div class="field col-12 md:col-12" *ngIf="newLeadForm.value.programme.value=='Programme Anglais'">
                        <label For="formation">Choix de la formation <span style="color: red;">
                                *</span></label>
                        <p-dropdown [options]="programEnDropdown" placeholder="Choose a english program"
                            autoWidth="false" [filter]="true" [group]="true" [style]="{'width':'100%'}"
                            formControlName="formation"></p-dropdown>
                    </div>
                    <div class="field col-12 md:col-12" *ngIf="newLeadForm.value.programme.value=='Programme Français'">
                        <label For="programme_fr">Choix de la formation <span style="color: red;"> *
                            </span></label>
                        <p-dropdown [options]="programeFrDropdown" placeholder="Choissiez un programme français"
                            [filter]="true" [group]="true" [style]="{'width':'100%'}" autoWidth="false"
                            formControlName="formation"></p-dropdown>
                    </div>
                    <div class="field col-12 md:col-12">
                        <label For="rythme">Rythme de la formation <span style="color: red;"> *
                            </span></label>
                        <p-dropdown [options]="typeFormationDropdown" optionLabel="value" autoWidth="false"
                            placeholder="Choisissez un rythme" [style]="{'width':'100%'}"
                            formControlName="rythme_formation"></p-dropdown>
                    </div>

                    <div class="field col-12 md:col-6" *ngIf="!isPartenaireExterne">
                        <label For="role">Source <span style="color:red"> *</span></label> <!--SI INTERNE-->
                        <p-dropdown [options]="sourceList" placeholder="Choisissez la provenance du lead"
                            (onChange)="changeSource($event.value)" formControlName="source"></p-dropdown>
                    </div>
                    <div *ngIf="!itslead" class="field col-12 md:col-6"> <!--SI INTERNE-->
                        <label For="role">Commercial</label>
                        <p-dropdown [options]="commercialList" filter="true"
                            placeholder="Choisissez le commercial qui a ajouté le lead"
                            formControlName="commercial"></p-dropdown>
                    </div>
                    <div *ngIf="itslead" class="field col-12 md:col-6">
                        <label>Nom et prénom :<span style="color:red"> *</span></label>
                        <input formControlName="nomlead" placeholder="Nom et Prénom" pInputText>
                    </div> <br>
                    <div style="justify-content: right;">
                        <button pButton type="submit" label="Ajouter"
                            [disabled]="(newLeadForm.invalid && !isPartenaireExterne) || (!newLeadForm.value.ecole)"></button>
                    </div>
                </form>
            </div>
            <div class="grid ">

                <div class="md:col-1 col-6" style="text-align: center;">
                    <button pButton label="Filtrer" class="p-button" icon="pi pi-filter" autoWidth="false"
                        [style]="{'width':'100%'}" (click)="displayFilter=true"></button>
                </div>
                <div class="md:col-1 col-6" style="text-align: center;">
                    <button pButton label="Vider&nbsp;" class="p-button" icon="pi pi-filter-slash" autoWidth="false"
                        [style]="{'width':'100%'}" (click)="clearFilter()"></button>
                </div>
                <div class="md:col-3 col-9" style="text-align: center;">
                    <input pInputText type="text" style="width: 100%;"
                        (input)="dt1.filterGlobal($event.target.value, 'contains')" placeholder="Recherche" />
                </div>
                <div class="md:col-5 col-9 "></div>
                <div class="md:col-1 col-9 ">
                    <button pButton pRipple (click)="shownewLeadForm=true" icon="pi pi-plus" class="mr-2 mb-2"></button>
                </div>
            </div>

        </p-tabPanel>
        <p-tabPanel style="width: 100%;"
            header="DOSSIER - {{PROSPECT?.user_id?.firstname}} {{PROSPECT?.user_id?.lastname}}"
            *ngFor="let PROSPECT of proscteList" [closable]="true">
            <div>
                <p-accordion [(activeIndex)]="selectedTabIndex1">
                    <p-accordionTab>
                        <ng-template pTemplate="header">
                            <div style="display: inline;">
                                <span style="font-weight: bold;">ETAPE 1</span> &nbsp;
                                <span style="font-weight: normal;">Dossier 
                                </span>
                                <i style="color: red;" class="pi pi-times"
                                    *ngIf="!ticket || ticket.length==0 || ticket.statut!='Traité'"></i>
                                <!-- Si Ticket n'est pas traité-->
                                <i style="color: green;" class="pi pi-check"
                                    *ngIf="ticket && ticket.length!=0 && ticket.statut=='Traité'"></i>
                            </div>
                        </ng-template>
                        <p-dialog header="Affecter un agent à ce ticket" [(visible)]="visible"
                            [style]="{width: '50vw'}">

                            <form [formGroup]="formAffectation" class="p-fluid p-formgrid grid col-12">
                                <div class="field col-6">
                                    <label>Agent: </label>
                                    <p-dropdown autoWidth="false" [style]="{'width':'100%'}" [options]="dropdownMember"
                                        formControlName="agent_id" filter="true"
                                        placeholder="Choisissez un membre"></p-dropdown>
                                </div>
                                <div class="field col-6">
                                    <label>DDL: </label>
                                    <input pInputText type="date" formControlName="date_limite" />
                                </div>
                                <div class="field col-12">
                                    <label For="description">Note de l'affectation <span style="color: red;"> *
                                        </span></label>
                                    <textarea pInputTextarea placeholder="Bon courage"
                                        formControlName="note_assignation" autoResize rows="3" cols="30"></textarea>
                                </div>
                                <div class="col-12">
                                    <p-button [style]="{'width':'100%'}" autoWidth="false" (onClick)="onAffectation()"
                                        label="Affecter cette agent" [disabled]="formAffectation.invalid"></p-button>
                                </div>
                            </form>
                        </p-dialog>

                        <p-table #dt1 [value]="ticket" dataKey="_id" responsiveLayout="scroll"
                            [globalFilterFields]="['nom', 'choix', 'rythme']" [rows]="8" [pageLinks]="5"
                            [paginator]="true" rowExpandMode="single" [totalRecords]=""
                            styleClass="p-datatable-gridlines">
                            <ng-template pTemplate="header">
                                <tr>
                                    <th style="width: 5em"></th>
                                    <th pSortableColumn="id">
                                        ID Ticket <p-sortIcon field="id"> </p-sortIcon>
                                    </th>
                                    <th pSortableColumn="nom">
                                        Statut <p-sortIcon field="nom"> </p-sortIcon>
                                    </th>
                                    <th pSortableColumn="choix">
                                        Assigné à <p-sortIcon field="choix"> </p-sortIcon>
                                    </th>
                                    <th pSortableColumn="rythme">
                                        Traité le <p-sortIcon field="rythme"> </p-sortIcon>
                                    </th>
                                    <th>Action</th>
                                </tr>
                            </ng-template>
                            <ng-template pTemplate="body" let-ticket>

                                <tr>
                                    <td>
                                        <button type="button" pButton pRipple [pRowToggler]="ticket"
                                            class="p-button-text p-button-rounded p-button-plain" [icon]="
                                    expanded
                                        ? 'pi pi-chevron-down'
                                        : 'pi pi-chevron-right'
                                "></button>
                                    </td>
                                    <td>
                                        {{ ticket?.customid }}
                                    </td>
                                    <td>
                                        {{ ticket?.statut }}
                                    </td>
                                    <td>
                                        {{ ticket?.agent_id?.firstname}}
                                    </td>
                                    <td>

                                    </td>
                                    <td>
                                        <i style="padding-left: 3%;color: rgb(72, 72, 255);" class="pi pi-send m-1"
                                            (click)="showDialog(ticket); scrollToTop()" pTooltip="Affecter"
                                            aria-hidden="true" tooltipPosition="bottom"></i>
                                    </td>
                                </tr>
                            </ng-template>
                            <ng-template pTemplate="rowexpansion" let-user>
                                <tr>
                                    <td colspan="6">


                                        <p-table responsiveLayout="scroll">
                                            <ng-template pTemplate="header">
                                <tr>

                                    <th>Commentaire</th>
                                    <th>Commenté par </th>
                                    <th>Commenté le </th>


                                </tr>
                            </ng-template>
                            <ng-template pTemplate="emptymessage">
                                <tr>
                                    <td></td>
                                    <td>
                                        {{ user?.user_id?.firstname | titlecase }}
                                        {{ user?.user_id?.lastname | uppercase }}
                                    </td>
                                    <td>
                                        {{
                                        user?.date_naissance
                                        }}
                                    </td>

                                </tr>


                            </ng-template>

                        </p-table>

                        </ng-template>

                        </p-table>
                        <h4 style="text-align: center;" *ngIf="PROSPECT.etat_dossier === 'Complet'">Etat du
                            dossier <p-dropdown [options]="etat_dossierDropdown"
                                placeholder="Choisissez l'etat du dossier" [(ngModel)]="PROSPECT.etat_dossier"
                                (onChange)="onSelectEtat($event,PROSPECT)"></p-dropdown>
                        </h4>
                        <h4 style="text-align: center;"
                            *ngIf="PROSPECT.etat_dossier === 'En attente' || !PROSPECT.etat_dossier">Etat
                            du dossier <p-dropdown [options]="etat_dossierDropdown"
                                placeholder="Choisissez l'etat du dossier" [(ngModel)]="PROSPECT.etat_dossier"
                                (onChange)="onSelectEtat($event,PROSPECT)"></p-dropdown> </h4>
                        <h4 style="text-align: center;" *ngIf="PROSPECT.etat_dossier === 'Manquant'">Etat du
                            dossier <p-dropdown [options]="etat_dossierDropdown"
                                placeholder="Choisissez l'etat du dossier" [(ngModel)]="PROSPECT.etat_dossier"
                                (onChange)="onSelectEtat($event,PROSPECT)"></p-dropdown>
                        </h4>
                        <div class="col-12">
                            <input type="file" (change)="uploadFile($event.target.files)" id="selectedFile"
                                #selectedFile style="display: none;" accept=".png, .jpg, .jpeg, .jfif" pInputFile />
                            <input type="file" (change)="uploadOtherFile($event.target.files)" id="selectedFileOther"
                                #selectedFileOther style="display: none;" accept=".png, .jpg, .jpeg, .jfif"
                                pInputFile />
                        </div>
                        <a href="javascript:void(0)" (click)="onshowDocuments()">Afficher le dossier -></a>
                        <div class="card grid" *ngIf="PROSPECT && showDocuments">
                            <h3 class="col-12">Documents</h3>
                            <p class="col-12"
                                [ngClass]="{'green-border':PROSPECT.etat_dossier=== 'Complet','orange-border':(PROSPECT.etat_dossier!= 'Complet'||!PROSPECT.etat_dossier)}"
                                style="text-align: center;padding: 9px;">
                                Sans remplir tous les documents obligatoires, votre dossier ne sera pas traité par
                                l'équipe d'admission.<br>
                                Etat du dossier : <strong>{{PROSPECT.etat_dossier}}</strong>
                            </p>
                            <div class="card col-12 grid">
                                <div class="col-6">
                                    Je réside en France
                                    <p-checkbox [(ngModel)]="resideFr" [binary]="true" inputId="binary"></p-checkbox>
                                </div>
                                <div class="col-6">
                                    Je cherche une alternance
                                    <p-checkbox [(ngModel)]="alternance" [binary]="true" inputId="binary"></p-checkbox>
                                </div>
                            </div>
                            <p-table [value]="PROSPECT.documents_dossier" #dt1 dataKey="_id" class="col-12"
                                responsiveLayout="scroll" styleClass="p-datatable-gridlines">
                                <ng-template pTemplate="header">
                                    <tr>
                                        <th>Document</th>
                                        <th>Lien</th>
                                        <th>Action</th>
                                    </tr>
                                </ng-template>
                                <ng-template pTemplate="body" let-doc>
                                    <tr *ngIf="doc.nom!='Carte de séjour' || (alternance || resideFr)">
                                        <td>
                                            {{doc.nom}}
                                            <span style="color: red;"
                                                *ngIf="documentsObligatoires.includes(doc.nom) || doc.nom=='Copie Visa' || doc.nom=='Carte vitale ou attestation provisoire' || doc.nom=='Carte de séjour'">(Obligatoire)</span>
                                        </td>
                                        <td style="text-align: center;">
                                            <i *ngIf="doc.path" pTooltip="Télécharger le document"
                                                tooltipPosition="bottom" class="pi pi-file" (click)="downloadFile(doc)"
                                                style="margin-left: 2%;color: green;" aria-hidden="true"></i>
                                        </td>
                                        <td>
                                            <i pTooltip="Ajouter un fichier" tooltipPosition="bottom" class="pi pi-file"
                                                (click)="initUpload(doc)" style="margin-left: 2%;"
                                                aria-hidden="true"></i>
                                            <i pTooltip="Supprimer" style="margin-left: 2%; cursor: pointer;"
                                                class="pi pi-trash" (click)="delete(doc)" aria-hidden="true"></i>
                                        </td>
                                    </tr>
                                </ng-template>
                            </p-table>
                            <!--<h3 class="col-8">Autre documents</h3>
                            <div class="col-4">
                                <p-button [style]="{'width':'100%'}" (click)="addDoc()" icon="pi pi-plus"
                                    autoWidth="false" label="Ajouter un autre document"></p-button>
                            </div>
                            <p-table [value]="PROSPECT.documents_autre" #dt1 dataKey="_id" [rows]="8"
                                rowExpandMode="single" [rows]="8" [rowHover]="true" class="col-12" [paginator]="true"
                                [pageLinks]="5" [globalFilterFields]="['libelle','email','site']"
                                responsiveLayout="scroll" [filterDelay]="0" styleClass="p-datatable-gridlines">
                                <ng-template pTemplate="header">
                                    <tr>
                                        <th>Document</th>
                                        <th>Lien</th>
                                        <th>Action</th>
                                    </tr>
                                </ng-template>
                                <ng-template pTemplate="body" let-doc let-ri="rowIndex">
                                    <tr [pEditableRow]="doc">
                                        <td pEditableColumn>
                                            <p-cellEditor>
                                                <ng-template pTemplate="input">
                                                    <input type="text" pInputText [(ngModel)]="doc.nom">
                                                </ng-template>
                                                <ng-template pTemplate="output">
                                                    {{doc.nom}}
                                                </ng-template>
                                            </p-cellEditor>
                                        </td>
                                        <td>
                                            <i *ngIf="doc.path" pTooltip="Télécharger le document"
                                                tooltipPosition="bottom" class="pi pi-file"
                                                (click)="downloadOtherFile(doc)" style="margin-left: 2%;color: green;"
                                                aria-hidden="true"></i>
                                        </td>
                                        <td>
                                            <i pTooltip="Ajouter un fichier" tooltipPosition="bottom" class="pi pi-file"
                                                *ngIf="doc.nom!='Cliquer pour modifier le nom du document ici'"
                                                (click)="initUpload(doc,'selectedFileOther')" style="margin-left: 2%;"
                                                aria-hidden="true"></i>
                                            <i pTooltip="Supprimer" style="margin-left: 2%; cursor: pointer;"
                                                class="pi pi-trash" (click)="deleteOther(doc)" aria-hidden="true"></i>
                                        </td>
                                    </tr>
                                </ng-template>
                            </p-table>-->
                        </div>
                    </p-accordionTab>
                    <p-accordionTab>
                        <ng-template pTemplate="header">
                            <div style="display: inline;">
                                <span style="font-weight: bold;">ETAPE 2</span> &nbsp;
                                <span style="font-weight: normal;">Evaluation </span>
                                <i style="color: red;" class="pi pi-times"></i>
                                <!-- Dépend du Score -->
                            </div>
                        </ng-template>
                        <p-dialog header="Modifier l'évaluation" [(visible)]="visible_evaluation"
                            [style]="{width: '50vw'}">

                            <form [formGroup]="formAffectation" class="p-fluid p-formgrid grid col-12">
                                <div class="field col-6">
                                    <label>Evaluation </label>
                                    <p-dropdown autoWidth="false" [style]="{'width':'100%'}" [options]="dropdownMember"
                                        formControlName="agent_id" filter="true"
                                        placeholder="Choisissez un membre"></p-dropdown>
                                </div>
                                <div class="field col-6">
                                    <label>Score </label>
                                    <input pInputText type="number" formControlName="date_limite" />
                                </div>
                                <div class="field col-6">
                                    <label For="description">Durée <span style="color: red;"> *
                                        </span></label>
                                    <input pInputText type="number" formControlName="date_limite" />
                                </div>
                                <div class="field col-6">
                                    <label>date de passastion </label>
                                    <input pInputText type="date" formControlName="date_limite" />
                                </div>
                                <div class="field col-6">
                                    <label>date de l'envoi </label>
                                    <input pInputText type="date" formControlName="date_limite" />
                                </div>
                                <div class="field col-6">
                                    <label For="description">Durée <span style="color: red;"> *
                                        </span></label>
                                    <input pInputText type="number" formControlName="date_limite" />
                                </div>
                                <div class="col-12">
                                    <p-button [style]="{'width':'100%'}" autoWidth="false" (onClick)="onAffectation()"
                                        label="Enregistrer" [disabled]="formAffectation.invalid"></p-button>
                                </div>
                            </form>
                        </p-dialog>

                        <p-table #dt1 [value]="['']" dataKey="_id" responsiveLayout="scroll"
                            [globalFilterFields]="['nom', 'choix', 'rythme']" [rows]="8" [pageLinks]="5"
                            [paginator]="true" rowExpandMode="single" [totalRecords]=""
                            styleClass="p-datatable-gridlines">

                            <ng-template pTemplate="header">
                                <tr>
                                    <th pSortableColumn="id">
                                        Evaluation<p-sortIcon field="id"> </p-sortIcon>
                                    </th>
                                    <th pSortableColumn="nom">
                                        Score<p-sortIcon field="nom"> </p-sortIcon>
                                    </th>
                                    <th pSortableColumn="choix">
                                        Durée <p-sortIcon field="choix"> </p-sortIcon>
                                    </th>
                                    <th pSortableColumn="rythme">
                                        Date de l'envoie <p-sortIcon field="rythme"> </p-sortIcon>
                                    </th>
                                    <th pSortableColumn="decision">
                                        Date de passastion<p-sortIcon field="decision"> </p-sortIcon>
                                    </th>
                                    <th>Action</th>
                                </tr>
                            </ng-template>
                            <ng-template pTemplate="body" let-prospect>
                                <tr>
                                    <td>
                                        https
                                    </td>
                                    <td>
                                        %
                                    </td>
                                    <td>
                                        min
                                    </td>
                                    <td></td>
                                    <td></td>
                                    <td>
                                        <i style="padding-left: 3%;color: rgb(72, 72, 255);
                                " class="pi pi-pencil m-1" (click)="initEvaluation(prospect); scrollToTop()"
                                            pTooltip="Modifier" aria-hidden="true" tooltipPosition="bottom"></i>
                                        <i style="padding-left: 3%; color: rgb(255, 0, 0)" class="pi pi-trash m-1"
                                            (click)="deletePro(prospect)" pTooltip="Supprimer la formation"
                                            aria-hidden="true" tooltipPosition="bottom"></i>
                                    </td>
                                </tr>
                            </ng-template>
                        </p-table>
                        <br>
                        <p-button icon="pi pi-plus"></p-button>
                    </p-accordionTab>
                    <p-accordionTab>
                        <ng-template pTemplate="header">
                            <div style="display: inline;">
                                <span style="font-weight: bold;">ETAPE 3</span> &nbsp;
                                <span style="font-weight: normal;">Entretien

                                </span>
                                <i style="color: red;" class="pi pi-times"
                                    *ngIf="!ticket || ticket.length==0 || ticket.statut!='Traité'"></i>
                                <!-- Si Ticket n'est pas traité-->
                                <i style="color: green;" class="pi pi-check"
                                    *ngIf="ticket && ticket.length!=0 && ticket.statut=='Traité'"></i>
                            </div>
                        </ng-template>
                        <p-table #dt1 [value]="ticket" dataKey="_id" responsiveLayout="scroll"
                            [globalFilterFields]="['nom', 'choix', 'rythme']" [rows]="8" [pageLinks]="5"
                            [paginator]="true" rowExpandMode="single" [totalRecords]=""
                            styleClass="p-datatable-gridlines">
                            <ng-template pTemplate="header">
                                <tr>
                                    <th style="width: 5em"></th>
                                    <th pSortableColumn="id">
                                        ID Ticket <p-sortIcon field="id"> </p-sortIcon>
                                    </th>
                                    <th pSortableColumn="nom">
                                        Statut <p-sortIcon field="nom"> </p-sortIcon>
                                    </th>
                                    <th pSortableColumn="choix">
                                        Assigné à <p-sortIcon field="choix"> </p-sortIcon>
                                    </th>
                                    <th pSortableColumn="rythme">
                                        Traité le <p-sortIcon field="rythme"> </p-sortIcon>
                                    </th>
                                    <th>Action</th>
                                </tr>
                            </ng-template>
                            <ng-template pTemplate="body" let-ticket>

                                <tr>
                                    <td>
                                        <button type="button" pButton pRipple [pRowToggler]="ticket"
                                            class="p-button-text p-button-rounded p-button-plain" [icon]="
                                    expanded
                                        ? 'pi pi-chevron-down'
                                        : 'pi pi-chevron-right'
                                "></button>
                                    </td>
                                    <td>
                                        {{ ticket?.customid }}
                                    </td>
                                    <td>
                                        {{ ticket?.statut }}

                                    </td>
                                    <td>
                                        {{ ticket?.agent_id?.firstname}}
                                    </td>
                                    <td>

                                    </td>
                                    <td>
                                        <i style="padding-left: 3%;color: rgb(72, 72, 255);
                                " class="pi pi-send m-1" (click)="showDialog(ticket); scrollToTop()"
                                            pTooltip="Affecter" aria-hidden="true" tooltipPosition="bottom"></i>
                                    </td>
                                </tr>
                            </ng-template>
                            <ng-template pTemplate="rowexpansion" let-user>
                                <tr>
                                    <td colspan="6">


                                        <p-table responsiveLayout="scroll">
                                            <ng-template pTemplate="header">
                                <tr>

                                    <th>Commentaire</th>
                                    <th>Commenté par </th>
                                    <th>Commenté le </th>


                                </tr>
                            </ng-template>
                            <ng-template pTemplate="emptymessage">
                                <tr>
                                    <td></td>
                                    <td>

                                    </td>
                                    <td>

                                    </td>

                                </tr>


                            </ng-template>

                        </p-table>

                        </ng-template>

                        </p-table>
                        <h4>Compte rendu de l'entretien préalable à la formation </h4>
                        <br>
                        <form class="p-fluid p-formgrid grid" (ngSubmit)="addEntretien()" [formGroup]="entretienForm">
                            <div class="field col-12 md:col-6">
                                <label For="date_e">Date <span style="color: red;"> *
                                    </span></label>
                                <input type="date" formControlName="date_e" pInputText />
                            </div>
                            <div class="field col-12 md:col-6">
                                <label For="duree_e">Durée <span style="color:red"> *</span></label>
                                <input type="number" formControlName="duree_e" pInputText />
                            </div>
                            <div class="field col-12 md:col-6">
                                <label For="niveau">Niveau actuel de l'apprenat<span style="color: red;"> *
                                    </span></label>
                                <p-dropdown [options]="niveux_dropdown" [style]="{'width':'100%'}"
                                    placeholder="Entrez le niveau de l'apprenat" formControlName="niveau"></p-dropdown>
                            </div>
                            <div class="field col-12 md:col-6">
                                <label For="parcour">L'apprenant a-t-il déjà suivi un parcours en formation de la
                                    matière?<span style="color: red;"> * </span></label>
                                <input pInputText id="nom" type="text" formControlName="parcour" />
                            </div>
                            <div class="field col-12 md:col-12">
                                <label For="choix">Pourquoi avoir choisi cette formation <span style="color: red;"> *
                                    </span></label>
                                <textarea pInputTextarea formControlName="choix" autoResize rows="5"
                                    cols="30"></textarea>
                            </div>
                            <div class="col-12" style="text-align: center;">
                                <p-button [style]="{'max-width':'10%'}" autoWidth="false"
                                    (click)="addEntretien(prospect)">Enregistrer</p-button>
                            </div>
                        </form>
                    </p-accordionTab>
                    <p-accordionTab>
                        <ng-template pTemplate="header">
                            <div style="display: inline;">
                                <span style="font-weight: bold;">ETAPE 4</span> &nbsp;
                                <span style="font-weight: normal;">Décision&nbsp;
                                </span>
                                <i style="color: red;" class="pi pi-times"
                                    *ngIf="PROSPECT?.decision_admission!='Accepté'"></i>
                                <!-- depend du changement de la decision admission -->
                                <i style="color: green;" class="pi pi-check"
                                    *ngIf="PROSPECT?.decision_admission=='Accepté'"></i>
                            </div>
                        </ng-template>
                        <form class="p-fluid p-formgrid grid" (ngSubmit)="addNewProspect()" [formGroup]="DecisionForm">
                            <div class="field col-12 md:col-6">
                                <label For="decisoin_admission">Décision du conseil d'oriontation pédagogique<span
                                        style="color: red;"> *
                                    </span></label>
                                <p-dropdown [options]="decision_dropdown" [style]="{'width':'100%'}"
                                    formControlName="decisoin_admission"></p-dropdown>
                            </div>
                            <div class="field col-12 md:col-6">
                                <label For="date_d">Date <span style="color: red;"> *
                                    </span></label>
                                <input type="date" formControlName="date_d" pInputText />
                            </div>
                            <div class="field col-12 md:col-12">
                                <label For="explication">Explication<span style="color: red;"> *
                                    </span></label><br>
                                <textarea pInputTextarea formControlName="explication" autoResize rows="5"
                                    cols="50"></textarea>
                            </div>

                            <div class="col-12" style="text-align: center;">
                                <p-button [style]="{'max-width':'10%'}" autoWidth="false"
                                    (click)="adddicision(prospect)">Enregistrer</p-button>
                            </div>

                        </form>
                    </p-accordionTab>
                </p-accordion>
            </div>
        </p-tabPanel>
        <p-tabPanel style="width: 100%;" header="DOC - {{PROSPECT?.user_id?.firstname}} {{PROSPECT?.user_id?.lastname}}"
            [closable]="true" *ngFor="let PROSPECT of docProspectList">
            <div class="col-12 card">
                <p-accordion [(activeIndex)]="selectedTabIndex1">
                    <p-dialog header="Documents de Candidature" [(visible)]="visibleC">
                        <div class="col-12" *ngIf="showUploadFile!=null">
                            <div class="card">
                                <i class="pi pi-times-circle" style="float:right; color: red; cursor: pointer;"
                                    (click)="showUploadFile = null" aria-hidden="true"> </i>
                                <h3 *ngIf="showUploadFile.user_id" class="text-center" style="font-weight: bold;">
                                    Ajouter un
                                    document à : {{
                                    showUploadFile.user_id?.firstname }} {{
                                    showUploadFile.user_id?.lastname | uppercase }}
                                </h3>

                                <form class="p-fluid p-formgrid grid" [formGroup]="uploadAdminFileForm">
                                    <div class="field col-6">
                                        <label>Date de délivrance</label>
                                        <input type="date" formControlName="date" pInputText />
                                    </div>

                                    <div class="field col-6">
                                        <label>Note :</label>
                                        <textarea pInputTextarea formControlName="note"></textarea>
                                    </div>

                                    <div class="field col-12">
                                        <label>Type de document :</label>
                                        <p-dropdown [options]="documentDropdownc" formControlName="type"
                                            placeholder="Choisissez un type" filter="true">
                                            <br><br><br><br><br><br>
                                        </p-dropdown>
                                    </div>
                                    <div class="field col-12">
                                        <p-fileUpload (uploadHandler)="FileUploadAdmin($event)" mode="basic"
                                            customUpload="true" fileLimit="1" accept=".docx,.pdf,.doc,.jpg,.png,.jpeg"
                                            [disabled]="uploadAdminFileForm.invalid" maxFileSize="10000000"
                                            [auto]="true" #fileInput>
                                        </p-fileUpload>
                                    </div>

                                </form>
                            </div>
                        </div>
                    </p-dialog>
                    <p-accordionTab>
                        <ng-template pTemplate="header">
                            <div>
                                <span style="font-weight: bold;">CANDIDATURE</span> &nbsp;
                            </div>
                        </ng-template>

                        <div class="col-4">
                            <p-button [style]="{'width':'10%'}" (click)="visibleC=true;showUploadFile=PROSPECT;"
                                icon="pi pi-plus" autoWidth="false"></p-button>
                        </div>
                        <p-table #dt1 dataKey="_id" [rows]="8" [value]="DocumentsCandidature" rowExpandMode="single"
                            [rows]="8" [rowHover]="true" class="col-12" [paginator]="true" [pageLinks]="5"
                            [globalFilterFields]="['libelle','email','site']" responsiveLayout="scroll"
                            [filterDelay]="0" styleClass="p-datatable-gridlines">
                            <ng-template pTemplate="header">
                                <tr>
                                    <th>ID</th>
                                    <th>Type</th>
                                    <th>Date</th>
                                    <th>Lien</th>
                                    <th>Traité par</th>
                                    <th>Action</th>
                                </tr>
                            </ng-template>
                            <ng-template pTemplate="body" let-doc let-ri="rowIndex">
                                <tr>
                                    <td>{{doc?.custom_id}}</td>
                                    <td>{{doc?.type}}</td>
                                    <td>{{doc?.date|date:'dd MMMM yy'}}</td>
                                    <td>
                                        <a (click)="downloadAdminFile(doc.path,PROSPECT)">Télécharger</a>
                                    </td>
                                    <td>{{doc?.traited_by}}</td>
                                    <td>
                                        <i pTooltip="Ajouter un fichier" tooltipPosition="bottom" class="pi pi-file"
                                            *ngIf="doc.nom!='Cliquer pour modifier le nom du document ici'"
                                            (click)="initUpload(doc,'selectedFileOther')" style="margin-left: 2%;"
                                            aria-hidden="true"></i>
                                        <i pTooltip="Supprimer" style="margin-left: 2%; cursor: pointer;"
                                            class="pi pi-trash" (click)="deleteDocument(doc,ri)" aria-hidden="true"></i>
                                    </td>
                                </tr>
                            </ng-template>
                        </p-table>

                    </p-accordionTab>
                    <p-accordionTab>
                        <ng-template pTemplate="header">
                            <div>
                                <span style="font-weight: bold;">ADMISSIONS</span> &nbsp;
                            </div>

                        </ng-template>
                        <app-lead-dossier [PROSPECT_ID]="PROSPECT._id"></app-lead-dossier>
                    </p-accordionTab>
                    <p-accordionTab>
                        <p-dialog header="Documents du dossier administratif" [(visible)]="visibleADM">
                            <div class="col-12" *ngIf="showUploadFile!=null">
                                <div class="card">
                                    <i class="pi pi-times-circle" style="float:right; color: red; cursor: pointer;"
                                        (click)="showUploadFile = null" aria-hidden="true"> </i>
                                    <h3 *ngIf="showUploadFile.user_id" class="text-center" style="font-weight: bold;">
                                        Ajouter un
                                        document à : {{
                                        showUploadFile.user_id?.firstname }} {{
                                        showUploadFile.user_id?.lastname | uppercase }}
                                    </h3>

                                    <form class="p-fluid p-formgrid grid" [formGroup]="uploadAdminFileForm">
                                        <div class="field col-6">
                                            <label>Date de délivrance</label>
                                            <input type="date" formControlName="date" pInputText />
                                        </div>

                                        <div class="field col-6">
                                            <label>Note :</label>
                                            <textarea pInputTextarea formControlName="note"></textarea>
                                        </div>

                                        <div class="field col-12">
                                            <label>Type de document :</label>
                                            <p-dropdown [options]="documentDropdowna" formControlName="type"
                                                placeholder="Choisissez un type" filter="true"></p-dropdown>
                                            <br><br><br><br><br><br>
                                        </div>
                                        <div class="field col-12">
                                            <p-fileUpload (uploadHandler)="FileUploadAdmin($event)" mode="basic"
                                                customUpload="true" fileLimit="1"
                                                accept=".docx,.pdf,.doc,.jpg,.png,.jpeg"
                                                [disabled]="uploadAdminFileForm.invalid" maxFileSize="10000000"
                                                [auto]="true" #fileInput>
                                            </p-fileUpload>
                                        </div>

                                    </form>
                                </div>
                            </div>
                        </p-dialog>
                        <ng-template pTemplate="header">
                            <div>
                                <span style="font-weight: bold;">DOSSIER ADMINISTRATIF</span> &nbsp;
                            </div>
                        </ng-template>

                    </p-accordionTab>
                    <p-accordionTab>
                        <ng-template pTemplate="header">
                            <div>
                                <span style="font-weight: bold;">DOSSIER PROFESSIONNEL</span> &nbsp;

                            </div>
                        </ng-template>
                        <p-dialog header="Documents du dossier professionel" [(visible)]="visiblep">
                            <div class="col-12" *ngIf="showUploadFile!=null">
                                <div class="card">
                                    <i class="pi pi-times-circle" style="float:right; color: red; cursor: pointer;"
                                        (click)="showUploadFile = null" aria-hidden="true"> </i>
                                    <h3 *ngIf="showUploadFile.user_id" class="text-center" style="font-weight: bold;">
                                        Ajouter un
                                        document à : {{
                                        showUploadFile.user_id?.firstname }} {{
                                        showUploadFile.user_id?.lastname | uppercase }}
                                    </h3>

                                    <form class="p-fluid p-formgrid grid" [formGroup]="uploadAdminFileForm">
                                        <div class="field col-6">
                                            <label>Date de délivrance</label>
                                            <input type="date" formControlName="date" pInputText />
                                        </div>

                                        <div class="field col-6">
                                            <label>Note :</label>
                                            <textarea pInputTextarea formControlName="note"></textarea>
                                        </div>

                                        <div class="field col-12">
                                            <label>Type de document :</label>
                                            <p-dropdown [options]="documentDropdownpro" formControlName="type"
                                                placeholder="Choisissez un type" filter="true"></p-dropdown>
                                            <br><br><br><br><br><br>
                                        </div>
                                        <br><br><br><br><br><br>
                                        <div class="field col-12">
                                            <p-fileUpload (uploadHandler)="FileUploadAdmin($event)" mode="basic"
                                                customUpload="true" fileLimit="1"
                                                accept=".docx,.pdf,.doc,.jpg,.png,.jpeg"
                                                [disabled]="uploadAdminFileForm.invalid" maxFileSize="10000000"
                                                [auto]="true" #fileInput>
                                            </p-fileUpload>
                                        </div>

                                    </form>
                                </div>
                            </div>
                        </p-dialog>
                        <div class="col-4">
                            <p-button [style]="{'width':'10%'}"
                                (click)="addDoc();visiblep=true;showUploadFile=showDocAdmin;" icon="pi pi-plus"
                                autoWidth="false"></p-button>
                        </div>
                        <p-table #dt1 dataKey="_id" [rows]="8" [value]="DoccumentProfessionel" rowExpandMode="single"
                            [rows]="8" [rowHover]="true" class="col-12" [paginator]="true" [pageLinks]="5"
                            [globalFilterFields]="['libelle','email','site']" responsiveLayout="scroll"
                            [filterDelay]="0" styleClass="p-datatable-gridlines">
                            <ng-template pTemplate="header">
                                <tr>
                                    <th>ID</th>
                                    <th>Type</th>
                                    <th>Date</th>
                                    <th>Lien</th>
                                    <th>Traité par</th>
                                    <th>Action</th>
                                </tr>
                            </ng-template>
                            <ng-template pTemplate="body" let-doc let-ri="rowIndex">
                                <tr>
                                    <td>{{doc?.custom_id}}</td>
                                    <td>{{doc?.type}}</td>
                                    <td>{{doc?.date|date:'dd MMMM yy'}}</td>
                                    <td>
                                        <a (click)="downloadAdminFile(doc.path)">Télécharger</a>
                                    </td>
                                    <td>{{doc?.traited_by}}</td>
                                    <td>
                                        <i pTooltip="Ajouter un fichier" tooltipPosition="bottom" class="pi pi-file"
                                            *ngIf="doc.nom!='Cliquer pour modifier le nom du document ici'"
                                            (click)="initUpload(doc,'selectedFileOther')" style="margin-left: 2%;"
                                            aria-hidden="true"></i>
                                        <i pTooltip="Supprimer" style="margin-left: 2%; cursor: pointer;"
                                            class="pi pi-trash" (click)="deleteDocument(doc,ri)" aria-hidden="true"></i>
                                    </td>
                                </tr>
                            </ng-template>
                        </p-table>
                    </p-accordionTab>
                </p-accordion>
            </div>
            <div class="col-12" *ngIf="showUploadFile!=null">
                <div class="card">
                    <i class="pi pi-times-circle" style="float:right; color: red; cursor: pointer;"
                        (click)="showUploadFile = null" aria-hidden="true"> </i>
                    <h3 *ngIf="showUploadFile.user_id" class="text-center" style="font-weight: bold;">Ajouter un
                        document à : {{
                        showUploadFile.user_id?.firstname }} {{
                        showUploadFile.user_id?.lastname | uppercase }}
                    </h3>

                    <form class="p-fluid p-formgrid grid" [formGroup]="uploadAdminFileForm">
                        <div class="field col-6">
                            <label>Date de délivrance</label>
                            <input type="date" formControlName="date" pInputText />
                        </div>
                        <div class="field col-6">
                            <label>Nom du Fichier</label>
                            <input type="text" formControlName="nom" pInputText />
                        </div>
                        <div class="field col-6">
                            <label>Note :</label>
                            <textarea pInputTextarea formControlName="note"></textarea>
                        </div>
                        <div class="field col-6">
                            <label>Traité par :</label>
                            <p-dropdown [options]="agentSourcingList" formControlName="traited_by" optionValue="label"
                                optionLabel="label" placeholder="Choisissez un agent" [group]="true"
                                filter="true"></p-dropdown>
                        </div>
                        <div class="field col-12">
                            <label>Type de document :</label>
                            <p-dropdown [options]="documentDropdown" formControlName="type"
                                placeholder="Choisissez un type" filter="true"></p-dropdown>
                        </div>
                        <div class="field col-12">
                            <p-fileUpload (uploadHandler)="FileUploadAdmin($event)" mode="basic"
                                chooseLabel="Ajouter un Document" customUpload="true" fileLimit="1"
                                accept=".docx,.pdf,.doc,.jpg,.png,.jpeg" [disabled]="uploadAdminFileForm.invalid"
                                maxFileSize="10000000" [auto]="true" #fileInput>
                            </p-fileUpload>
                        </div>

                    </form>
                </div>
            </div>
        </p-tabPanel>
        <p-tabPanel style="width: 100%;" *ngFor="let PROSPECT of candidatureList" [closable]="true"
            header="CANDIDATURE - {{PROSPECT?.user_id?.firstname}} {{PROSPECT?.user_id?.lastname}}">
            <app-lead-candidature [PROSPECTID]="PROSPECT._id"></app-lead-candidature>
        </p-tabPanel>
    </p-tabView>
</div>
<p-sidebar [(visible)]="displayFilter" position="right" [style]="{width:'30em'}">
    <h3>Filtres</h3>
    <div class="grid grid-nogutter flex-column md:flex-row justify-content-between mb-2">
        <p-dropdown [style]="{'width':'27em'}" [options]="rythme_filtre" filter="true" [(ngModel)]="filtre_value.rythme"
            (onChange)="dt1.filter($event.value, 'rythme_formation', 'equals')" emptyFilterMessage="Type non trouvé"
            filterPlaceholder="Type"></p-dropdown><br><br><br><br><br>
        <p-dropdown [style]="{'width':'27em'}" [options]="campusfiltre" filter="true"
            (onChange)="dt1.filter($event.value, 'campus_choix_1', 'equals');"
            emptyFilterMessage="Role non trouvé" filterPlaceholder="Rôle"></p-dropdown><br><br><br><br><br>
        <p-dropdown [style]="{'width':'27em'}" [options]="rentreeFiltere" filter="true"
            (onChange)="dt1.filter($event.value, 'rentree_scolaire', 'equals');"
            emptyFilterMessage="Role non trouvé" filterPlaceholder="Rôle"></p-dropdown><br><br><br><br><br>
        <p-dropdown [style]="{'width':'27em'}" [options]="EcoleFiltre" filter="true"
            (onChange)="dt1.filter($event.value,'type_form', 'equals')" emptyFilterMessage="Role non trouvé"
            filterPlaceholder="Rôle"></p-dropdown><br><br><br><br><br>
        <p-dropdown [style]="{'width':'27em'}" [options]="formationsFitre" filter="true"
            (onChange)="dt1.filter($event.value,'formation', 'equals')" emptyFilterMessage="Role non trouvé"
            filterPlaceholder="Rôle"></p-dropdown><br><br><br><br><br>
        <p-dropdown [style]="{'width':'27em'}" [options]="filterPhase" filter="true"
            (onChange)="dt1.filter($event.value,'phase_candidature', 'equals');" [(ngModel)]="filtre_value.phase"
            emptyFilterMessage="Role non trouvé" filterPlaceholder="Rôle"></p-dropdown><br><br><br><br><br>
        <p-dropdown [style]="{'width':'27em'}" [options]="sourceFiltre" filter="true"
            (onChange)="dt1.filter($event.value, 'source', 'equals');"
            emptyFilterMessage="Role non trouvé" filterPlaceholder="Rôle"></p-dropdown><br><br><br><br><br>

        <div></div>
        <!--<p-dropdown [options]="userFilter" autoWidth="false" [style]="{'width':'27em'}" filter="true" class="mb-2"
			[(ngModel)]="filtre_value.user" (onChange)="updateFilter()"></p-dropdown>-->
        <button pButton label="Valider les filtres" class="p-button" icon="pi pi-filter"
            (click)="displayFilter = false"></button>
        <button pButton label="Vider le filtre" class="p-button" icon="pi pi-filter-slash"
            (click)="clearFilter()"></button>
    </div>
</p-sidebar>
<p-dialog header="Paiements" [(visible)]="seePaiements" [modal]="true">
    <input type="file" (change)="FileUploadPaiement($event.target.files)" id="UploadPaiement" #UploadPaiement
        style="display: none;" pInputFile />
    <h5 *ngIf="showPaiement?.user_id" style="font-weight: bold;color:#37BAD4"> Paiement effectués par {{
        showPaiement?.user_id?.firstname }} {{
        showPaiement?.user_id?.lastname | uppercase }}
    </h5>
    <div>
        <p-dropdown [options]="typeFormationDropdown" optionLabel="value" optionValue="value" autoWidth="false"
            *ngIf="showPaiement" placeholder="Choisissez un rythme" [style]="{'width':'100%'}"
            [(ngModel)]="showPaiement.rythme_formation"></p-dropdown>
    </div>
    <p>&nbsp;</p>
    <div class="grid">
        <p-table #dt2 dataKey="ID" [value]="payementList" class="col-12" styleClass="p-datatable-gridlines">
            <ng-template pTemplate="header">
                <tr>
                    <th pSortableColumn="ID" style="text-align: center;"> ID <p-sortIcon field="ID">
                        </p-sortIcon>
                    </th>
                    <th pSortableColumn="montant" style="text-align: center;"> Montant <p-sortIcon
                            field="montant"></p-sortIcon>
                    </th>
                    <th pSortableColumn="type" style="text-align: center;"> Modalité <p-sortIcon field="type">
                        </p-sortIcon>
                    </th>
                    <th pSortableColumn="motif" style="text-align: center;"> Motif <p-sortIcon field="motif">
                        </p-sortIcon>
                    </th>
                    <th pSortableColumn="date" style="text-align: center;"> Date d'encaissement <p-sortIcon
                            field="date"></p-sortIcon>
                    </th>

                    <th pSortableColumn="doc" style="text-align: center;">
                        Lien
                    </th>
                    <th>
                        <div class="flex justify-content-between align-items-center">
                            Action
                        </div>
                    </th>
                </tr>
            </ng-template>
            <ng-template pTemplate="body" let-paiement let-ri="rowIndex">
                <tr [pEditableRow]="paiement">
                    <td>
                        {{paiement?.ID}}
                    </td>
                    <td pEditableColumn>
                        <p-cellEditor>
                            <ng-template pTemplate="input">
                                <input type="number" (change)="changeMontant(ri,$event,'montant')"
                                    [(value)]="paiement.montant" placeholder="20" value="0" pInputText>
                            </ng-template>
                            <ng-template pTemplate="output">
                                {{paiement.montant}}€
                            </ng-template>
                        </p-cellEditor>
                    </td>
                    <td pEditableColumn>
                        <p-cellEditor>
                            <ng-template pTemplate="input">
                                <p-dropdown [options]="typePaiement" [(ngModel)]="paiement.type"
                                    placeholder="Choisissez la méthode de paiement"
                                    (onChange)="changeMontant(ri,$event,'type')"></p-dropdown>
                            </ng-template>
                            <ng-template pTemplate="output">
                                {{paiement.type}}
                            </ng-template>
                        </p-cellEditor>
                    </td>
                    <td pEditableColumn>
                        <p-cellEditor>
                            <ng-template pTemplate="input">
                                <p-dropdown [options]="typeMotif" [(ngModel)]="paiement.motif"
                                    *ngIf="['Préinscription','Avance scolarité','Scolarité',''].includes(paiement.motif)"
                                    placeholder="Choisissez le motif du paiement"
                                    (onChange)="changeMontant(ri,$event,'motif')"></p-dropdown>
                                <input
                                    *ngIf="!['Préinscription','Avance scolarité','Scolarité',''].includes(paiement.motif)"
                                    type="text" pInputText (change)="changeMontant(ri,$event.target,'motif')"
                                    placeholder="Motif" [(value)]="paiement.motif">
                            </ng-template>
                            <ng-template pTemplate="output">
                                {{paiement.motif}}
                            </ng-template>
                        </p-cellEditor>
                    </td>
                    <td pEditableColumn>
                        <p-cellEditor>
                            <ng-template pTemplate="input">
                                <input type="date" pInputText (change)="changeMontant(ri,$event,'date')"
                                    [(value)]="paiement.date">
                            </ng-template>
                            <ng-template pTemplate="output">
                                {{paiement.date | date:'dd MMMM yy'}}
                            </ng-template>
                        </p-cellEditor>
                    </td>
                    <td>
                        <a *ngIf="paiement.doc" (click)="downloadFilePayment(paiement,ri)">Télécharger le
                            fichier</a>
                        <a *ngIf="!paiement.doc" (click)="uploadFilePayement(paiement,ri)">Uploader un fichier</a>
                    </td>
                    <td>
                        <i pTooltip="Supprimer le paiement" tooltipPosition="bottom" class="pi pi-trash"
                            aria-hidden="true" (click)="deletePayement(ri)"> </i>
                    </td>
                </tr>
            </ng-template>
        </p-table>
        <div class="col-4">
            <button type="button" (click)="onAddPayement()" pButton icon="pi pi-plus"></button>
        </div>

        <div class="col-4">
        </div>
        <div class="col-4">
            <button pButton icon="pi pi-save" (click)="savePaiement()"></button>
        </div>
    </div>
    <input type="file" (change)="FileUploadPaiementProgram($event.target.files)" id="UploadPaiementProgram"
        #UploadPaiementProgram style="display: none;" pInputFile />
    <h5 *ngIf="showPaiement?.user_id" style="font-weight: bold;color:#37BAD4"> Paiement programmés pour
        {{ showPaiement?.user_id?.firstname }}
        {{ showPaiement?.user_id?.lastname | uppercase }}
    </h5>
    <div class="grid">
        <p-table #dt2 dataKey="ID" [value]="payementProgramList" class="col-12" styleClass="p-datatable-gridlines">
            <ng-template pTemplate="header">
                <tr>
                    <!--<th pSortableColumn="ID" style="text-align: center;"> ID <p-sortIcon field="ID">
                    </p-sortIcon>
                </th>-->
                    <th pSortableColumn="montant" style="text-align: center;"> Montant <p-sortIcon
                            field="montant"></p-sortIcon>
                    </th>
                    <th pSortableColumn="type" style="text-align: center;"> Modalité <p-sortIcon field="type">
                        </p-sortIcon>
                    </th>
                    <th pSortableColumn="motif" style="text-align: center;"> Motif <p-sortIcon field="motif">
                        </p-sortIcon>
                    </th>
                    <th pSortableColumn="date" style="text-align: center;"> Date d'encaissement <p-sortIcon
                            field="date"></p-sortIcon>
                    </th>

                    <th pSortableColumn="etat" style="text-align: center;">
                        Etat<p-sortIcon field="etat"></p-sortIcon>
                    </th>
                    <th pSortableColumn="doc" style="text-align: center;">
                        Lien
                    </th>
                    <th>
                        <div class="flex justify-content-between align-items-center">
                            Action
                        </div>
                    </th>
                </tr>
            </ng-template>
            <ng-template pTemplate="body" let-paiement let-ri="rowIndex">
                <tr [pEditableRow]="paiement">
                    <!--<td>
                    {{paiement?.ID}}
                </td>-->
                    <td pEditableColumn>
                        <p-cellEditor>
                            <ng-template pTemplate="input">
                                <input type="number" (change)="changeMontantProgram(ri,$event,'montant')"
                                    [(value)]="paiement.montant" placeholder="20" value="0" pInputText>
                            </ng-template>
                            <ng-template pTemplate="output">
                                {{paiement.montant}}€
                            </ng-template>
                        </p-cellEditor>
                    </td>
                    <td pEditableColumn>
                        <p-cellEditor>
                            <ng-template pTemplate="input">
                                <p-dropdown [options]="typePaiement" [(ngModel)]="paiement.type"
                                    placeholder="Choisissez la méthode de paiement"
                                    (onChange)="changeMontantProgram(ri,$event,'type')"></p-dropdown>
                            </ng-template>
                            <ng-template pTemplate="output">
                                {{paiement.type}}
                            </ng-template>
                        </p-cellEditor>
                    </td>
                    <td pEditableColumn>
                        <p-cellEditor>
                            <ng-template pTemplate="input">
                                <p-dropdown [options]="typeMotif" [(ngModel)]="paiement.motif"
                                    *ngIf="['Préinscription','Avance scolarité','Scolarité',''].includes(paiement.motif)"
                                    placeholder="Choisissez le motif du paiement"
                                    (onChange)="changeMontantProgram(ri,$event,'motif')"></p-dropdown>
                                <input
                                    *ngIf="!['Préinscription','Avance scolarité','Scolarité',''].includes(paiement.motif)"
                                    type="text" pInputText (change)="changeMontantProgram(ri,$event.target,'motif')"
                                    placeholder="Motif" [(value)]="paiement.motif">
                            </ng-template>
                            <ng-template pTemplate="output">
                                {{paiement.motif}}
                            </ng-template>
                        </p-cellEditor>
                    </td>
                    <td pEditableColumn>
                        <p-cellEditor>
                            <ng-template pTemplate="input">
                                <input type="date" pInputText (change)="changeMontantProgram(ri,$event,'date')"
                                    [(value)]="paiement.date">
                            </ng-template>
                            <ng-template pTemplate="output">
                                {{paiement.date | date:'dd MMMM yy'}}
                            </ng-template>
                        </p-cellEditor>
                    </td>
                    <td pEditableColumn>
                        <p-cellEditor>
                            <ng-template pTemplate="input">
                                <p-dropdown [options]="typeEtat" [(ngModel)]="paiement.etat"
                                    placeholder="Choisissez l'état du paiement"
                                    (onChange)="changeMontantProgram(ri,$event,'etat')"></p-dropdown>
                            </ng-template>
                            <ng-template pTemplate="output">
                                {{paiement.etat}}
                            </ng-template>
                        </p-cellEditor>
                    </td>
                    <td>
                        <a *ngIf="paiement.doc" (click)="downloadFilePayment(paiement,ri)">Télécharger le
                            fichier</a>
                        <a *ngIf="!paiement.doc" (click)="uploadFilePayementProgram(paiement,ri)">Uploader un
                            fichier</a>
                    </td>
                    <td>
                        <i pTooltip="Supprimer le paiement" tooltipPosition="bottom" class="pi pi-trash"
                            aria-hidden="true" (click)="deletePayementProgram(ri)"> </i>
                    </td>
                </tr>
            </ng-template>
        </p-table>
        <div class="col-4">
            <button type="button" (click)="onAddPayementProgram()" pButton icon="pi pi-plus"></button>
        </div>

        <div class="col-4">
        </div>
        <div class="col-4">
            <button pButton icon="pi pi-save" (click)="savePaiement()"></button>
        </div>
    </div>
</p-dialog>
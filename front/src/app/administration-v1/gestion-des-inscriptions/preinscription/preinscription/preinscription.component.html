<div class="card">

    <div class="col-12 card" *ngIf="showPaiement">
        <input type="file" (change)="FileUploadPaiement($event.target.files)" id="UploadPaiement" #UploadPaiement
            style="display: none;" pInputFile />
        <i class="pi pi-times-circle" style="float:right; color: red; cursor: pointer;" (click)="showPaiement = null"
            aria-hidden="true"> </i>
        <h3 *ngIf="showPaiement?.user_id" class="text-center" style="font-weight: bold;"> Paiement de : {{
            showPaiement?.user_id?.firstname }} {{
            showPaiement?.user_id?.lastname | uppercase }}
        </h3>
        <div class="grid">
            <p-table #dt2 dataKey="ID" [value]="payementList" class="col-12" styleClass="p-datatable-gridlines">
                <ng-template pTemplate="header">
                    <tr>
                        <th pSortableColumn="ID" style="text-align: center;"> ID <p-sortIcon field="ID">
                            </p-sortIcon>
                        </th>
                        <th pSortableColumn="montant" style="text-align: center;"> Montant <p-sortIcon
                                field="montant"></p-sortIcon>
                        </th>
                        <th pSortableColumn="type" style="text-align: center;"> Modalité <p-sortIcon field="type">
                            </p-sortIcon>
                        </th>
                        <th pSortableColumn="motif" style="text-align: center;"> Motif <p-sortIcon field="motif">
                            </p-sortIcon>
                        </th>
                        <th pSortableColumn="date" style="text-align: center;"> Date d'encaissement <p-sortIcon
                                field="date"></p-sortIcon>
                        </th>

                        <th pSortableColumn="doc" style="text-align: center;">
                            Lien
                        </th>
                        <th>
                            <div class="flex justify-content-between align-items-center">
                                Action
                            </div>
                        </th>
                    </tr>
                </ng-template>
                <ng-template pTemplate="body" let-paiement let-ri="rowIndex">
                    <tr [pEditableRow]="paiement">
                        <td>
                            {{paiement?.ID}}
                        </td>
                        <td pEditableColumn>
                            <p-cellEditor>
                                <ng-template pTemplate="input">
                                    <input type="number" (change)="changeMontant(ri,$event,'montant')"
                                        [(value)]="paiement.montant" placeholder="20" value="0" pInputText>
                                </ng-template>
                                <ng-template pTemplate="output">
                                    {{paiement.montant}}€
                                </ng-template>
                            </p-cellEditor>
                        </td>
                        <td pEditableColumn>
                            <p-cellEditor>
                                <ng-template pTemplate="input">
                                    <p-dropdown [options]="typePaiement" [(ngModel)]="paiement.type"
                                        placeholder="Choisissez la méthode de paiement"
                                        (onChange)="changeMontant(ri,$event,'type')"></p-dropdown>
                                </ng-template>
                                <ng-template pTemplate="output">
                                    {{paiement.type}}
                                </ng-template>
                            </p-cellEditor>
                        </td>
                        <td pEditableColumn>
                            <p-cellEditor>
                                <ng-template pTemplate="input">
                                    <p-dropdown [options]="typeMotif" [(ngModel)]="paiement.motif"
                                        *ngIf="['Préinscription','Avance scolarité','Scolarité',''].includes(paiement.motif)"
                                        placeholder="Choisissez le motif du paiement"
                                        (onChange)="changeMontant(ri,$event,'motif')"></p-dropdown>
                                    <input
                                        *ngIf="!['Préinscription','Avance scolarité','Scolarité',''].includes(paiement.motif)"
                                        type="text" pInputText (change)="changeMontant(ri,$event.target,'motif')"
                                        placeholder="Motif" [(value)]="paiement.motif">
                                </ng-template>
                                <ng-template pTemplate="output">
                                    {{paiement.motif}}
                                </ng-template>
                            </p-cellEditor>
                        </td>
                        <td pEditableColumn>
                            <p-cellEditor>
                                <ng-template pTemplate="input">
                                    <input type="date" pInputText (change)="changeMontant(ri,$event,'date')"
                                        [(value)]="paiement.date">
                                </ng-template>
                                <ng-template pTemplate="output">
                                    {{paiement.date | date:'dd MMMM yy'}}
                                </ng-template>
                            </p-cellEditor>
                        </td>
                        <td>
                            <a *ngIf="paiement.doc" (click)="downloadFilePayment(paiement,ri)">Télécharger le
                                fichier</a>
                            <a *ngIf="!paiement.doc" (click)="uploadFilePayement(paiement,ri)">Uploader un fichier</a>
                        </td>
                        <td>
                            <i pTooltip="Supprimer le paiement" tooltipPosition="bottom" class="pi pi-trash"
                                aria-hidden="true" (click)="deletePayement(ri)"> </i>
                        </td>
                    </tr>
                </ng-template>
            </p-table>
            <div class="col-4">
                <button type="button" (click)="onAddPayement()" pButton label="Ajouter un paiement"></button>
            </div>

            <div class="col-4">
            </div>
            <div class="col-4">
                <button pButton label="Sauvegardez les modifications" (click)="savePaiement()"></button>
            </div>
        </div>
        <input type="file" (change)="FileUploadPaiementProgram($event.target.files)" id="UploadPaiementProgram"
            #UploadPaiementProgram style="display: none;" pInputFile />
        <h4 *ngIf="showPaiement?.user_id" class="text-center" style="font-weight: bold;"> Paiement programmé
        </h4>
        <div class="grid">
            <p-table #dt2 dataKey="ID" [value]="payementProgramList" class="col-12" styleClass="p-datatable-gridlines">
                <ng-template pTemplate="header">
                    <tr>
                        <!--<th pSortableColumn="ID" style="text-align: center;"> ID <p-sortIcon field="ID">
                            </p-sortIcon>
                        </th>-->
                        <th pSortableColumn="montant" style="text-align: center;"> Montant <p-sortIcon
                                field="montant"></p-sortIcon>
                        </th>
                        <th pSortableColumn="type" style="text-align: center;"> Modalité <p-sortIcon field="type">
                            </p-sortIcon>
                        </th>
                        <th pSortableColumn="motif" style="text-align: center;"> Motif <p-sortIcon field="motif">
                            </p-sortIcon>
                        </th>
                        <th pSortableColumn="date" style="text-align: center;"> Date d'encaissement <p-sortIcon
                                field="date"></p-sortIcon>
                        </th>

                        <th pSortableColumn="etat" style="text-align: center;">
                            Etat<p-sortIcon field="etat"></p-sortIcon>
                        </th>
                        <th pSortableColumn="doc" style="text-align: center;">
                            Lien
                        </th>
                        <th>
                            <div class="flex justify-content-between align-items-center">
                                Action
                            </div>
                        </th>
                    </tr>
                </ng-template>
                <ng-template pTemplate="body" let-paiement let-ri="rowIndex">
                    <tr [pEditableRow]="paiement">
                        <!--<td>
                            {{paiement?.ID}}
                        </td>-->
                        <td pEditableColumn>
                            <p-cellEditor>
                                <ng-template pTemplate="input">
                                    <input type="number" (change)="changeMontantProgram(ri,$event,'montant')"
                                        [(value)]="paiement.montant" placeholder="20" value="0" pInputText>
                                </ng-template>
                                <ng-template pTemplate="output">
                                    {{paiement.montant}}€
                                </ng-template>
                            </p-cellEditor>
                        </td>
                        <td pEditableColumn>
                            <p-cellEditor>
                                <ng-template pTemplate="input">
                                    <p-dropdown [options]="typePaiement" [(ngModel)]="paiement.type"
                                        placeholder="Choisissez la méthode de paiement"
                                        (onChange)="changeMontantProgram(ri,$event,'type')"></p-dropdown>
                                </ng-template>
                                <ng-template pTemplate="output">
                                    {{paiement.type}}
                                </ng-template>
                            </p-cellEditor>
                        </td>
                        <td pEditableColumn>
                            <p-cellEditor>
                                <ng-template pTemplate="input">
                                    <p-dropdown [options]="typeMotif" [(ngModel)]="paiement.motif"
                                        *ngIf="['Préinscription','Avance scolarité','Scolarité',''].includes(paiement.motif)"
                                        placeholder="Choisissez le motif du paiement"
                                        (onChange)="changeMontantProgram(ri,$event,'motif')"></p-dropdown>
                                    <input
                                        *ngIf="!['Préinscription','Avance scolarité','Scolarité',''].includes(paiement.motif)"
                                        type="text" pInputText (change)="changeMontantProgram(ri,$event.target,'motif')"
                                        placeholder="Motif" [(value)]="paiement.motif">
                                </ng-template>
                                <ng-template pTemplate="output">
                                    {{paiement.motif}}
                                </ng-template>
                            </p-cellEditor>
                        </td>
                        <td pEditableColumn>
                            <p-cellEditor>
                                <ng-template pTemplate="input">
                                    <input type="date" pInputText (change)="changeMontantProgram(ri,$event,'date')"
                                        [(value)]="paiement.date">
                                </ng-template>
                                <ng-template pTemplate="output">
                                    {{paiement.date | date:'dd MMMM yy'}}
                                </ng-template>
                            </p-cellEditor>
                        </td>
                        <td pEditableColumn>
                            <p-cellEditor>
                                <ng-template pTemplate="input">
                                    <p-dropdown [options]="typeEtat" [(ngModel)]="paiement.etat"
                                        placeholder="Choisissez l'état du paiement"
                                        (onChange)="changeMontantProgram(ri,$event,'etat')"></p-dropdown>
                                </ng-template>
                                <ng-template pTemplate="output">
                                    {{paiement.etat}}
                                </ng-template>
                            </p-cellEditor>
                        </td>
                        <td>
                            <a *ngIf="paiement.doc" (click)="downloadFilePayment(paiement,ri)">Télécharger le
                                fichier</a>
                            <a *ngIf="!paiement.doc" (click)="uploadFilePayementProgram(paiement,ri)">Uploader un
                                fichier</a>
                        </td>
                        <td>
                            <i pTooltip="Supprimer le paiement" tooltipPosition="bottom" class="pi pi-trash"
                                aria-hidden="true" (click)="deletePayementProgram(ri)"> </i>
                        </td>
                    </tr>
                </ng-template>
            </p-table>
            <div class="col-4">
                <button type="button" (click)="onAddPayementProgram()" pButton label="Ajouter un paiement"></button>
            </div>

            <div class="col-4">
            </div>
            <div class="col-4">
                <button pButton label="Sauvegardez les modifications" (click)="savePaiement()"></button>
            </div>
        </div>
    </div>
    <div class="col-12 card" *ngIf="showEmail">
        <p-tabView>
            <p-tabPanel header="Email personnalisé">
                <form class="p-fluid p-formgrid grid col-12" [formGroup]="formEmailPerso">
                    <div class="field col-6">
                        <label>Objet: </label>
                        <input type="text" formControlName="objet" pInputText>
                    </div>
                    <div class="field col-6">
                        <label>Email du destinataire: </label>
                        <p>{{prospectSendTo.user_id.email_perso}}</p>
                    </div>
                    <div class="field col-12">
                        <p-editor formControlName="body" [style]="{'height':'320px'}"></p-editor>
                    </div>
                    <div class="field col-6">
                        <label>Email de l'envoyeur: </label>
                        <p-dropdown placeholder="Choisissez une adresse mail" filter="true" formControlName="send_from"
                            [options]="mailDropdown" autoWidth="false" [style]="{'width':'100%'}">
                        </p-dropdown>
                    </div>
                    <div class="field col-6">
                        <label>Email(s)en cc: </label>
                        <p-chips formControlName="cc" separator=","
                            placeholder="email1@email.com , email2.email.com"></p-chips>
                    </div>
                    <div class="field col-12">
                        <input type="file" (change)="FileUploadPJ($event.target.files)" id="selectedFilePJ"
                            #selectedFilePJ style="display: none;" pInputFile />
                        <p-table styleClass="p-datatable-gridlines" [value]="piece_jointes" responsiveLayout="scroll"
                            dataKey="_id" class="col-12" responsiveLayout="scroll">
                            <ng-template pTemplate="header" let-columns>
                                <tr>
                                    <th>
                                        Date d'upload
                                    </th>
                                    <th>
                                        Nom du document
                                    </th>
                                    <th>
                                        Lien de téléchargement
                                    </th>
                                    <th>
                                        Action
                                    </th>
                                </tr>
                            </ng-template>
                            <ng-template pTemplate="body" let-rowData let-editing="editing" let-ri="rowIndex">
                                <tr>
                                    <td>
                                        {{rowData.date | date:'dd MMMM yy'}}
                                    </td>
                                    <td *ngIf="rowData.nom && rowData.nom!='Téléverser le fichier s\'il vous plaît'">
                                        {{rowData.nom}}
                                    </td>
                                    <td
                                        *ngIf="(!rowData.nom || rowData.nom=='Téléverser le fichier s\'il vous plaît') && rowData.path">
                                        {{rowData?.path}}
                                    </td>
                                    <td
                                        *ngIf="(!rowData.nom || rowData.nom=='Téléverser le fichier s\'il vous plaît') && !rowData.path">
                                        Téléverser le fichier s'il vous plaît
                                    </td>
                                    <td *ngIf="rowData.path">
                                        <a style="cursor: pointer;" (click)="downloadPJFile(rowData)">Télécharger</a>
                                        {{rowData.path}}
                                    </td>
                                    <td *ngIf="!rowData.path">
                                        <a style="cursor: pointer;" (click)="onUploadPJ(rowData)">Upload</a>
                                    </td>
                                    <td>
                                        <i pTooltip="Uploader un fichier" tooltipPosition="bottom"
                                            class="pi pi-cloud-upload mr-2" style="cursor: pointer;"
                                            (click)="onUploadPJ(rowData)">
                                        </i>
                                        <i pTooltip="Supprimer un fichier" tooltipPosition="bottom"
                                            class="pi pi-trash mr-2" style="cursor: pointer;" (click)="onDeletePJ(ri)">
                                        </i>
                                    </td>
                                </tr>
                            </ng-template>
                        </p-table>
                        <div class="mt-2 col-12" style="text-align: center;">
                            <button pButton (click)="onAddPj()" label="Ajouter une nouvelle pièces jointe"
                                autoWidth="false" [style]="{'width':'80%'}"></button>
                        </div>
                    </div>
                    <button pButton [disabled]="formEmailPerso.invalid" (click)="onEmailPerso()"
                        label="Envoyer l'email"></button>
                </form>
            </p-tabPanel>
            <p-tabPanel header="Depuis un mail type">
                <form class="p-fluid p-formgrid grid col-12" [formGroup]="formEmailType">
                    <div class="field col-12">
                        <label>Email Type: </label>
                        <p-dropdown placeholder="Choisissez un mail type" filter="true"
                            (onChange)="onMailType($event.value)" [options]="mailTypeDropdown" autoWidth="false"
                            [style]="{'width':'100%'}">
                        </p-dropdown>
                    </div>
                    <div class="field col-6">
                        <label>Objet: </label>
                        <input type="text" formControlName="objet" pInputText>
                    </div>
                    <div class="field col-6">
                        <label>Email du destinataire: </label>
                        <p>{{prospectSendTo.user_id.email_perso}}</p>
                    </div>
                    <div class="field col-12">
                        <p-editor formControlName="body" [style]="{'height':'320px'}"></p-editor>
                    </div>
                    <div class="field col-6">
                        <label>Email de l'envoyeur: </label>
                        <p-dropdown placeholder="Choisissez une adresse mail" filter="true" formControlName="send_from"
                            [options]="mailDropdown" autoWidth="false" [style]="{'width':'100%'}">
                        </p-dropdown>
                    </div>
                    <div class="field col-6">
                        <label>Email(s) en cc: (Écrivez un , après chaque email)</label>
                        <p-chips formControlName="cc" separator=","
                            placeholder="email1@email.com,email2.email.com"></p-chips>
                    </div>
                    <div class="field col-12">
                        <input type="file" (change)="FileUploadPJ($event.target.files)" id="selectedFilePJ"
                            #selectedFilePJ style="display: none;" pInputFile />
                        <p-table styleClass="p-datatable-gridlines" [value]="piece_jointes" responsiveLayout="scroll"
                            dataKey="_id" class="col-12" responsiveLayout="scroll">
                            <ng-template pTemplate="header" let-columns>
                                <tr>
                                    <th>
                                        Date d'upload
                                    </th>
                                    <th>
                                        Nom du document
                                    </th>
                                    <th>
                                        Lien de téléchargement
                                    </th>
                                    <th>
                                        Action
                                    </th>
                                </tr>
                            </ng-template>
                            <ng-template pTemplate="body" let-rowData let-editing="editing" let-ri="rowIndex">
                                <tr>
                                    <td>
                                        {{rowData.date | date:'dd MMMM yy'}}
                                    </td>
                                    <td *ngIf="rowData.nom && rowData.nom!='Téléverser le fichier s\'il vous plaît'">
                                        {{rowData.nom}}
                                    </td>
                                    <td
                                        *ngIf="(!rowData.nom || rowData.nom=='Téléverser le fichier s\'il vous plaît') && rowData.path">
                                        {{rowData?.path}}
                                    </td>
                                    <td
                                        *ngIf="(!rowData.nom || rowData.nom=='Téléverser le fichier s\'il vous plaît') && !rowData.path">
                                        Téléverser le fichier s'il vous plaît
                                    </td>
                                    <td *ngIf="rowData.path">
                                        <a style="cursor: pointer;" (click)="downloadPJFile(rowData)">Télécharger</a>
                                        {{rowData.path}}
                                    </td>
                                    <td *ngIf="!rowData.path">
                                        <a style="cursor: pointer;" (click)="onUploadPJ(rowData)">Upload</a>
                                    </td>
                                    <td>
                                        <i pTooltip="Uploader un fichier" tooltipPosition="bottom"
                                            class="pi pi-cloud-upload mr-2" style="cursor: pointer;"
                                            (click)="onUploadPJ(rowData)">
                                        </i>
                                        <i pTooltip="Supprimer un fichier" tooltipPosition="bottom"
                                            class="pi pi-trash mr-2" style="cursor: pointer;" (click)="onDeletePJ(ri)">
                                        </i>
                                    </td>
                                </tr>
                            </ng-template>
                        </p-table>
                        <div class="mt-2 col-12" style="text-align: center;">
                            <button pButton (click)="onAddPj()" label="Ajouter une nouvelle pièces jointe"
                                autoWidth="false" [style]="{'width':'80%'}"></button>
                        </div>
                    </div>
                    <button pButton [disabled]="formEmailType.invalid" label="Envoyer l'email"
                        (click)="onEmailType()"></button>
                </form>
            </p-tabPanel>
            <p-tabPanel header="Historique des emails">
                <p-table #dt1 dataKey="_id" [rows]="8" [rowHover]="true" [paginator]="true" [value]="historiqueEmails"
                    [paginator]="true" [pageLinks]="5" selectionMode="single" class="col-12" responsiveLayout="scroll"
                    styleClass="p-datatable-gridlines">
                    <ng-template pTemplate="header">
                        <tr>
                            <th style="width: 3rem" scope="col"></th>
                            <th pSortableColumn="date_creation" scope="col" style="text-align: center;">
                                Date de l'envoie <p-sortIcon field="date_creation"></p-sortIcon>
                            </th>
                            <th pSortableColumn="objet" scope="col" style="text-align: center;">
                                Objet du mail <p-sortIcon field="objet"></p-sortIcon>
                            </th>
                            <th pSortableColumn="send_by.firstname" scope="col" style="text-align: center;">
                                Envoyé par <p-sortIcon field="send_by.firstname"></p-sortIcon>
                            </th>
                            <th pSortableColumn="cc" scope="col" style="text-align: center;">
                                Envoyé à <p-sortIcon field="cc"></p-sortIcon>
                            </th>
                            <th pSortableColumn="send_from" scope="col" style="text-align: center;">
                                Envoyé depuis <p-sortIcon field="send_from"></p-sortIcon>
                            </th>
                        </tr>
                    </ng-template>
                    <ng-template pTemplate="body" let-email let-expanded="expanded">
                        <tr>

                            <td>
                                <button type="button" pButton pRipple [pRowToggler]="email"
                                    class="p-button-text p-button-rounded p-button-plain"
                                    [icon]="expanded ? 'pi pi-chevron-down' : 'pi pi-chevron-right'"></button>
                            </td>
                            <td>
                                {{email.date_creation|date:'dd MMMM yy'}}
                            </td>
                            <td>
                                {{email.objet}}
                            </td>
                            <td>
                                {{email?.send_by?.firstname | titlecase}} {{email?.send_by?.lastname | uppercase}}
                            </td>
                            <td>
                                <strong>{{prospectSendTo?.user_id?.email_perso }}</strong> {{cc}}
                            </td>
                            <td>
                                {{email.send_from}}
                            </td>
                        </tr>
                    </ng-template>
                    <ng-template pTemplate="rowexpansion" let-email>
                        <div [innerHTML]="email.body">

                        </div>
                    </ng-template>
                </p-table>
            </p-tabPanel>
        </p-tabView>
    </div>
    <div class="col-12" *ngIf="showUploadFile!=null">
        <div class="card">
            <i class="pi pi-times-circle" style="float:right; color: red; cursor: pointer;"
                (click)="showUploadFile = null" aria-hidden="true"> </i>
            <h3 *ngIf="showUploadFile.user_id" class="text-center" style="font-weight: bold;">Ajouter un document à : {{
                showUploadFile.user_id?.firstname }} {{
                showUploadFile.user_id?.lastname | uppercase }}
            </h3>

            <form class="p-fluid p-formgrid grid" [formGroup]="uploadAdminFileForm">
                <div class="field col-6">
                    <label>Date de délivrance</label>
                    <input type="date" formControlName="date" pInputText />
                </div>
                <div class="field col-6">
                    <label>Nom du Fichier</label>
                    <input type="text" formControlName="nom" pInputText />
                </div>
                <div class="field col-6">
                    <label>Note :</label>
                    <textarea pInputTextarea formControlName="note"></textarea>
                </div>
                <div class="field col-6">
                    <label>Traité par :</label>
                    <p-dropdown [options]="agentSourcingList" formControlName="traited_by" optionValue="label"
                        optionLabel="label" placeholder="Choisissez un agent" [group]="true" filter="true"></p-dropdown>
                </div>
                <div class="field col-12">
                    <label>Type de document :</label>
                    <p-dropdown [options]="documentDropdown" formControlName="type" placeholder="Choisissez un type"
                        filter="true"></p-dropdown>
                </div>
                <div class="field col-12">
                    <p-fileUpload (uploadHandler)="FileUploadAdmin($event)" mode="basic"
                        chooseLabel="Ajouter un Document" customUpload="true" fileLimit="1"
                        accept=".docx,.pdf,.doc,.jpg,.png,.jpeg" [disabled]="uploadAdminFileForm.invalid"
                        maxFileSize="10000000" [auto]="true" #fileInput>
                    </p-fileUpload>
                </div>

            </form>
        </div>
    </div>
    <div class="col-12 card" *ngIf="showDocAdmin">
        <i class="pi pi-times-circle" style="float:right; color: red; cursor: pointer;"
        (click)="showDocAdmin = null" aria-hidden="true"> </i>
        <div class="col-12 grid">
            <div class="col-12">
                <strong>Mes attestations disponibles:</strong>
            </div>
            <div class="col-12">
                <p-table styleClass="p-datatable-gridlines" [value]="showDocAdmin.documents_administrative"
                    responsiveLayout="scroll" responsiveLayout="scroll">
                    <ng-template pTemplate="header" let-columns>
                        <tr>
                            <th>
                                ID
                            </th>
                            <th>
                                Type
                            </th>
                            <th>
                                Date de délivrance
                            </th>
                            <th>
                                Nom du document
                            </th>
                            <th>
                                Traité par
                            </th>
                            <th>
                                Lien de téléchargement
                            </th>
                            <th>
                                Note
                            </th>
                        </tr>
                    </ng-template>
                    <ng-template pTemplate="body" let-rowData>
                        <tr>
                            <td>
                                {{rowData.custom_id}}
                            </td>
                            <td>
                                {{rowData.type}}
                            </td>
                            <td>
                                {{rowData.date | date:'dd MMMM yy'}}
                            </td>
                            <td>
                                {{rowData.nom}}
                            </td>
                            <td>
                                {{rowData.traited_by}}
                            </td>
                            <td>
                                <a (click)="downloadAdminFile(rowData.path)">Télécharger</a>
                            </td>
                            <td>
                                {{rowData.note}}
                            </td>
                        </tr>
                    </ng-template>
                </p-table>
            </div>
        </div>
        <p *ngIf="showDocAdmin.documents_administrative==null || showDocAdmin.documents_administrative.length==0">
            Aucun document n'a été chargé !
        </p>
        <div class="col-12">
            <button pButton label="Ajouter un document" (click)="showUploadFile=showDocAdmin;scrollToTop()"></button>
        </div>
    </div>
    <p-tabView [(activeIndex)]="selectedTabIndex" (onClose)="onTabClose($event)">

        <p-tabPanel header="Local">

            <div *ngIf="shownewLeadForm" class="col-12 card">
                <h4 style="text-align: center;">Ajouter un nouveau lead </h4>
                <div style="text-align: center;">
                    <small>Tous les champs marqués d'un astérisque <span style="color: red;"> * </span> sont
                        obligatoires</small><br>
                </div>
                <br>
                <form class="p-fluid p-formgrid grid" (ngSubmit)="addNewProspect()" [formGroup]="newLeadForm">
                    <h5 class="col-12" style="text-align: center;">Etudiant</h5> <br>
                    <div class="field col-12 md:col-12">
                        <label For="type">Type <span style="color:red"> *</span></label>
                        <p-dropdown [options]="typeList" placeholder="Choisissez le type du lead"
                            (onChange)="onSelectEcole()" formControlName="type"></p-dropdown>
                    </div>


                    <div class="field col-12 md:col-2">
                        <label For="civilite">Civilité<span style="color: red;"> * </span></label>
                        <p-dropdown [options]="civiliteList" optionLabel="value" optionDisabled="actif"
                            placeholder="Choisissez une civilité" formControlName="civilite"></p-dropdown>
                    </div>
                    <div class="field col-12 md:col-5">
                        <label For="nom">Nom <span style="color: red;"> * </span></label>
                        <input pInputText id="nom" type="text" placeholder="Entrez votre nom"
                            formControlName="lastname" />
                    </div>
                    <div class="field col-12 md:col-5">
                        <label For="prenom">Prénom <span style="color: red;"> * </span></label>
                        <input pInputText id="prenom" type="text" placeholder="Entrez votre prénom"
                            formControlName="firstname" />
                    </div>
                    <div class="field col-12 md:col-6">
                        <label For="date_naissance">Date de naissance <span style="color: red;"> *
                            </span></label>
                        <input type="date" formControlName="date_naissance" pInputText />
                    </div>
                    <div class="field col-12 md:col-6">
                        <label>Pays de résidence :<span style="color:red"> *</span></label><br>
                        <p-dropdown formControlName="pays" [options]="paysList" placeholder="Pays" optionLabel="value"
                            emptyFilterMessage="Pas de pays trouvé" filterPlaceholder="Pays" filter="true"
                            optionDisabled="actif"></p-dropdown>
                    </div>
                    <div class="field col-12 md:col-6">
                        <label For="nationalite">Nationalité <span style="color: red;"> * </span></label>
                        <p-dropdown formControlName="nationalite" [options]="nationList" optionLabel="label"
                            emptyFilterMessage="Pas de nationalité trouvé" filterPlaceholder="Nationalité"
                            filter="true"></p-dropdown>
                    </div>
                    <h5 class="col-12" style="text-align: center;">Contact</h5> <br>
                    <div class="field col-12 md:col-3">
                        <label For="indicatif">Indicatif <span style="color: red;"> * </span></label>
                        <input pInputText id="indicatif" type="text" placeholder="+33" formControlName="indicatif" />
                    </div>
                    <div class="field col-12 md:col-9">
                        <label For="telephone">Numéro de téléphone <span style="color: red;"> *
                            </span></label>
                        <input pInputText id="telephone" type="number" placeholder="Entrez votre numéro de téléphone"
                            formControlName="phone" />
                    </div>
                    <div class="field col-12 md:col-6">

                        <label>Email :<span style="color:red"> *</span></label>
                        <input type="email" formControlName="email_perso" placeholder="Email" (blur)="verifEmailInBD()"
                            pInputText>
                    </div>
                    <div class="field col-12 md:col-6">

                        <label>Numéro rue:<span style="color:red"> *</span></label>
                        <input formControlName="rue" placeholder="rue" pInputText>
                    </div>
                    <div class="field col-12 md:col-6">

                        <label>ville:<span style="color:red"> *</span></label>
                        <input formControlName="ville" placeholder="ville" pInputText>
                    </div>
                    <div class="field col-12 md:col-6">

                        <label>code postale:<span style="color:red"> *</span></label>
                        <input formControlName="codep" placeholder="code postale" pInputText>
                    </div>


                    <h5 class="col-12" style="text-align: center;">Choix académique</h5><br>
                    <div class="field col-12 md:col-12">
                        <label For="role">Ecole <span style="color:red"> *</span></label>
                        <p-dropdown [options]="EcoleListRework" placeholder="Choisissez l'école du lead"
                            (onChange)="onSelectEcole()" formControlName="ecole"></p-dropdown>
                    </div>
                    <div class="field col-12">
                        <label>Choix du campus <span style="color: red;"> * </span></label>
                        <p-dropdown [options]="campusDropdown" optionLabel="value" formControlName="campus"
                            placeholder="Choisissez un campus">
                        </p-dropdown>
                    </div>

                    <div class="field col-12 md:col-12">
                        <label>Choix de la rentrée <span style="color: red;"> * </span></label>
                        <p-dropdown [options]="rentreeList" formControlName="rentree_scolaire"
                            placeholder="Choisissez une rentrée" placeholder="Choisissez la rentrée scolaire">
                        </p-dropdown>
                    </div>

                    <div class="field col-12 md:col-4">
                        <label>Choix du programme <span style="color: red;"> * </span></label>
                        <p-dropdown [options]="programList" optionLabel="value" formControlName="programme"
                            placeholder="Choisissez un programme">
                        </p-dropdown>
                    </div>
                    <div class="field col-12 md:col-8" *ngIf="newLeadForm.value.programme.value=='Programme Anglais'">
                        <label For="formation">Choix de la formation <span style="color: red;">
                                *</span></label>
                        <p-dropdown [options]="programEnDropdown" placeholder="Choose a english program"
                            autoWidth="false" [filter]="true" [group]="true" [style]="{'width':'100%'}"
                            formControlName="formation"></p-dropdown>
                    </div>
                    <div class="field col-12 md:col-8" *ngIf="newLeadForm.value.programme.value=='Programme Français'">
                        <label For="programme_fr">Choix de la formation <span style="color: red;"> *
                            </span></label>
                        <p-dropdown [options]="programeFrDropdown" placeholder="Choissiez un programme français"
                            [filter]="true" [group]="true" [style]="{'width':'100%'}" autoWidth="false"
                            formControlName="formation"></p-dropdown>
                    </div>
                    <div class="field col-12 md:col-12">
                        <label For="rythme">Rythme de la formation <span style="color: red;"> *
                            </span></label>
                        <p-dropdown [options]="typeFormationDropdown" optionLabel="value" autoWidth="false"
                            placeholder="Choisissez un rythme" [style]="{'width':'100%'}"
                            formControlName="rythme_formation"></p-dropdown>
                    </div>

                    <div class="field col-12 md:col-6" *ngIf="!isPartenaireExterne">
                        <label For="role">Source <span style="color:red"> *</span></label> <!--SI INTERNE-->
                        <p-dropdown [options]="sourceList" placeholder="Choisissez la provenance du lead"
                            (onChange)="changeSource($event.value)" formControlName="source"></p-dropdown>
                    </div>
                    <div *ngIf="!itslead" class="field col-12 md:col-6"> <!--SI INTERNE-->
                        <label For="role">Commercial</label>
                        <p-dropdown [options]="commercialList" filter="true"
                            placeholder="Choisissez le commercial qui a ajouté le lead"
                            formControlName="commercial"></p-dropdown>
                    </div>
                    <div *ngIf="itslead" class="field col-12 md:col-6">
                        <label>Nom et prénom :<span style="color:red"> *</span></label>
                        <input formControlName="nomlead" placeholder="nom et pénom" pInputText>
                    </div> <br>
                    <div style="justify-content: right;">
                        <button pButton type="submit" label="Ajouter"
                            [disabled]="(newLeadForm.invalid && !isPartenaireExterne) || (!newLeadForm.value.ecole)"></button>
                    </div>
                </form>
            </div>
            <div *ngIf="showupdateLeadForm" class="col-12 card">
                <h4 style="text-align: center;">Modifier </h4>
                <div style="text-align: center;">
                    <small>Tous les champs marqués d'un astérisque <span style="color: red;"> * </span> sont
                        obligatoires</small><br>
                </div>
                <br>
                <form class="p-fluid p-formgrid grid" (ngSubmit)="addNewProspect()" [formGroup]="updateLeadForm">
                    <h5 class="col-12" style="text-align: center;">Etudiant</h5> <br>
                    <div class="field col-12 md:col-12">
                        <label For="type">Type <span style="color:red"> *</span></label>
                        <p-dropdown [options]="typeList" placeholder="Choisissez le type du lead"
                            (onChange)="onSelectEcole()" formControlName="type"></p-dropdown>
                    </div>


                    <div class="field col-12 md:col-2">
                        <label For="civilite">Civilité<span style="color: red;"> * </span></label>
                        <p-dropdown [options]="civiliteList" optionLabel="value" optionDisabled="actif"
                            placeholder="Choisissez une civilité" formControlName="civilite"></p-dropdown>
                    </div>
                    <div class="field col-12 md:col-5">
                        <label For="nom">Nom <span style="color: red;"> * </span></label>
                        <input pInputText id="nom" type="text" placeholder="Entrez votre nom"
                            formControlName="lastname" />
                    </div>
                    <div class="field col-12 md:col-5">
                        <label For="prenom">Prénom <span style="color: red;"> * </span></label>
                        <input pInputText id="prenom" type="text" placeholder="Entrez votre prénom"
                            formControlName="firstname" />
                    </div>
                    <div class="field col-12 md:col-6">
                        <label For="date_naissance">Date de naissance <span style="color: red;"> *
                            </span></label>
                        <input type="date" formControlName="date_naissance" pInputText />
                    </div>
                    <div class="field col-12 md:col-6">
                        <label>Pays de résidence :<span style="color:red"> *</span></label><br>
                        <p-dropdown formControlName="pays" [options]="paysList" placeholder="Pays" optionLabel="value"
                            emptyFilterMessage="Pas de pays trouvé" filterPlaceholder="Pays" filter="true"
                            optionDisabled="actif"></p-dropdown>
                    </div>
                    <div class="field col-12 md:col-6">
                        <label For="nationalite">Nationalité <span style="color: red;"> * </span></label>
                        <p-dropdown formControlName="nationalite" [options]="nationList" optionLabel="label"
                            emptyFilterMessage="Pas de nationalité trouvé" filterPlaceholder="Nationalité"
                            filter="true"></p-dropdown>
                    </div>
                    <h5 class="col-12" style="text-align: center;">Contact</h5> <br>
                    <div class="field col-12 md:col-3">
                        <label For="indicatif">Indicatif <span style="color: red;"> * </span></label>
                        <input pInputText id="indicatif" type="text" placeholder="+33" formControlName="indicatif" />
                    </div>
                    <div class="field col-12 md:col-9">
                        <label For="telephone">Numéro de téléphone <span style="color: red;"> *
                            </span></label>
                        <input pInputText id="telephone" type="number" placeholder="Entrez votre numéro de téléphone"
                            formControlName="phone" />
                    </div>
                    <div class="field col-12 md:col-6">

                        <label>Email :<span style="color:red"> *</span></label>
                        <input type="email" formControlName="email_perso" placeholder="Email" (blur)="verifEmailInBD()"
                            pInputText>
                    </div>
                    <div class="field col-12 md:col-6">

                        <label>Numéro rue:<span style="color:red"> *</span></label>
                        <input formControlName="rue" placeholder="rue" pInputText>
                    </div>
                    <div class="field col-12 md:col-6">

                        <label>ville:<span style="color:red"> *</span></label>
                        <input formControlName="ville" placeholder="ville" pInputText>
                    </div>
                    <div class="field col-12 md:col-6">

                        <label>code postale:<span style="color:red"> *</span></label>
                        <input formControlName="codep" placeholder="code postale" pInputText>
                    </div>


                    <h5 class="col-12" style="text-align: center;">Choix académique</h5><br>
                    <div class="field col-12 md:col-12">
                        <label For="role">Ecole <span style="color:red"> *</span></label>
                        <p-dropdown [options]="EcoleListRework" placeholder="Choisissez l'école du lead"
                            (onChange)="onSelectEcole()" formControlName="ecole"></p-dropdown>
                    </div>
                    <div class="field col-12">
                        <label>Choix du campus <span style="color: red;"> * </span></label>
                        <p-dropdown [options]="campusDropdown" optionLabel="value" formControlName="campus"
                            placeholder="Choisissez un campus">
                        </p-dropdown>
                    </div>

                    <div class="field col-12 md:col-12">
                        <label>Choix de la rentrée <span style="color: red;"> * </span></label>
                        <p-dropdown [options]="rentreeList" formControlName="rentree_scolaire"
                            placeholder="Choisissez une rentrée" placeholder="Choisissez la rentrée scolaire">
                        </p-dropdown>
                    </div>

                    <div class="field col-12 md:col-4">
                        <label>Choix du programme <span style="color: red;"> * </span></label>
                        <p-dropdown [options]="programList" optionLabel="value" formControlName="programme"
                            placeholder="Choisissez un programme">
                        </p-dropdown>
                    </div>
                    <div class="field col-12 md:col-8" *ngIf="newLeadForm.value.programme.value=='Programme Anglais'">
                        <label For="formation">Choix de la formation <span style="color: red;">
                                *</span></label>
                        <p-dropdown [options]="programEnDropdown" placeholder="Choose a english program"
                            autoWidth="false" [filter]="true" [group]="true" [style]="{'width':'100%'}"
                            formControlName="formation"></p-dropdown>
                    </div>
                    <div class="field col-12 md:col-8" *ngIf="newLeadForm.value.programme.value=='Programme Français'">
                        <label For="programme_fr">Choix de la formation <span style="color: red;"> *
                            </span></label>
                        <p-dropdown [options]="programeFrDropdown" placeholder="Choissiez un programme français"
                            [filter]="true" [group]="true" [style]="{'width':'100%'}" autoWidth="false"
                            formControlName="formation"></p-dropdown>
                    </div>
                    <div class="field col-12 md:col-12">
                        <label For="rythme">Rythme de la formation <span style="color: red;"> *
                            </span></label>
                        <p-dropdown [options]="typeFormationDropdown" optionLabel="value" autoWidth="false"
                            placeholder="Choisissez un rythme" [style]="{'width':'100%'}"
                            formControlName="rythme_formation"></p-dropdown>
                    </div>

                    <div class="field col-12 md:col-6" *ngIf="!isPartenaireExterne">
                        <label For="role">Source <span style="color:red"> *</span></label> <!--SI INTERNE-->
                        <p-dropdown [options]="sourceList" placeholder="Choisissez la provenance du lead"
                            (onChange)="changeSource($event.value)" formControlName="source"></p-dropdown>
                    </div>
                    <div *ngIf="!itslead" class="field col-12 md:col-6"> <!--SI INTERNE-->
                        <label For="role">Commercial</label>
                        <p-dropdown [options]="commercialList" filter="true"
                            placeholder="Choisissez le commercial qui a ajouté le lead"
                            formControlName="commercial"></p-dropdown>
                    </div>
                    <div *ngIf="itslead" class="field col-12 md:col-6">
                        <label>Nom et prénom :<span style="color:red"> *</span></label>
                        <input formControlName="nomlead" placeholder="nom et pénom" pInputText>
                    </div> <br>
                    <div style="justify-content: right;">
                        <button pButton type="submit" label="Modifier"
                            [disabled]="(newLeadForm.invalid && !isPartenaireExterne) || (!newLeadForm.value.ecole)"></button>
                    </div>
                </form>
            </div>
            <div class="grid ">
                <div class=" field col-3">
                    <button pButton label="Filtrer" class="p-button mb-2" icon="pi pi-filter"></button><br>
                    <button pButton label="Vider&nbsp; " class="p-button" icon="pi pi-filter-slash"></button><br> <br>
                </div>
                <div class=" field col-6">
                    <input pInputText type="text" style="width: 20em;" placeholder="Recherche" />
                </div>
                <div class=" field col-3">
                    <button pButton pRipple (click)="shownewLeadForm=true" icon="pi pi-plus" class="mr-2 mb-2"></button>
                </div>
            </div>
            <p-table #dt1 [value]="prospects" dataKey="_id" responsiveLayout="scroll"
                [globalFilterFields]="['nom', 'choix', 'rythme']" [rows]="8" [pageLinks]="5" [paginator]="true"
                rowExpandMode="single" [totalRecords]="" styleClass="p-datatable-gridlines">

                <ng-template pTemplate="header">
                    <tr>
                        <th style="width: 5em"></th>
                        <th pSortableColumn="id">
                            ID<p-sortIcon field="id"> </p-sortIcon>
                        </th>
                        <th pSortableColumn="nom">
                            Prénom et Nom<p-sortIcon field="nom"> </p-sortIcon>
                        </th>
                        <th pSortableColumn="choix">
                            Choix académique <p-sortIcon field="choix"> </p-sortIcon>
                        </th>
                        <th pSortableColumn="rythme">
                            Rythme <p-sortIcon field="rythme"> </p-sortIcon>
                        </th>
                        <th pSortableColumn="decision">
                            Décision admission<p-sortIcon field="decision"> </p-sortIcon>
                        </th>

                        <th pSortableColumn="paiement">
                            Paiement<p-sortIcon field="paiement"> </p-sortIcon>
                        </th>

                        <th pSortableColumn="etape">
                            Etape<p-sortIcon field="etape"> </p-sortIcon>
                        </th>

                        <th pSortableColumn="date">
                            Date d'inscription<p-sortIcon field="date">
                            </p-sortIcon>

                        <th>Action</th>
                    </tr>
                </ng-template>
                <ng-template pTemplate="body" let-prospect>
                    <tr>
                        <td>
                            <button type="button" pButton pRipple [pRowToggler]="prospect"
                                class="p-button-text p-button-rounded p-button-plain" [icon]="
                                    expanded
                                        ? 'pi pi-chevron-down'
                                        : 'pi pi-chevron-right'
                                "></button>
                        </td>
                        <td>
                            {{ prospect.customid}}
                        </td>
                        <td>
                            {{ prospect.user_id.firstname | titlecase }}
                            {{ prospect.user_id.lastname | uppercase }}
                        </td>
                        <td>
                            {{prospect.rentree_scolaire}},{{ prospect.formation}},{{prospect.campus_choix_1}}
                        </td>
                        <td>
                            {{prospect.rythme_formation}}
                        </td>
                        <td>
                            {{ prospect?.decision?.decision_admission}}
                        </td>
                        <td>
                            {{ prospect?.payement}}
                        </td>


                        <td>
                            {{ prospect?.etat_traitement}}
                        </td>
                        <td>
                            {{ prospect?.date_creation| date:'dd MMMM yy'}}
                        </td>
                        <td>
                            <i *ngIf="candidatureDic && candidatureDic[prospect._id]"
                                style="padding-left: 3%;color: rgb(11, 36, 0);" class="pi pi-envelope m-1" pBadge
                                value="1" pTooltip="Candidature" aria-hidden="true"
                                (click)="goToCandidature(prospect._id)" tooltipPosition="bottom"></i>
                            <i pTooltip="Envoyer un mail" tooltipPosition="bottom" class="pi pi-at m-1"
                                style="padding-left: 3%" aria-hidden="true"
                                (click)="initSendEmail(prospect);scrollToTop()"> </i>
                            <i *ngIf="!candidatureDic || !candidatureDic[prospect._id]"
                                style="padding-left: 3%;color: rgb(11, 36, 0);" class="pi pi-envelope m-1"
                                pTooltip="Candidature" aria-hidden="true" (click)="goToCandidature(prospect._id)"
                                tooltipPosition="bottom"></i>
                            <i style="padding-left: 3%;color: rgb(11, 36, 0);" class="pi pi-euro m-1"
                                (click)="initPaiement(prospect);scrollToTop()" pTooltip="Paiement" aria-hidden="true"
                                tooltipPosition="bottom"></i>
                            <i pTooltip="Documents Administratif" tooltipPosition="bottom" class="pi pi-file m-1"
                                (click)="initDocument(prospect);scrollToTop()" aria-hidden="true"></i>
                            <i style="padding-left: 3%;" class="pi pi-building m-1" pTooltip="Admission"
                                (click)="onshowDossier(prospect)" aria-hidden="true" tooltipPosition="bottom"></i>
                            <i style="padding-left: 3%;color: rgb(72, 72, 255);
                                " class="pi pi-pencil m-1" (click)="initupdateLeadForm(prospect); scrollToTop()"
                                pTooltip="Modifier" aria-hidden="true" tooltipPosition="bottom"></i>
                            <i style="padding-left: 3%; color: rgb(255, 0, 0)" class="pi pi-trash m-1"
                                (click)="deletePro(prospect)" pTooltip="Supprimer" aria-hidden="true"
                                tooltipPosition="bottom"></i>
                        </td>
                    </tr>
                </ng-template>
                <ng-template pTemplate="rowexpansion" let-user>
                    <tr>
                        <td colspan="10">


                            <h5 style="color: rgb(48, 121, 230);font-weight: bold;">
                                Détails
                            </h5>
                            <p-table responsiveLayout="scroll">
                                <ng-template pTemplate="header">
                    <tr>

                        <th>ID</th>
                        <th>Prénom et Nom </th>
                        <th>Date de naissance</th>
                        <th>Pays de résidence</th>
                        <th>Nationalité</th>
                        <th>Action</th>

                    </tr>
                </ng-template>
                <ng-template pTemplate="emptymessage">
                    <tr>
                        <td>{{ user.customid }}</td>
                        <td>
                            {{ user.user_id.firstname | titlecase }}
                            {{ user.user_id.lastname | uppercase }}
                        </td>
                        <td>
                            {{
                            user.date_naissance| date:'dd MMMM yy'
                            }}
                        </td>
                        <td>{{ user.user_id.pays_adresse}}</td>
                        <td>
                            {{user.user_id.nationnalite}}
                        </td>

                        <td></td>
                    </tr>

                </ng-template>

            </p-table>
            <h5 style="color: rgb(48, 121, 230);font-weight: bold;">
                Contact
            </h5>
            <p-table responsiveLayout="scroll">
                <ng-template pTemplate="header">
                    <tr>
                        <th>Adresse mail</th>
                        <th>Adresse mail école </th>
                        <th>numéro de téléphone</th>
                        <th>Adresse</th>
                        <th>Action</th>
                    </tr>
                </ng-template>
                <ng-template pTemplate="emptymessage">
                    <tr>
                        <td>{{user.user_id.email}}</td>
                        <td>
                            {{ user.user_id.email_perso}}
                        </td>
                        <td>
                            {{
                            user.user_id.phone
                            }}
                        </td>
                        <td>{{ user.user_id.rue_adresse}}{{user.user_id.ville_adresse}}{{ user.user_id.pays_adresse}}
                        </td>


                        <td></td>

                    </tr>


                </ng-template>

            </p-table>
            <h5 style="color: rgb(48, 121, 230);font-weight: bold;">
                Choix académique
            </h5>
            <p-table responsiveLayout="scroll">
                <ng-template pTemplate="header">
                    <tr>
                        <th>Session</th>
                        <th>Ecole </th>
                        <th>Campus</th>
                        <th>Formation</th>
                        <th>Groupe</th>
                        <th>Rythme</th>
                        <th>Action</th>
                    </tr>
                </ng-template>
                <ng-template pTemplate="emptymessage">
                    <tr>
                        <td>{{user.formation}}</td>
                        <td>
                            {{ user.user_id.email_perso}}
                        </td>
                        <td>
                            {{
                            user.user_id.phone
                            }}
                        </td>
                        <td>{{ user.user_id.rue_adresse}}{{user.user_id.ville_adresse}}{{ user.user_id.pays_adresse}}
                        </td>


                        <td></td>

                    </tr>


                </ng-template>

            </p-table>
            <h5 style="color: rgb(48, 121, 230);font-weight: bold;">
                Source
            </h5>
            <p-table responsiveLayout="scroll">
                <ng-template pTemplate="header">
                    <tr>
                        <th>Source</th>
                        <th>Commercial </th>
                        <th>Adresse mail</th>
                        <th>Téléphone</th>
                        <th>Action</th>
                    </tr>
                </ng-template>
                <ng-template pTemplate="emptymessage">
                    <tr>
                        <td>{{user.source}}</td>
                        <td>
                            {{ user.user_id.email_perso}}
                        </td>
                        <td>
                            {{
                            user.user_id.phone
                            }}
                        </td>
                        <td>{{ user.user_id.rue_adresse}}{{user.user_id.ville_adresse}}{{ user.user_id.pays_adresse}}
                        </td>


                        <td></td>

                    </tr>


                </ng-template>

            </p-table>
            </td>
            </tr>
            </ng-template>

            </p-table>
        </p-tabPanel>
        <p-tabPanel header="Internationale">
            <div *ngIf="shownewLeadFormI" class="col-12 card">
                <h4 style="text-align: center;">Ajouter un nouveau lead </h4>
                <div style="text-align: center;">
                    <small>Tous les champs marqués d'un astérisque <span style="color: red;"> * </span> sont
                        obligatoires</small><br>
                </div>
                <br>
                <form class="p-fluid p-formgrid grid" (ngSubmit)="addNewProspect()" [formGroup]="newLeadForm">
                    <h5 class="col-12" style="text-align: center;">Etudiant</h5> <br>
                    <div class="field col-12 md:col-12">
                        <label For="type">Type <span style="color:red"> *</span></label>
                        <p-dropdown [options]="typeList" placeholder="Choisissez le type du lead"
                            (onChange)="onSelectEcole()" formControlName="type"></p-dropdown>
                    </div>


                    <div class="field col-12 md:col-2">
                        <label For="civilite">Civilité<span style="color: red;"> * </span></label>
                        <p-dropdown [options]="civiliteList" optionLabel="value" optionDisabled="actif"
                            placeholder="Choisissez une civilité" formControlName="civilite"></p-dropdown>
                    </div>
                    <div class="field col-12 md:col-5">
                        <label For="nom">Nom <span style="color: red;"> * </span></label>
                        <input pInputText id="nom" type="text" placeholder="Entrez votre nom"
                            formControlName="lastname" />
                    </div>
                    <div class="field col-12 md:col-5">
                        <label For="prenom">Prénom <span style="color: red;"> * </span></label>
                        <input pInputText id="prenom" type="text" placeholder="Entrez votre prénom"
                            formControlName="firstname" />
                    </div>
                    <div class="field col-12 md:col-6">
                        <label For="date_naissance">Date de naissance <span style="color: red;"> *
                            </span></label>
                        <input type="date" formControlName="date_naissance" pInputText />
                    </div>
                    <div class="field col-12 md:col-6">
                        <label>Pays de résidence :<span style="color:red"> *</span></label><br>
                        <p-dropdown formControlName="pays" [options]="paysList" placeholder="Pays" optionLabel="value"
                            emptyFilterMessage="Pas de pays trouvé" filterPlaceholder="Pays" filter="true"
                            optionDisabled="actif"></p-dropdown>
                    </div>
                    <div class="field col-12 md:col-6">
                        <label For="nationalite">Nationalité <span style="color: red;"> * </span></label>
                        <p-dropdown formControlName="nationalite" [options]="nationList" optionLabel="label"
                            emptyFilterMessage="Pas de nationalité trouvé" filterPlaceholder="Nationalité"
                            filter="true"></p-dropdown>
                    </div>
                    <h5 class="col-12" style="text-align: center;">Contact</h5> <br>
                    <div class="field col-12 md:col-3">
                        <label For="indicatif">Indicatif <span style="color: red;"> * </span></label>
                        <input pInputText id="indicatif" type="text" placeholder="+33" formControlName="indicatif" />
                    </div>
                    <div class="field col-12 md:col-9">
                        <label For="telephone">Numéro de téléphone <span style="color: red;"> *
                            </span></label>
                        <input pInputText id="telephone" type="number" placeholder="Entrez votre numéro de téléphone"
                            formControlName="phone" />
                    </div>
                    <div class="field col-12 md:col-6">

                        <label>Adresse électronique :<span style="color:red"> *</span></label>
                        <input type="email" formControlName="email_perso" placeholder="Email" (blur)="verifEmailInBD()"
                            pInputText>
                    </div>


                    <h5 class="col-12" style="text-align: center;">Choix académique</h5><br>
                    <div class="field col-12 md:col-12">
                        <label For="role">Ecole <span style="color:red"> *</span></label>
                        <p-dropdown [options]="EcoleListRework" placeholder="Choisissez l'école du lead"
                            (onChange)="onSelectEcole()" formControlName="ecole"></p-dropdown>
                    </div>
                    <div class="field col-12">
                        <label>Choix du campus <span style="color: red;"> * </span></label>
                        <p-dropdown [options]="campusDropdown" optionLabel="value" formControlName="campus"
                            placeholder="Choisissez un campus">
                        </p-dropdown>
                    </div>

                    <div class="field col-12 md:col-12">
                        <label>Choix de la rentrée <span style="color: red;"> * </span></label>
                        <p-dropdown [options]="rentreeList" formControlName="rentree_scolaire"
                            placeholder="Choisissez une rentrée" placeholder="Choisissez la rentrée scolaire">
                        </p-dropdown>
                    </div>

                    <div class="field col-12 md:col-4">
                        <label>Choix du programme <span style="color: red;"> * </span></label>
                        <p-dropdown [options]="programList" optionLabel="value" formControlName="programme"
                            placeholder="Choisissez un programme">
                        </p-dropdown>
                    </div>
                    <div class="field col-12 md:col-8" *ngIf="newLeadForm.value.programme.value=='Programme Anglais'">
                        <label For="formation">Choix de la formation <span style="color: red;">
                                *</span></label>
                        <p-dropdown [options]="programEnDropdown" placeholder="Choose a english program"
                            autoWidth="false" [filter]="true" [group]="true" [style]="{'width':'100%'}"
                            formControlName="formation"></p-dropdown>
                    </div>
                    <div class="field col-12 md:col-8" *ngIf="newLeadForm.value.programme.value=='Programme Français'">
                        <label For="programme_fr">Choix de la formation <span style="color: red;"> *
                            </span></label>
                        <p-dropdown [options]="programeFrDropdown" placeholder="Choissiez un programme français"
                            [filter]="true" [group]="true" [style]="{'width':'100%'}" autoWidth="false"
                            formControlName="formation"></p-dropdown>
                    </div>
                    <div class="field col-12 md:col-12">
                        <label For="rythme">Rythme de la formation <span style="color: red;"> *
                            </span></label>
                        <p-dropdown [options]="typeFormationDropdown" optionLabel="value" autoWidth="false"
                            placeholder="Choisissez un rythme" [style]="{'width':'100%'}"
                            formControlName="rythme_formation"></p-dropdown>
                    </div>

                    <div class="field col-12 md:col-6" *ngIf="!isPartenaireExterne">
                        <label For="role">Source <span style="color:red"> *</span></label> <!--SI INTERNE-->
                        <p-dropdown [options]="sourceList" placeholder="Choisissez la provenance du lead"
                            (onChange)="changeSource($event.value)" formControlName="source"></p-dropdown>
                    </div>
                    <div class="field col-12 md:col-6" *ngIf="!isPartenaireExterne"> <!--SI INTERNE-->
                        <label For="role">Commercial</label>
                        <p-dropdown [options]="commercialList" filter="true"
                            placeholder="Choisissez le commercial qui a ajouté le lead"
                            formControlName="commercial"></p-dropdown>
                    </div>
                    <div style="justify-content: right;">
                        <button pButton type="submit" label="Ajouter" (click)="shownewLeadFormI=true"
                            [disabled]="(newLeadForm.invalid && !isPartenaireExterne) || (!newLeadForm.value.ecole)"></button>
                    </div>
                </form>
            </div>
            <div class="grid ">
                <div class=" field col-3">
                    <button pButton label="Filtrer" class="p-button mb-2" icon="pi pi-filter"></button><br>
                    <button pButton label="Vider&nbsp; " class="p-button" icon="pi pi-filter-slash"></button><br> <br>
                </div>
                <div class=" field col-6">
                    <input pInputText type="text" style="width: 20em;" placeholder="Recherche" />
                </div>
                <div class=" field col-3">
                    <button pButton pRipple (click)="shownewLeadFormI=true" icon="pi pi-plus"
                        class="mr-2 mb-2"></button>
                </div>
            </div>
            <p-table #dt1 [value]="prospectI" dataKey="_id" responsiveLayout="scroll"
                [globalFilterFields]="['nom', 'choix', 'rythme']" [rows]="8" [pageLinks]="5" [paginator]="true"
                rowExpandMode="single" [totalRecords]="" styleClass="p-datatable-gridlines">

                <ng-template pTemplate="header">
                    <tr>
                        <th style="width: 5em"></th>
                        <th pSortableColumn="id">
                            ID<p-sortIcon field="id"> </p-sortIcon>
                        </th>
                        <th pSortableColumn="nom">
                            Prénom et Nom<p-sortIcon field="nom"> </p-sortIcon>
                        </th>
                        <th pSortableColumn="choix">
                            Choix académique <p-sortIcon field="choix"> </p-sortIcon>
                        </th>
                        <th pSortableColumn="rythme">
                            Rythme <p-sortIcon field="rythme"> </p-sortIcon>
                        </th>
                        <th pSortableColumn="decision">
                            Décision admission<p-sortIcon field="decision"> </p-sortIcon>
                        </th>

                        <th pSortableColumn="paiement">
                            Paiement<p-sortIcon field="paiement"> </p-sortIcon>
                        </th>

                        <th pSortableColumn="etape">
                            Etape<p-sortIcon field="etape"> </p-sortIcon>
                        </th>

                        <th pSortableColumn="date">
                            Date d'inscription<p-sortIcon field="date">
                            </p-sortIcon>

                        <th>Action</th>
                    </tr>
                </ng-template>
                <ng-template pTemplate="body" let-prospect>
                    <tr>
                        <td>
                            <button type="button" pButton pRipple [pRowToggler]="prospect"
                                class="p-button-text p-button-rounded p-button-plain" [icon]="
                                    expanded
                                        ? 'pi pi-chevron-down'
                                        : 'pi pi-chevron-right'
                                "></button>
                        </td>
                        <td>
                            {{ prospect.customid}}
                        </td>
                        <td>
                            {{ prospect.user_id.firstname | titlecase }}
                            {{ prospect.user_id.lastname | uppercase }}
                        </td>
                        <td>
                            {{prospect.rentree_scolaire}},{{ prospect.formation}},{{prospect.campus_choix_1}}
                        </td>
                        <td>
                            {{prospect.rythme_formation}}
                        </td>
                        <td>
                            {{ prospect?.niveau}}
                        </td>
                        <td>
                            {{ prospect?.payement}}
                        </td>


                        <td>
                            {{ prospect?.etat_dossier}}
                        </td>
                        <td>
                            {{ prospect?.date_creation}}
                        </td>
                        <td>
                            <i *ngIf="candidatureDic && candidatureDic[prospect._id]"
                                style="padding-left: 3%;color: rgb(11, 36, 0);" class="pi pi-envelope m-1" pBadge
                                value="1" pTooltip="Candidature" aria-hidden="true"
                                (click)="goToCandidature(prospect._id)" tooltipPosition="bottom"></i>
                            <i pTooltip="Envoyer un mail" tooltipPosition="bottom" class="pi pi-at m-1"
                                style="padding-left: 3%" aria-hidden="true"
                                (click)="initSendEmail(prospect);scrollToTop()"> </i>
                            <i *ngIf="!candidatureDic || !candidatureDic[prospect._id]"
                                style="padding-left: 3%;color: rgb(11, 36, 0);" class="pi pi-envelope m-1"
                                pTooltip="Candidature" aria-hidden="true" (click)="goToCandidature(prospect._id)"
                                tooltipPosition="bottom"></i>

                            <i style="padding-left: 3%;color: rgb(11, 36, 0);" class="pi pi-euro m-1"
                                (click)="initPaiement(prospect);scrollToTop()" pTooltip="Paiement" aria-hidden="true"
                                tooltipPosition="bottom"></i>

                            <i pTooltip="Documents administratif" tooltipPosition="bottom" class="pi pi-file m-1"
                                (click)="initDocument(prospect);scrollToTop()" aria-hidden="true"></i>

                            <i style="padding-left: 3%; " class="pi pi-building m-1" pTooltip="Admission"
                                (click)="onshowDossier(prospect)" aria-hidden="true" tooltipPosition="bottom"></i>

                            <i style="padding-left: 3%;color: rgb(72, 72, 255);
                                " class="pi pi-pencil m-1" (click)="initupdateLeadForm(prospect); scrollToTop()"
                                pTooltip="Modifier" aria-hidden="true" tooltipPosition="bottom"></i>

                            <i style="padding-left: 3%; color: rgb(255, 0, 0)" class="pi pi-trash m-1"
                                (click)="deletePro(prospect)" pTooltip="Supprimer" aria-hidden="true"
                                tooltipPosition="bottom"></i>
                        </td>
                    </tr>
                </ng-template>
                <ng-template pTemplate="rowexpansion" let-user>
                    <tr>
                        <td colspan="10">


                            <h5 style="color: rgb(48, 121, 230);font-weight: bold;">
                                Détails
                            </h5>
                            <p-table responsiveLayout="scroll">
                                <ng-template pTemplate="header">
                    <tr>

                        <th>ID</th>
                        <th>Prénom et Nom </th>
                        <th>Date de naissance</th>
                        <th>Pays de résidence</th>
                        <th>Nationalité</th>
                        <th>Action</th>

                    </tr>
                </ng-template>
                <ng-template pTemplate="emptymessage">
                    <tr>
                        <td>{{ user.customid }}</td>
                        <td>
                            {{ user.user_id.firstname | titlecase }}
                            {{ user.user_id.lastname | uppercase }}
                        </td>
                        <td>
                            {{
                            user.date_naissance | date:'dd MMMM yy'
                            }}
                        </td>
                        <td>{{ user.user_id.pays_adresse}}</td>
                        <td>
                            {{user.user_id.nationnalite}}
                        </td>

                        <td></td>
                    </tr>


                </ng-template>

            </p-table>
            <h5 style="color: rgb(48, 121, 230);font-weight: bold;">
                Contact
            </h5>
            <p-table responsiveLayout="scroll">
                <ng-template pTemplate="header">
                    <tr>
                        <th>Adresse mail</th>
                        <th>Adresse mail école </th>
                        <th>numéro de téléphone</th>
                        <th>Adresse</th>
                        <th>Action</th>
                    </tr>
                </ng-template>
                <ng-template pTemplate="emptymessage">
                    <tr>
                        <td>{{user.user_id.email}}</td>
                        <td>
                            {{ user.user_id.email_perso}}
                        </td>
                        <td>
                            {{
                            user.user_id.phone
                            }}
                        </td>
                        <td>{{ user.user_id.rue_adresse}}{{user.user_id.ville_adresse}}{{ user.user_id.pays_adresse}}
                        </td>


                        <td></td>

                    </tr>


                </ng-template>

            </p-table>
            <h5 style="color: rgb(48, 121, 230);font-weight: bold;">
                Choix académique
            </h5>
            <p-table responsiveLayout="scroll">
                <ng-template pTemplate="header">
                    <tr>
                        <th>Session</th>
                        <th>Ecole </th>
                        <th>Campus</th>
                        <th>Formation</th>
                        <th>Groupe</th>
                        <th>Rythme</th>
                        <th>Action</th>
                    </tr>
                </ng-template>
                <ng-template pTemplate="emptymessage">
                    <tr>
                        <td>{{user.formation}}</td>
                        <td>
                            {{ user.user_id.email_perso}}
                        </td>
                        <td>
                            {{
                            user.user_id.phone
                            }}
                        </td>
                        <td>{{ user.user_id.rue_adresse}}{{user.user_id.ville_adresse}}{{ user.user_id.pays_adresse}}
                        </td>


                        <td></td>

                    </tr>


                </ng-template>

            </p-table>
            <h5 style="color: rgb(48, 121, 230);font-weight: bold;">
                Source
            </h5>
            <p-table responsiveLayout="scroll">
                <ng-template pTemplate="header">
                    <tr>
                        <th>Source</th>
                        <th>Commercial </th>
                        <th>Adresse mail</th>
                        <th>Téléphone</th>
                        <th>Action</th>
                    </tr>
                </ng-template>
                <ng-template pTemplate="emptymessage">
                    <tr>
                        <td>{{user.source}}</td>
                        <td>
                            {{ user.user_id.email_perso}}
                        </td>
                        <td>
                            {{
                            user.user_id.phone
                            }}
                        </td>
                        <td>{{ user.user_id.rue_adresse}}{{user.user_id.ville_adresse}}{{ user.user_id.pays_adresse}}
                        </td>


                        <td></td>

                    </tr>


                </ng-template>

            </p-table>
            </td>
            </tr>
            </ng-template>

            </p-table>
        </p-tabPanel>
        <p-tabPanel header="Réinscription">
            <div *ngIf="shownewRIForm" class="col-12 card">
                <h4 style="text-align: center;"> Réinscription </h4>
                <div style="text-align: center;">
                    <small>Tous les champs marqués d'un astérisque <span style="color: red;"> * </span> sont
                        obligatoires</small><br>
                </div>
                <br>
                <form class="p-fluid p-formgrid grid" (ngSubmit)="addNewProspect()" [formGroup]="RIForm">
                    <h5 class="col-12" style="text-align: center;">Etudiant</h5> <br>
                    <div class="field col-12 md:col-12">
                        <label For="etudiant">Etudiant <span style="color:red"> *</span></label>
                        <p-dropdown [options]="typeList" placeholder="Choisissez l'étudiant"
                            (onChange)="onSelectEtudiat()" formControlName="etudiant"></p-dropdown>
                    </div>


                    <div class="field col-12 md:col-2">
                        <label For="civilite">Civilité<span style="color: red;"> * </span></label>
                        <p-dropdown [options]="civiliteList" optionLabel="value" optionDisabled="actif"
                            placeholder="Choisissez une civilité" formControlName="civilite"></p-dropdown>
                    </div>
                    <div class="field col-12 md:col-5">
                        <label For="nom">Nom <span style="color: red;"> * </span></label>
                        <input pInputText id="nom" type="text" placeholder="Entrez votre nom"
                            formControlName="lastname" />
                    </div>
                    <div class="field col-12 md:col-5">
                        <label For="prenom">Prénom <span style="color: red;"> * </span></label>
                        <input pInputText id="prenom" type="text" placeholder="Entrez votre prénom"
                            formControlName="firstname" />
                    </div>
                    <div class="field col-12 md:col-6">
                        <label For="date_naissance">Date de naissance <span style="color: red;"> *
                            </span></label>
                        <input type="date" formControlName="date_naissance" pInputText />
                    </div>
                    <div class="field col-12 md:col-6">
                        <label>Pays de résidence :<span style="color:red"> *</span></label><br>
                        <p-dropdown formControlName="pays" [options]="paysList" placeholder="Pays" optionLabel="value"
                            emptyFilterMessage="Pas de pays trouvé" filterPlaceholder="Pays" filter="true"
                            optionDisabled="actif"></p-dropdown>
                    </div>
                    <div class="field col-12 md:col-6">
                        <label For="nationalite">Nationalité <span style="color: red;"> * </span></label>
                        <p-dropdown formControlName="nationalite" [options]="nationList" optionLabel="label"
                            emptyFilterMessage="Pas de nationalité trouvé" filterPlaceholder="Nationalité"
                            filter="true"></p-dropdown>
                    </div>
                    <h5 class="col-12" style="text-align: center;">Contact</h5> <br>
                    <div class="field col-12 md:col-3">
                        <label For="indicatif">Indicatif <span style="color: red;"> * </span></label>
                        <input pInputText id="indicatif" type="text" placeholder="+33" formControlName="indicatif" />
                    </div>
                    <div class="field col-12 md:col-9">
                        <label For="telephone">Numéro de téléphone <span style="color: red;"> *
                            </span></label>
                        <input pInputText id="telephone" type="number" placeholder="Entrez votre numéro de téléphone"
                            formControlName="phone" />
                    </div>
                    <div class="field col-12 md:col-6">

                        <label>Email :<span style="color:red"> *</span></label>
                        <input type="email" formControlName="email_perso" placeholder="Email" (blur)="verifEmailInBD()"
                            pInputText>
                    </div>
                    <div class="field col-12 md:col-6">

                        <label>Numéro rue:<span style="color:red"> *</span></label>
                        <input formControlName="rue" placeholder="rue" pInputText>
                    </div>
                    <div class="field col-12 md:col-6">

                        <label>ville:<span style="color:red"> *</span></label>
                        <input formControlName="ville" placeholder="ville" pInputText>
                    </div>
                    <div class="field col-12 md:col-6">

                        <label>code postale:<span style="color:red"> *</span></label>
                        <input formControlName="codep" placeholder="code postale" pInputText>
                    </div>


                    <h5 class="col-12" style="text-align: center;">Choix académique</h5><br>
                    <div class="field col-12 md:col-12">
                        <label For="role">Ecole <span style="color:red"> *</span></label>
                        <p-dropdown [options]="EcoleListRework" placeholder="Choisissez l'école du lead"
                            (onChange)="onSelectEcole()" formControlName="ecole"></p-dropdown>
                    </div>
                    <div class="field col-12">
                        <label>Choix du campus <span style="color: red;"> * </span></label>
                        <p-dropdown [options]="campusDropdown" optionLabel="value" formControlName="campus"
                            placeholder="Choisissez un campus">
                        </p-dropdown>
                    </div>

                    <div class="field col-12 md:col-12">
                        <label>Choix de la rentrée <span style="color: red;"> * </span></label>
                        <p-dropdown [options]="rentreeList" formControlName="rentree_scolaire"
                            placeholder="Choisissez une rentrée" placeholder="Choisissez la rentrée scolaire">
                        </p-dropdown>
                    </div>

                    <div class="field col-12 md:col-4">
                        <label>Choix du programme <span style="color: red;"> * </span></label>
                        <p-dropdown [options]="programList" optionLabel="value" formControlName="programme"
                            placeholder="Choisissez un programme">
                        </p-dropdown>
                    </div>
                    <div class="field col-12 md:col-8" *ngIf="newLeadForm.value.programme.value=='Programme Anglais'">
                        <label For="formation">Choix de la formation <span style="color: red;">
                                *</span></label>
                        <p-dropdown [options]="programEnDropdown" placeholder="Choose a english program"
                            autoWidth="false" [filter]="true" [group]="true" [style]="{'width':'100%'}"
                            formControlName="formation"></p-dropdown>
                    </div>
                    <div class="field col-12 md:col-8" *ngIf="newLeadForm.value.programme.value=='Programme Français'">
                        <label For="programme_fr">Choix de la formation <span style="color: red;"> *
                            </span></label>
                        <p-dropdown [options]="programeFrDropdown" placeholder="Choissiez un programme français"
                            [filter]="true" [group]="true" [style]="{'width':'100%'}" autoWidth="false"
                            formControlName="formation"></p-dropdown>
                    </div>
                    <div class="field col-12 md:col-12">
                        <label For="rythme">Rythme de la formation <span style="color: red;"> *
                            </span></label>
                        <p-dropdown [options]="typeFormationDropdown" optionLabel="value" autoWidth="false"
                            placeholder="Choisissez un rythme" [style]="{'width':'100%'}"
                            formControlName="rythme_formation"></p-dropdown>
                    </div>

                    <div class="field col-12 md:col-6" *ngIf="!isPartenaireExterne">
                        <label For="role">Source <span style="color:red"> *</span></label> <!--SI INTERNE-->
                        <p-dropdown [options]="sourceList" placeholder="Choisissez la provenance du lead"
                            (onChange)="changeSource($event.value)" formControlName="source"></p-dropdown>
                    </div>
                    <div *ngIf="!itslead" class="field col-12 md:col-6"> <!--SI INTERNE-->
                        <label For="role">Commercial</label>
                        <p-dropdown [options]="commercialList" filter="true"
                            placeholder="Choisissez le commercial qui a ajouté le lead"
                            formControlName="commercial"></p-dropdown>
                    </div>
                    <div *ngIf="itslead" class="field col-12 md:col-6">
                        <label>Nom et prénom :<span style="color:red"> *</span></label>
                        <input formControlName="nomlead" placeholder="nom et pénom" pInputText>
                    </div> <br>
                    <div style="justify-content: right;">
                        <button pButton type="submit" label="Ajouter"
                            [disabled]="(newLeadForm.invalid && !isPartenaireExterne) || (!newLeadForm.value.ecole)"></button>
                    </div>
                </form>
            </div>
            <div class="grid ">
                <div class=" field col-3">
                    <button pButton label="Filtrer" class="p-button mb-2" icon="pi pi-filter"></button><br>
                    <button pButton label="Vider&nbsp; " class="p-button" icon="pi pi-filter-slash"></button><br> <br>
                </div>
                <div class=" field col-6">
                    <input pInputText type="text" style="width: 20em;" placeholder="Recherche" />
                </div>
                <div class=" field col-3">
                    <button pButton pRipple icon="pi pi-plus" (click)="shownewRIForm=true" class="mr-2 mb-2"></button>
                </div>
            </div>

        </p-tabPanel>
        <p-tabPanel style="width: 100%;" [header]="PROSPECT.customid" *ngFor="let PROSPECT of proscteList"
            [closable]="true">
            <div>
                <p-accordion [(activeIndex)]="selectedTabIndex1">
                    <p-accordionTab>
                        <ng-template pTemplate="header">
                            <div>
                                <span style="font-weight: bold;">ETAPE 1</span> &nbsp;
                                <span style="font-weight: normal;">Dossier</span>
                            </div>
                        </ng-template>
                        <p-dialog header="Affecter un agent à ce ticket" [(visible)]="visible"
                            [style]="{width: '50vw'}">

                            <form [formGroup]="formAffectation" class="p-fluid p-formgrid grid col-12">
                                <div class="field col-6">
                                    <label>Agent: </label>
                                    <p-dropdown autoWidth="false" [style]="{'width':'100%'}" [options]="dropdownMember"
                                        formControlName="agent_id" filter="true"
                                        placeholder="Choisissez un membre"></p-dropdown>
                                </div>
                                <div class="field col-6">
                                    <label>DDL: </label>
                                    <input pInputText type="date" formControlName="date_limite" />
                                </div>
                                <div class="field col-12">
                                    <label For="description">Note de l'affectation <span style="color: red;"> *
                                        </span></label>
                                    <textarea pInputTextarea placeholder="Bon courage"
                                        formControlName="note_assignation" autoResize rows="3" cols="30"></textarea>
                                </div>
                                <div class="col-12">
                                    <p-button [style]="{'width':'100%'}" autoWidth="false" (onClick)="onAffectation()"
                                        label="Affecter cette agent" [disabled]="formAffectation.invalid"></p-button>
                                </div>
                            </form>
                        </p-dialog>
                        <h4 style="text-align: center;color: green;" *ngIf="defaultEtatDossier === 'Complet'">Etat du
                            dossier <p-dropdown [options]="etat_dossierDropdown"
                                placeholder="Choisissez l'etat du dossier" [(ngModel)]="defaultEtatDossier"
                                (onChange)="onSelectEtat($event,PROSPECT)"></p-dropdown> </h4>
                        <h4 style="text-align: center;color: orange;" *ngIf="defaultEtatDossier === 'En attente'">Etat
                            du dossier <p-dropdown [options]="etat_dossierDropdown"
                                placeholder="Choisissez l'etat du dossier" [(ngModel)]="defaultEtatDossier"
                                (onChange)="onSelectEtat($event,PROSPECT)"></p-dropdown> </h4>
                        <h4 style="text-align: center;color: red;" *ngIf="defaultEtatDossier === 'Manquant'">Etat du
                            dossier <p-dropdown [options]="etat_dossierDropdown"
                                placeholder="Choisissez l'etat du dossier" [(ngModel)]="defaultEtatDossier"
                                (onChange)="onSelectEtat($event,PROSPECT)"></p-dropdown> </h4>
                        <p-table #dt1 [value]="ticket" dataKey="_id" responsiveLayout="scroll"
                            [globalFilterFields]="['nom', 'choix', 'rythme']" [rows]="8" [pageLinks]="5"
                            [paginator]="true" rowExpandMode="single" [totalRecords]=""
                            styleClass="p-datatable-gridlines">
                            <ng-template pTemplate="header">
                                <tr>
                                    <th style="width: 5em"></th>
                                    <th pSortableColumn="id">
                                        ID Ticket <p-sortIcon field="id"> </p-sortIcon>
                                    </th>
                                    <th pSortableColumn="nom">
                                        Statut <p-sortIcon field="nom"> </p-sortIcon>
                                    </th>
                                    <th pSortableColumn="choix">
                                        Assigné à <p-sortIcon field="choix"> </p-sortIcon>
                                    </th>
                                    <th pSortableColumn="rythme">
                                        Traité le <p-sortIcon field="rythme"> </p-sortIcon>
                                    </th>
                                    <th>Action</th>
                                </tr>
                            </ng-template>
                            <ng-template pTemplate="body" let-ticket>

                                <tr>
                                    <td>
                                        <button type="button" pButton pRipple [pRowToggler]="ticket"
                                            class="p-button-text p-button-rounded p-button-plain" [icon]="
                                    expanded
                                        ? 'pi pi-chevron-down'
                                        : 'pi pi-chevron-right'
                                "></button>
                                    </td>
                                    <td>
                                        {{ ticket?.customid }}
                                    </td>
                                    <td>
                                        {{ ticket?.statut }}
                                    </td>
                                    <td>
                                        {{ ticket?.agent_id?.firstname}}
                                    </td>
                                    <td>

                                    </td>
                                    <td>
                                        <i style="padding-left: 3%;color: rgb(72, 72, 255);
                                " class="pi pi-send m-1" (click)="showDialog(ticket); scrollToTop()"
                                            pTooltip="Affecter" aria-hidden="true" tooltipPosition="bottom"></i>
                                    </td>
                                </tr>
                            </ng-template>
                            <ng-template pTemplate="rowexpansion" let-user>
                                <tr>
                                    <td colspan="6">


                                        <p-table responsiveLayout="scroll">
                                            <ng-template pTemplate="header">
                                <tr>

                                    <th>Commentaire</th>
                                    <th>Commenté par </th>
                                    <th>Commenté le </th>


                                </tr>
                            </ng-template>
                            <ng-template pTemplate="emptymessage">
                                <tr>
                                    <td></td>
                                    <td>
                                        {{ user?.user_id?.firstname | titlecase }}
                                        {{ user?.user_id?.lastname | uppercase }}
                                    </td>
                                    <td>
                                        {{
                                        user?.date_naissance
                                        }}
                                    </td>

                                </tr>


                            </ng-template>

                        </p-table>

                        </ng-template>

                        </p-table>
                        <div class="col-12">
                            <input type="file" (change)="uploadFile($event.target.files)" id="selectedFile"
                                #selectedFile style="display: none;" accept=".png, .jpg, .jpeg, .jfif" pInputFile />
                            <input type="file" (change)="uploadOtherFile($event.target.files)" id="selectedFileOther"
                                #selectedFileOther style="display: none;" accept=".png, .jpg, .jpeg, .jfif"
                                pInputFile />
                        </div>
                        <a href="javascript:void(0)" (click)="onshowDocuments()">Afficher le dossier -></a>
                        <div class="card grid" *ngIf="PROSPECT && showDocuments">
                            <h3 class="col-12">Documents</h3>
                            <p-table [value]="PROSPECT.documents_dossier" #dt1 dataKey="_id" class="col-12"
                                responsiveLayout="scroll" styleClass="p-datatable-gridlines">
                                <ng-template pTemplate="header">
                                    <tr>
                                        <th>Document</th>
                                        <th>Lien</th>
                                        <th>Action</th>
                                    </tr>
                                </ng-template>
                                <ng-template pTemplate="body" let-doc>
                                    <tr>
                                        <td>{{doc.nom}}</td>
                                        <td>
                                            <a *ngIf="doc.path" (click)="downloadFile(doc)">Télécharger le document</a>
                                        </td>
                                        <td>
                                            <i pTooltip="Ajouter un fichier" tooltipPosition="bottom" class="pi pi-file"
                                                (click)="initUpload(doc)" style="margin-left: 2%;"
                                                aria-hidden="true"></i>
                                            <i pTooltip="Supprimer" style="margin-left: 2%; cursor: pointer;"
                                                class="pi pi-trash" (click)="delete(doc)" aria-hidden="true"></i>
                                        </td>
                                    </tr>
                                </ng-template>
                            </p-table>
                            <h3 class="col-8">Autre documents</h3>
                            <div class="col-4">
                                <p-button [style]="{'width':'100%'}" (click)="addDoc()" icon="pi pi-plus"
                                    autoWidth="false" label="Ajouter un autre document"></p-button>
                            </div>
                            <p-table [value]="PROSPECT.documents_autre" #dt1 dataKey="_id" [rows]="8"
                                rowExpandMode="single" [rows]="8" [rowHover]="true" class="col-12" [paginator]="true"
                                [pageLinks]="5" [globalFilterFields]="['libelle','email','site']"
                                responsiveLayout="scroll" [filterDelay]="0" styleClass="p-datatable-gridlines">
                                <ng-template pTemplate="header">
                                    <tr>
                                        <th>Document</th>
                                        <th>Lien</th>
                                        <th>Action</th>
                                    </tr>
                                </ng-template>
                                <ng-template pTemplate="body" let-doc let-ri="rowIndex">
                                    <tr [pEditableRow]="doc">
                                        <td pEditableColumn>
                                            <p-cellEditor>
                                                <ng-template pTemplate="input">
                                                    <input type="text" pInputText [(ngModel)]="doc.nom">
                                                </ng-template>
                                                <ng-template pTemplate="output">
                                                    {{doc.nom}}
                                                </ng-template>
                                            </p-cellEditor>
                                        </td>
                                        <td>
                                            <a *ngIf="doc.path" (click)="downloadOtherFile(doc)">Télécharger le
                                                document</a>
                                        </td>
                                        <td>
                                            <i pTooltip="Ajouter un fichier" tooltipPosition="bottom" class="pi pi-file"
                                                *ngIf="doc.nom!='Cliquer pour modifier le nom du document ici'"
                                                (click)="initUpload(doc,'selectedFileOther')" style="margin-left: 2%;"
                                                aria-hidden="true"></i>
                                            <i pTooltip="Supprimer" style="margin-left: 2%; cursor: pointer;"
                                                class="pi pi-trash" (click)="deleteOther(doc)" aria-hidden="true"></i>
                                        </td>
                                    </tr>
                                </ng-template>
                            </p-table>
                        </div>
                    </p-accordionTab>
                    <p-accordionTab>
                        <ng-template pTemplate="header">
                            <div>
                                <span style="font-weight: bold;">ETAPE 2</span> &nbsp;
                                <span style="font-weight: normal;">Evaluation</span>
                            </div>
                        </ng-template>
                        <p-dialog header="Modifier l'évaluation" [(visible)]="visible_evaluation"
                            [style]="{width: '50vw'}">

                            <form [formGroup]="formAffectation" class="p-fluid p-formgrid grid col-12">
                                <div class="field col-6">
                                    <label>Evaluation </label>
                                    <p-dropdown autoWidth="false" [style]="{'width':'100%'}" [options]="dropdownMember"
                                        formControlName="agent_id" filter="true"
                                        placeholder="Choisissez un membre"></p-dropdown>
                                </div>
                                <div class="field col-6">
                                    <label>Score </label>
                                    <input pInputText type="number" formControlName="date_limite" />
                                </div>
                                <div class="field col-6">
                                    <label For="description">Durée <span style="color: red;"> *
                                        </span></label>
                                    <input pInputText type="number" formControlName="date_limite" />
                                </div>
                                <div class="field col-6">
                                    <label>date de passastion </label>
                                    <input pInputText type="date" formControlName="date_limite" />
                                </div>
                                <div class="field col-6">
                                    <label>date de l'envoi </label>
                                    <input pInputText type="date" formControlName="date_limite" />
                                </div>
                                <div class="field col-6">
                                    <label For="description">Durée <span style="color: red;"> *
                                        </span></label>
                                    <input pInputText type="number" formControlName="date_limite" />
                                </div>
                                <div class="col-12">
                                    <p-button [style]="{'width':'100%'}" autoWidth="false" (onClick)="onAffectation()"
                                        label="Enregistrer" [disabled]="formAffectation.invalid"></p-button>
                                </div>
                            </form>
                        </p-dialog>
                        <p-table #dt1 [value]="prospects" dataKey="_id" responsiveLayout="scroll"
                            [globalFilterFields]="['nom', 'choix', 'rythme']" [rows]="8" [pageLinks]="5"
                            [paginator]="true" rowExpandMode="single" [totalRecords]=""
                            styleClass="p-datatable-gridlines">

                            <ng-template pTemplate="header">
                                <tr>
                                    <th pSortableColumn="id">
                                        Evaluation<p-sortIcon field="id"> </p-sortIcon>
                                    </th>
                                    <th pSortableColumn="nom">
                                        Score<p-sortIcon field="nom"> </p-sortIcon>
                                    </th>
                                    <th pSortableColumn="choix">
                                        Durée <p-sortIcon field="choix"> </p-sortIcon>
                                    </th>
                                    <th pSortableColumn="rythme">
                                        Date de l'envoie <p-sortIcon field="rythme"> </p-sortIcon>
                                    </th>
                                    <th pSortableColumn="decision">
                                        Date de passastion<p-sortIcon field="decision"> </p-sortIcon>
                                    </th>
                                    <th>Action</th>
                                </tr>
                            </ng-template>
                            <ng-template pTemplate="body" let-prospect>
                                <tr>
                                    <td>
                                        https
                                    </td>
                                    <td>
                                        %
                                    </td>
                                    <td>
                                        min
                                    </td>
                                    <td></td>
                                    <td></td>
                                    <td>
                                        <i style="padding-left: 3%;color: rgb(72, 72, 255);
                                " class="pi pi-pencil m-1" (click)="initEvaluation(prospect); scrollToTop()"
                                            pTooltip="Modifier" aria-hidden="true" tooltipPosition="bottom"></i>
                                        <i style="padding-left: 3%; color: rgb(255, 0, 0)" class="pi pi-trash m-1"
                                            (click)="deletePro(prospect)" pTooltip="Supprimer la formation"
                                            aria-hidden="true" tooltipPosition="bottom"></i>
                                    </td>
                                </tr>
                            </ng-template>
                        </p-table>
                        <br>
                        <p-button icon="pi pi-plus"></p-button>
                    </p-accordionTab>
                    <p-accordionTab>
                        <ng-template pTemplate="header">
                            <div>
                                <span style="font-weight: bold;">ETAPE 3</span> &nbsp;
                                <span style="font-weight: normal;">Entretien</span>
                            </div>
                        </ng-template>
                        <p-table #dt1 [value]="ticket" dataKey="_id" responsiveLayout="scroll"
                            [globalFilterFields]="['nom', 'choix', 'rythme']" [rows]="8" [pageLinks]="5"
                            [paginator]="true" rowExpandMode="single" [totalRecords]=""
                            styleClass="p-datatable-gridlines">
                            <ng-template pTemplate="header">
                                <tr>
                                    <th style="width: 5em"></th>
                                    <th pSortableColumn="id">
                                        ID Ticket <p-sortIcon field="id"> </p-sortIcon>
                                    </th>
                                    <th pSortableColumn="nom">
                                        Statut <p-sortIcon field="nom"> </p-sortIcon>
                                    </th>
                                    <th pSortableColumn="choix">
                                        Assigné à <p-sortIcon field="choix"> </p-sortIcon>
                                    </th>
                                    <th pSortableColumn="rythme">
                                        Traité le <p-sortIcon field="rythme"> </p-sortIcon>
                                    </th>
                                    <th>Action</th>
                                </tr>
                            </ng-template>
                            <ng-template pTemplate="body" let-ticket>

                                <tr>
                                    <td>
                                        <button type="button" pButton pRipple [pRowToggler]="ticket"
                                            class="p-button-text p-button-rounded p-button-plain" [icon]="
                                    expanded
                                        ? 'pi pi-chevron-down'
                                        : 'pi pi-chevron-right'
                                "></button>
                                    </td>
                                    <td>
                                        {{ ticket?.customid }}
                                    </td>
                                    <td>
                                        {{ ticket?.statut }}

                                    </td>
                                    <td>
                                        {{ ticket?.agent_id?.firstname}}
                                    </td>
                                    <td>

                                    </td>
                                    <td>
                                        <i style="padding-left: 3%;color: rgb(72, 72, 255);
                                " class="pi pi-send m-1" (click)="showDialog(ticket); scrollToTop()"
                                            pTooltip="Affecter" aria-hidden="true" tooltipPosition="bottom"></i>
                                    </td>
                                </tr>
                            </ng-template>
                            <ng-template pTemplate="rowexpansion" let-user>
                                <tr>
                                    <td colspan="6">


                                        <p-table responsiveLayout="scroll">
                                            <ng-template pTemplate="header">
                                <tr>

                                    <th>Commentaire</th>
                                    <th>Commenté par </th>
                                    <th>Commenté le </th>


                                </tr>
                            </ng-template>
                            <ng-template pTemplate="emptymessage">
                                <tr>
                                    <td></td>
                                    <td>

                                    </td>
                                    <td>

                                    </td>

                                </tr>


                            </ng-template>

                        </p-table>

                        </ng-template>

                        </p-table>
                        <h4>Compte rendu de l'entretien préalable à la formation </h4>
                        <br>
                        <form class="p-fluid p-formgrid grid" (ngSubmit)="addEntretien()" [formGroup]="entretienForm">
                            <div class="field col-12 md:col-6">
                                <label For="date_e">Date <span style="color: red;"> *
                                    </span></label>
                                <input type="date" formControlName="date_e" pInputText />
                            </div>
                            <div class="field col-12 md:col-6">
                                <label For="duree_e">Durée <span style="color:red"> *</span></label>
                                <input type="number" formControlName="duree_e" pInputText />
                            </div>
                            <div class="field col-12 md:col-6">
                                <label For="niveau">Niveau actuel de l'apprenat<span style="color: red;"> *
                                    </span></label>
                                <p-dropdown [options]="niveux_dropdown" [style]="{'width':'100%'}"
                                    placeholder="Entrez le niveau de l'apprenat" formControlName="niveau"></p-dropdown>
                            </div>
                            <div class="field col-12 md:col-6">
                                <label For="parcour">L'apprenant a-t-il déjà suivi un parcours en formation de la
                                    matière?<span style="color: red;"> * </span></label>
                                <input pInputText id="nom" type="text" formControlName="parcour" />
                            </div>
                            <div class="field col-12 md:col-12">
                                <label For="choix">Pourquoi avoir choisi cette formation <span style="color: red;"> *
                                    </span></label>
                                <textarea pInputTextarea formControlName="choix" autoResize rows="5"
                                    cols="30"></textarea>
                            </div>
                            <div class="field col-12 md:col-5"></div>
                            <div class="field col-12 md:col-1">
                                <p-button (click)="addEntretien()">Enregistrer</p-button>
                            </div>
                            <div class="field col-12 md:col-5"></div>
                        </form>
                    </p-accordionTab>
                    <p-accordionTab>
                        <ng-template pTemplate="header">
                            <div>
                                <span style="font-weight: bold;">ETAPE 4</span> &nbsp;
                                <span style="font-weight: normal;">Décision</span>
                            </div>
                        </ng-template>
                        <form class="p-fluid p-formgrid grid" (ngSubmit)="addNewProspect()" [formGroup]="DecisionForm">
                            <div class="field col-12 md:col-6">
                                <label For="decisoin_admission">Décision du conseil d'oriontation pédagogique<span
                                        style="color: red;"> *
                                    </span></label>
                                <p-dropdown [options]="decision_dropdown" [style]="{'width':'100%'}"
                                    formControlName="decisoin_admission"></p-dropdown>
                            </div>
                            <div class="field col-12 md:col-6">
                                <label For="date_d">Date <span style="color: red;"> *
                                    </span></label>
                                <input type="date" formControlName="date_d" pInputText />
                            </div>
                            <div class="field col-12 md:col-12">
                                <label For="explication">Expliquation<span style="color: red;"> *
                                    </span></label><br>
                                <textarea pInputTextarea formControlName="explication" autoResize rows="5"
                                    cols="50"></textarea>
                            </div>

                            <div class="field col-12 md:col-9"></div>

                            <div class="field col-12 md:col-5"></div>
                            <div class="field col-12 md:col-1">
                                <p-button (click)="adddicision(prospect)">Enregistrer</p-button>
                            </div>
                            <div class="field col-12 md:col-5"></div>
                        </form>
                    </p-accordionTab>
                </p-accordion>
            </div>
        </p-tabPanel>

    </p-tabView>
</div>
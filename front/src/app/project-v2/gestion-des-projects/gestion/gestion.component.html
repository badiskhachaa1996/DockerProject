<input type="file" (change)="FileUpload($event.target.files)" id="selectedFilesuivre" #selectedFilesuivre
    style="display: none;" accept=".png, .jpg, .jpeg, .jfif" pInputFile />
<p-tabView [(activeIndex)]="selectedTabIndex">
    <p-tabPanel header="Créer">
        <div class="card">


            <h3 class="text-center">Nouveau projet</h3>
            <form class="p-formgrid grid p-fluid" [formGroup]="formAddProject" (ngSubmit)="addProject()">

                <div class="field col-12 md:col-6">
                    <label htmlFor="titre">Titre du projet <span style="color: red">*</span></label>
                    <textarea formControlName="titre" pInputTextarea placeholder="Donnez un titre à votre projet"
                        autoResize rows="2" cols="40"></textarea>
                </div>

                <div class="field col-12 md:col-6">
                    <label>Responsable <span style="color: red">*</span></label>
                    <p-dropdown formControlName="responsable" [options]="responsableListe" filter="true"
                        placeholder="responsable" [showClear]="true"></p-dropdown>
                </div>

                <div class="field col-12 md:col-6">
                    <label htmlFor="debut">Début <span style="color: red">*</span></label>
                    <p-calendar formControlName="debut" [showIcon]="true" [showButtonBar]="true"></p-calendar>
                </div>
                <div class="field col-12 md:col-6">
                    <label htmlFor="fin">Fin <span style="color: red">*</span></label>
                    <p-calendar formControlName="fin" [showIcon]="true" [showButtonBar]="true"></p-calendar>
                </div>

                <div class="field col-12 ">
                    <label htmlFor="description">Description <span style="color: red">*</span></label>
                    <textarea formControlName="description" pInputTextarea
                        placeholder="Donnez une description à votre projet" autoResize rows="4" cols="30"></textarea>
                </div>
                <div class="field col-12 md:col-10"></div>
                <div class="field col-12 md:col-2">
                    <button pButton pRipple type="submit" class="my-2" label="Enregistrer"
                        [disabled]="formAddProject.invalid"></button>
                </div>
            </form>
        </div>
    </p-tabPanel>
    <p-tabPanel header="Dashboard">
        <div class="grid col-12 card">
            <div class="col-4">
                <div class="card mb-0">
                    <div class="flex justify-content-between mb-4">
                        <div>
                            <span class="block text-500 font-medium mb-4">Nombre total des projets {{nbr_project
                                }}</span>

                        </div>
                        <div class="flex align-items-center justify-content-center bg-blue-100 border-round"
                            [ngStyle]="{width: '2.5rem', height: '2.5rem'}">
                            <i class="pi pi-shield text-blue-500 text-xl"></i>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-4">
                <div class="card mb-0">
                    <div class="flex justify-content-between mb-4">
                        <div>
                            <span class="block text-500 font-medium mb-4">Nombre total des projets en cours
                                {{nbr_project}}</span>

                        </div>
                        <div class="flex align-items-center justify-content-center bg-cyan-100 border-round"
                            [ngStyle]="{width: '2.5rem', height: '2.5rem'}">
                            <i class="pi pi-replay text-cyan-500 text-xl"></i>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-4">
                <div class="card mb-0">
                    <div class="flex justify-content-between mb-4">
                        <div>
                            <span class="block text-500 font-medium mb-4">Nombre total des Projets cloturés
                                {{nbr_projectCloturer }}</span>

                        </div>
                        <div class="flex align-items-center justify-content-center bg-green-100 border-round"
                            [ngStyle]="{width: '2.5rem', height: '2.5rem'}">
                            <i class="pi pi-check-square text-green-500 text-xl"></i>
                        </div>
                    </div>
                </div>
            </div>


        </div>
        <p-table #dt1 dataKey="_id" [rows]="8" [rowHover]="true" [value]="project" [paginator]="true"
            rowExpandMode="single" [pageLinks]="5" selectionMode="single" class="col-12"
            [globalFilterFields]="['project_id', 'titre','sujet']" responsiveLayout="scroll"
            styleClass="p-datatable-gridlines">
            <ng-template pTemplate="caption">
                <div class="flex justify-content-between flex-column sm:flex-row">
                    <input pInputText type="text" #filter (input)="dt1.filterGlobal($event.target.value, 'contains')"
                        placeholder="Recherche" />

                    <p-dropdown [style]="{'margin':'5px'}" [options]="filterStatut" filter="true"
                        (onChange)="dt1.filter($event.value, 'statut', 'equals');" placeholder="Choisissez un etat"
                        emptyFilterMessage="Pas d'état trouvé" filterPlaceholder="Choisissez un état"></p-dropdown>



                </div>
            </ng-template>
            <ng-template pTemplate="header">
                <tr>
                    <th style="width: 3rem"></th>
                    <th pSortableColumn="project_id" style="text-align:center"> ID Projet <p-sortIcon field="customid">
                        </p-sortIcon>
                    </th>
                    <th pSortableColumn="titre" style="text-align:center"> Titre <p-sortIcon field="titre">
                        </p-sortIcon>
                    </th>
                    <th pSortableColumn="created_date" style="text-align:center"> Date de création <p-sortIcon
                            field="created_date">
                        </p-sortIcon>
                    </th>
                    <th pSortableColumn="createur_id.lastname" style="text-align:center"> Crée par <p-sortIcon
                            field="user_id">
                        </p-sortIcon>
                    </th>
                    <th pSortableColumn="responsable projet" style="text-align:center"> Responsable Projet <p-sortIcon
                            field="service">
                        </p-sortIcon>
                    </th>
                    <th pSortableColumn="sujet" style="text-align:center"> Etat <p-sortIcon field="sujet">
                        </p-sortIcon>
                    </th>
                    <th pSortableColumn="priorite" style="text-align:center">Avancement <p-sortIcon field="priorite">
                        </p-sortIcon>
                    </th>
                    <th pSortableColumn="priorite" style="text-align:center"> Actions <p-sortIcon field="priorite">
                        </p-sortIcon>
                    </th>
                </tr>
            </ng-template>
            <ng-template pTemplate="body" let-project let-expanded="expanded" let-ri="rowIndex">
                <tr>
                    <td>
                        <button type="button" pButton pRipple [pRowToggler]="project"
                            class="p-button-text p-button-rounded p-button-plain"
                            [icon]="expanded ? 'pi pi-chevron-down' : 'pi pi-chevron-right'">
                        </button>
                    </td>
                    <td>
                        {{project.identifian}}
                    </td>
                    <td>
                        {{project.titre}}
                    </td>
                    <td>
                        {{project.created_date | date:'dd MMMM yy'}}
                    </td>

                    <td>
                        {{project?.createur | titlecase}}
                    </td>
                    <td>
                        {{project?.responsable | titlecase}}
                    </td>

                    <td>
                        <p-tag *ngIf="project.etat == null" icon="pi pi-times" severity="success" [value]="'En cours'">
                        </p-tag>
                        <p-tag *ngIf="project.statut == 'En suspension'" icon="pi pi-pause" severity="danger"
                            [value]="project.statut">
                        </p-tag>
                        <p-tag *ngIf="project.statut == 'cloturer'" icon="pi pi-check-square" severity="success"
                            [value]="project.statut">
                        </p-tag>
                    </td>
                    <td>
                        {{project.avancement| number:'1.1-1'}} %
                    </td>
                    <td>
                        <i pTooltip="Modifier" style="margin-left: 3%; cursor: pointer;" class="pi pi-pencil"
                            (click)="initialisation_project(project)" aria-hidden="true"></i>
                        <i pTooltip="Supprimer" style="margin-left: 3%; cursor: pointer;" class="pi pi-trash"
                            (click)="delete(project._id,ri)" aria-hidden="true"></i>
                        <i pTooltip="activités" style="margin-left: 3%; cursor: pointer;" class="pi pi-align-justify"
                            (click)=" showTaskList(project) ; showtache=true" aria-hidden="true"></i>
                        <i pTooltip="ressources" style="margin-left: 3%; cursor: pointer;" class="pi pi-info"
                            (click)="showRessources(project._id)" aria-hidden="true"></i>
                        <i pTooltip="budjet" style="margin-left: 3%; cursor: pointer;" class="pi pi-money-bill"
                            (click)="showBudget(project._id)" aria-hidden="true"></i>


                    </td>
                </tr>
            </ng-template>



            <ng-template pTemplate="rowexpansion" let-ticket>    
                <tr>
                    <td colspan="9">
                        <h4>{{ticket.titre}}</h4>
                        <p-table class="col-12" styleClass="p-datatable-gridlines">
                            <ng-template pTemplate="header">
                <tr>
                    <th> Description </th>
                    <th> Date de debut </th>
                    <th> Date de fin </th>
                </tr>
            </ng-template>
            <ng-template pTemplate="emptymessage">
                <tr>
                    <td>{{ticket.description}}</td>
                    <td>{{ticket.debut| date:'dd MMMM yy'}}</td>
                    <td>{{ticket.fin| date:'dd MMMM yy'}}</td>

                </tr>

            </ng-template>


        </p-table>

        </td>
        </tr>




        </ng-template>


        </p-table>
    </p-tabPanel>
    <p-tabPanel header="Reporting">
        <app-dashboard-project-v2></app-dashboard-project-v2>
    </p-tabPanel>
    <p-tabPanel style="width: 100%;" header="Project -  {{projectSelected?.titre}}"
        *ngFor="let projectSelected of projectSelecteds " [closable]="true">
        <p-card>
            <div class="grid col-12">
                <div class="col-3">
                    <label for="avancement"> <strong> Avancement</strong></label>
                    {{projectSelected?.avancement| number:'1.1-1'}} %

                </div>
                
                    <div class="col-3">
                       <strong>Responsable : </strong>{{projectSelected.responsable}}
                    </div>
                    <div class="col-3">
                        <strong> Créé le : </strong>{{projectSelected.created_date| date:'dd MMMM yy' }}
                    </div>
                    <div class="col-3">
                        <strong> Créé par :</strong> {{projectSelected.createur}}
                    
                </div>
            </div>
        </p-card>
        <div class="grid col-12">
            <div class="col-4 ">
                <p-card header="To DO " class="card-todo">
                    <ng-container *ngFor="let t of taskToDo">
                        <p-card>
                            <p-card-header>
                                <div class="grid col-12">
                                    <div class="col-11">
                                        <strong> {{t?.libelle}}</strong>
                                    </div>
                                    <div class="col-1">
                                        <i class="pi pi-ellipsis-h" style="color: green" (click)="onShowTache(t)"></i>
                                    </div>
                                </div>
                            </p-card-header>
                            <div class="grid col-12">
                                <div class="col-12">
                                    {{t.description_task}}
                                </div>

                                <div class="col-12">
                                    Assigné à
                                    <ng-container *ngFor="let user of t?.attribuate_to; let last = last">
                                        {{user.firstname}} {{user.lastname}}{{!last ? ', ' : ''}}
                                    </ng-container>
                                </div>


                            </div>
                            <p-card-footer>
                                <div class="grid col-12">
                                    <div class="col-11"></div>
                                    <div class="col-1">
                                        <i class="pi pi-arrow-right" style="color: green" (click)="ToDoing(t)"></i>
                                    </div>
                                </div>
                            </p-card-footer>
                        </p-card><br>
                    </ng-container>
                    <p-button icon="pi pi-plus" [rounded]="true" [outlined]="true"
                        (click)="showAddTacheForm=true"></p-button>
                </p-card>
            </div>
            <div class="col-4 ">
                <p-card header="Doing ">
                    <ng-container *ngFor="let t of taskDoing">
                        <p-card>
                            <p-card-header>
                                <div class="grid col-12">
                                    <div class="col-11">
                                        <strong> {{t?.libelle}}</strong>
                                    </div>
                                    <div class="col-1">
                                        <i class="pi pi-ellipsis-h" style="color: green" (click)="onShowTache(t)"></i>
                                    </div>
                                </div>
                            </p-card-header>

                            <div class="grid col-12">
                                <div class="col-12">
                                    {{t.description_task}}
                                </div>
                                <div *ngIf="test" class="col-12">
                                    Assigné à
                                    <ng-container *ngFor="let user of t?.attribuate_to; let last = last">
                                        {{user.firstname}} {{user.lastname}}{{!last ? ', ' : ''}}
                                    </ng-container>
                                </div>


                            </div>
                            <p-card-footer>
                                <div class="grid col-12">
                                    <div class="col-1">
                                        <i class="pi pi-arrow-left" style="color: green" (click)="ToToDo(t)"></i>
                                    </div>
                                    <div class="col-10"></div>
                                    <div class="col-1">
                                        <i class="pi pi-arrow-right" style="color: green" (click)="ToDone(t)"></i>
                                    </div>
                                </div>
                            </p-card-footer>
                        </p-card><br>
                    </ng-container>
                </p-card>
            </div>
            <div class="col-4 ">
                <p-card header="Done ">
                    <ng-container *ngFor="let t of taskDone">
                        <p-card>
                            <p-card-header>
                                <div class="grid col-12">
                                    <div class="col-11">
                                        <strong> {{t?.libelle}}</strong>
                                    </div>
                                    <div class="col-1">
                                        <i class="pi pi-ellipsis-h" style="color: green" (click)="onShowTache(t)"></i>
                                    </div>
                                </div>
                            </p-card-header>

                            <div class="grid col-12">
                                <div class="col-12">
                                    {{t.description_task}}
                                </div>

                                <div class="col-12">
                                    Assigné à
                                    <ng-container *ngFor="let user of t?.attribuate_to; let last = last">
                                        {{user.firstname}} {{user.lastname}}{{!last ? ', ' : ''}}
                                    </ng-container>
                                </div>

                            </div>
                            <p-card-footer>
                                <div class="grid col-12">
                                    <div class="col-1">
                                        <i class="pi pi-arrow-left" style="color: green" (click)="ToDoing(t)"></i>
                                    </div>
                                    <div class="col-11">

                                    </div>
                                </div>
                            </p-card-footer>
                        </p-card><br>
                    </ng-container>
                </p-card>
            </div>


        </div>

    </p-tabPanel>




</p-tabView>






<div *ngIf="showUpdateTacheForm">
    <i class="pi pi-times-circle" style="color: red; font-size: 20px; cursor: pointer; float: right;"
        (click)="showUpdateTacheForm = false; showOtherTextArea = false;"></i>
    <div style="float: right"></div>


    <h3 class="text-center">Modifier cette activité</h3>
    <form class="p-formgrid grid p-fluid" [formGroup]="formAddTache" (ngSubmit)="onUpdatetask()">

        <div class="field col-12 md:col-12">
            <label htmlFor="libelle">Libellé <span style="color: red">*</span></label>
            <textarea formControlName="libelle" pInputTextarea placeholder="Donnez un titre à votre projet" autoResize
                rows="1" cols="100"></textarea>
        </div>

        <div class="field col-12">
            <label>Priorité <span style="color: red">*</span></label>
            <p-dropdown formControlName="priorite" [options]="prioriteListe" filter="true" placeholder="priorite"
                [showClear]="true" (onChange)="onShowOtherTextArea($event)"></p-dropdown>
        </div>

        <div class="field col-12 md:col-6">
            <label htmlFor="number_of_hour">Nombre d'heurs <span style="color: red">*</span></label>
            <input formControlName="number_of_hour" pInputText type="number" id="nb_jour">
        </div>
        <div class="field col-12 md:col-6">
            <label htmlFor="date_limite">Date limite <span style="color: red">*</span></label>
            <p-calendar formControlName="date_limite" [showIcon]="true" [showButtonBar]="true"></p-calendar>
        </div>

        <div class="field col-12 ">
            <label htmlFor="description">Description <span style="color: red">*</span></label>
            <textarea formControlName="description" pInputTextarea placeholder="Donnez une discription à votre activité"
                autoResize rows="4" cols="30"></textarea>
        </div>

        <button pButton pRipple type="submit" class="my-2" label="Modifier" [disabled]="formAddTache.invalid"></button>
    </form>
</div>

<div *ngIf="showUpdateRessourcesForm">
    <i class="pi pi-times-circle" style="color: red; font-size: 20px; cursor: pointer; float: right;"
        (click)="showUpdateRessourcesForm = false; showOtherTextArea = false;"></i>
    <div style="float: right"></div>
    <h3 class="text-center">Modifier cette ressource</h3>
    <form class="p-formgrid grid p-fluid" [formGroup]="formAddressources" (ngSubmit)="onUpdateressources()">

        <div class="field col-12 md:col-12">
            <label htmlFor="nom">nom <span style="color: red">*</span></label>
            <textarea formControlName="nom" pInputTextarea placeholder="Donnez un titre à votre projet" autoResize
                rows="2" cols="40"></textarea>
        </div>
        <div class="field col-12 ">
            <label htmlFor="importance">Importance <span style="color: red">*</span></label>
            <textarea formControlName="importance" pInputTextarea placeholder="" autoResize rows="4"
                cols="30"></textarea>
        </div>

        <button pButton pRipple type="submit" class="my-2" label="Modifier"
            [disabled]="formAddressources.invalid"></button>
    </form>
</div>

<div *ngIf="showAddRessourcesForm">
    <i class="pi pi-times-circle" style="color: red; font-size: 20px; cursor: pointer; float: right;"
        (click)="showAddRessourcesForm = false; showOtherTextArea = false;"></i>
    <div style="float: right"></div>
    <h3 class="text-center">Ajouter une ressource</h3>
    <form class="p-formgrid grid p-fluid" [formGroup]="formAddressources" (ngSubmit)="addRessources()">

        <div class="field col-12 md:col-12">
            <label htmlFor="nom">nom <span style="color: red">*</span></label>
            <textarea formControlName="nom" pInputTextarea placeholder="Donnez un titre à votre projet" autoResize
                rows="2" cols="40"></textarea>
        </div>
        <div class="field col-12 ">
            <label htmlFor="importance">Importance <span style="color: red">*</span></label>
            <textarea formControlName="importance" pInputTextarea placeholder="" autoResize rows="4"
                cols="30"></textarea>
        </div>

        <button pButton pRipple type="submit" class="my-2" label="Ajouter"
            [disabled]="formAddressources.invalid"></button>
    </form>
</div>

<div *ngIf="showUpdateBudgetForm">
    <i class="pi pi-times-circle" style="color: red; font-size: 20px; cursor: pointer; float: right;"
        (click)="showUpdateBudgetForm = false; showOtherTextArea = false;"></i>
    <div style="float: right"></div>
    <h3 class="text-center">Modifier ce budget</h3>
    <form class="p-formgrid grid p-fluid" [formGroup]="formAddbudget" (ngSubmit)="onUpdatebudget()">

        <div class="field col-12 md:col-12">
            <label htmlFor="libelle">Libellé <span style="color: red">*</span></label>
            <textarea formControlName="libelle" pInputTextarea placeholder="Donnez un titre à votre projet" autoResize
                rows="2" cols="40"></textarea>
        </div>

        <div class="field col-12 md:col-6">
            <label htmlFor="charge">charge <span style="color: red">*</span></label>
            <input formControlName="charge" pInputText type="number" id="depense">
        </div>

        <div class="field col-12 md:col-6">
            <label htmlFor="depense">Dépense <span style="color: red">*</span></label>
            <input formControlName="depense" pInputText type="number" id="depense">
        </div>


        <button pButton pRipple type="submit" class="my-2" label="Modifier" [disabled]="formAddbudget.invalid"></button>
    </form>
</div>

<div *ngIf="showAddBudgetForm">
    <i class="pi pi-times-circle" style="color: red; font-size: 20px; cursor: pointer; float: right;"
        (click)="showAddBudgetForm = false; showOtherTextArea = false;"></i>
    <div style="float: right"></div>
    <h3 class="text-center">Ajouter un Budget</h3>
    <form class="p-formgrid grid p-fluid" [formGroup]="formAddbudget" (ngSubmit)="addBudget()">

        <div class="field col-12 md:col-12">
            <label htmlFor="libelle">Libellé <span style="color: red">*</span></label>
            <textarea formControlName="libelle" pInputTextarea placeholder="Donnez un titre à votre projet" autoResize
                rows="2" cols="40"></textarea>
        </div>
        <div class="field col-12 md:col-6 ">
            <label htmlFor="charge">Charge <span style="color: red">*</span></label>
            <input formControlName="charge" pInputText type="number" id="depense">
        </div>
        <div class="field col-12 md:col-6">
            <label htmlFor="depense">Dépense <span style="color: red">*</span></label>
            <input formControlName="depense" pInputText type="number" id="depense">
        </div>


        <button pButton pRipple type="submit" class="my-2" label="Ajouter" [disabled]="formAddbudget.invalid"></button>
    </form>
</div>


<div *ngIf="showbudget" class="card">
    <i class="pi pi-times-circle" style="color: red; font-size: 20px; cursor: pointer; float: right;"
        (click)="showbudget = false; showOtherTextArea = false;"></i>
    <div style="float: right"></div>
    <h3 class="text-center">Le budget </h3>
    <button pButton pRipple label="Nouveau budget" style="float: right;" class="p-button-outlined mb-2"
        (click)="showAddBudgetForm = true"></button>


    <div style="float: right"></div>
    <div class="grid col-12 ">
        <div class="col-4">
            <div class="card mb-0">
                <div class="flex justify-content-between mb-4">
                    <div>
                        <span class="block text-500 font-medium mb-4">Budget estimé</span>
                        <div class="text-900 font-medium text-xl">{{budget_charge }}</div>
                    </div>
                    <div class="flex align-items-center justify-content-center bg-blue-100 border-round"
                        [ngStyle]="{width: '2.5rem', height: '2.5rem'}">
                        <i class="pi pi-money-bill text-blue-500 text-xl"></i>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-4">
            <div class="card mb-0">
                <div class="flex justify-content-between mb-4">
                    <div>
                        <span class="block text-500 font-medium mb-4">Dépenses</span>
                        <div class="text-900 font-medium text-xl">{{budgect_depense }}</div>
                    </div>
                    <div class="flex align-items-center justify-content-center bg-cyan-100 border-round"
                        [ngStyle]="{width: '2.5rem', height: '2.5rem'}">
                        <i class="pi pi-minus text-cyan-500 text-xl"></i>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-4">
            <div class="card mb-0">
                <div class="flex justify-content-between mb-4">
                    <div>
                        <span class="block text-500 font-medium mb-4">Balance</span>
                        <div class="text-900 font-medium text-xl">{{budget_charge - budgect_depense }}</div>
                    </div>
                    <div class="flex align-items-center justify-content-center bg-green-100 border-round"
                        [ngStyle]="{width: '2.5rem', height: '2.5rem'}">
                        <i class="pi pi-money-bill text-green-500 text-xl"></i>
                    </div>
                </div>
            </div>
        </div>


    </div>
    <p-table [rows]="8" [rowHover]="true" [paginator]="true" [value]="budget" [paginator]="true" rowExpandMode="single"
        [pageLinks]="5" selectionMode="single" class="col-12" responsiveLayout="scroll"
        styleClass="p-datatable-gridlines">
        <ng-template pTemplate="header">
            <tr>

                <th pSortableColumn="libelle" style="text-align:center"> Libellé <p-sortIcon field="date_ajout">
                    </p-sortIcon>
                </th>
                <th pSortableColumn="charge" style="text-align:center"> charge <p-sortIcon field="user_id">
                    </p-sortIcon>
                </th>
                <th pSortableColumn="deponse" style="text-align:center"> Dépense <p-sortIcon field="user_id">
                    </p-sortIcon>
                </th>
                <th pSortableColumn="action" style="text-align:center"> Action <p-sortIcon field="user_id">
                    </p-sortIcon>
                </th>
            </tr>
        </ng-template>

        <ng-template pTemplate="body" let-budget let-rir="rowIndex">
            <tr>
                <td>{{budget.libelle}}</td>
                <td>{{budget.charge}}</td>
                <td>{{budget.depense}}</td>
                <td>
                    <i pTooltip="Modifier" style="margin-left: 3%; cursor: pointer;" class="pi pi-pencil"
                        (click)="initialisation_b(budget)" aria-hidden="true"></i>
                    <i pTooltip="Supprimer" style="margin-left: 3%; cursor: pointer;" class="pi pi-trash"
                        (click)="delete_b(budget._id,rir)" aria-hidden="true"></i>
                </td>
            </tr>
        </ng-template>


    </p-table>


</div>


<div *ngIf="showressources" class="card">
    <i class="pi pi-times-circle" style="color: red; font-size: 20px; cursor: pointer; float: right;"
        (click)="showressources = false; showOtherTextArea = false;"></i>
    <div style="float: right"></div>
    <button pButton pRipple label="Nouvelle ressource" style="float: right;" class="p-button-outlined mb-2"
        (click)="showAddRessourcesForm = true"></button>
    <h3 class="text-center">Liste des Ressources pour ce projet </h3>


    <p-table [rows]="8" [rowHover]="true" [paginator]="true" [value]="ressources" [paginator]="true"
        rowExpandMode="single" [pageLinks]="5" selectionMode="single" class="col-12" responsiveLayout="scroll"
        styleClass="p-datatable-gridlines">
        <ng-template pTemplate="header">
            <tr>
                <th style="width: 3rem"></th>
                <th pSortableColumn="ressources" style="text-align:center"> ressources <p-sortIcon field="date_ajout">
                    </p-sortIcon>
                </th>
                <th pSortableColumn="action" style="text-align:center"> Action <p-sortIcon field="user_id">
                    </p-sortIcon>
                </th>
            </tr>
        </ng-template>

        <ng-template pTemplate="body" let-ressources let-rir="rowIndex">
            <tr>
                <td>{{ rir + 1 }}</td>
                <td>{{ressources.nom}}</td>
                <td>
                    <i pTooltip="Modifier" style="margin-left: 3%; cursor: pointer;" class="pi pi-pencil"
                        (click)="initialisation_r(ressources)" aria-hidden="true"></i>
                    <i pTooltip="Supprimer" style="margin-left: 3%; cursor: pointer;" class="pi pi-trash"
                        (click)="delete_r(ressources._id,rir)" aria-hidden="true"></i>
                </td>
            </tr>
        </ng-template>


    </p-table>


</div>



<p-dialog header="Nouvelle activité pour ce project" [(visible)]="showAddTacheForm" [style]="{width: '40%'}">
    <form [formGroup]="formAddTache" (ngSubmit)="addTache(project)">
<div class="grid col-12">
        <div class="col-12 ">
            <label htmlFor="libelle">Libellé <span style="color: red">*</span></label><br>
            <input [style]="{width: '100%'}" formControlName="libelle" pInputTextarea placeholder="Donnez un titre à votre projet" autoResize>
        </div>

        <div class="col-12">
            <label>Priorité <span style="color: red">*</span></label><br>
            <p-dropdown [style]="{width: '100%'}" formControlName="priorite" [options]="prioriteListe" filter="true" placeholder="priorite"
                [showClear]="true"></p-dropdown>
        </div><br>
        

        <div class="col-12">
            <label htmlFor="number_of_hour">Nombre d'heurs <span style="color: red">*</span></label>
            <input [style]="{width: '100%'}" formControlName="number_of_hour" pInputText type="number" id="nb_jour">
        </div><br><br>
        <div class="col-12">
            <label htmlFor="date_limite">Date limite <span style="color: red">*</span></label>
            <input [style]="{width: '100%'}" pInputText type="date"  formControlName="date_limite" >
        </div><br>

        <div class="field col-12">
            <label htmlFor="description">Description <span style="color: red">*</span></label><br>
            <textarea [style]="{width: '100%'}" formControlName="description" pInputTextarea placeholder="Donnez une discription à votre activité"
                autoResize rows="4" cols="30"></textarea>
        </div><br>

        <button pButton pRipple type="submit" class="my-2" label="Ajouter" [disabled]="formAddTache.invalid"></button>
    </div>
    </form>
</p-dialog>
<p-sidebar [(visible)]="displayTache" position="right" [style]="{width:'30em'}">
    <form [formGroup]="taskToShowForm" class="p-fluid p-formgrid grid col-12">
        <div class="grid col-12" *ngIf="TaskToShow">

            <div class="grid col-12">
                <label>Assigné à :</label><br>
                <div class="col-11">
                    <p-multiSelect  [options]="userList" formControlName="attribuate_to"
                        filter="true"></p-multiSelect>
                </div>
                <div class="col-1">
                <i style="padding-top: 50%; color: rgb(72, 72, 255);
                    " class="pi pi-pencil m-1" (click)="onChange()" pTooltip="Modifier" aria-hidden="true"
                    tooltipPosition="bottom"></i>
                </div>
            </div>

            

            <div class="col-12">
                <label>Nombre des heures :</label><br>
                <input pInputText type="number"   autoWidth="false" [style]="{'width':'90%'}" formControlName="number_of_hour" 
                    placeholder="10" />
                <i style="padding-left: 3%;color: rgb(72, 72, 255);
                    " class="pi pi-pencil m-1" (click)="onChange()" pTooltip="Modifier" aria-hidden="true"
                    tooltipPosition="bottom"></i>
            </div>

            <div class="col-12">
                <label>DDL :</label><br>
                <input pInputText type="date" autoWidth="false" [style]="{'width':'90%'}" formControlName="date_limite"
                    filter="true" placeholder="etudiant@intedgroup.com" />
                <i style="padding-left: 3%;color: rgb(72, 72, 255);
                    " class="pi pi-pencil m-1" (click)="onChange()" pTooltip="Modifier" aria-hidden="true"
                    tooltipPosition="bottom"></i>
            </div>
            <div class="col-12">
                <label>description : :</label><br>
                <textarea pInputText autoWidth="false" [style]="{'width':'90%'}" formControlName="description_task"
                    filter="true" placeholder="Donnez une description "  ></textarea>
                <i style="padding-left: 3%;color: rgb(72, 72, 255);
                    " class="pi pi-pencil m-1" (click)="onChange()" pTooltip="Modifier" aria-hidden="true"
                    tooltipPosition="bottom"></i>
            </div>
            <div class="col-12">
                <label>Urgent :</label><br><br>
                <div class="row align-items-center">
                    <p-checkbox [binary]="true" formControlName="urgent" [(ngModel)]="urgent" (onChange)="onCheckboxChange($event)"></p-checkbox>
                    <i style="padding-left: 3%;color: rgb(72, 72, 255);
                    " class="pi pi-pencil m-1" (click)="onChange()" pTooltip="Modifier" aria-hidden="true"
                        tooltipPosition="bottom"></i>
                </div>
            </div>
        </div>
    </form>
    <div>
        <p-table #dtdocuments dataKey="_id" [value]="TaskToShow?.documents" class="col-12"
            styleClass="p-datatable-gridlines">
            <ng-template pTemplate="header">
                <tr>
                    <th pSortableColumn="nom" style="text-align: center;"> Nom <p-sortIcon field="nom">
                        </p-sortIcon>
                    </th>
                    <th>
                        Lien
                    </th>

                    <th style="text-align: center;">
                        Action
                    </th>
                </tr>
            </ng-template>
            <ng-template pTemplate="body" let-document let-ri="rowIndex">
                <tr [pEditableRow]="document">
                    <td pEditableColumn>
                        <p-cellEditor>
                            <ng-template pTemplate="input">
                                <input type="text" pInputText [(ngModel)]="document.nom">
                            </ng-template>
                            <ng-template pTemplate="output">
                                {{document?.nom}} &nbsp;
                            </ng-template>
                        </p-cellEditor>
                    </td>
                    <td *ngIf="document?.path">
                        <a (click)="downloadFile(ri)">Télécharger le document</a>
                    </td>
                    <td *ngIf="!document?.path">
                        <a (click)="uploadFile(ri)">Uploader le document</a>
                    </td>
                    <td>
                        <i style="padding-left: 3%;" pTooltip="Supprimer le document" tooltipPosition="bottom"
                            class="pi pi-trash mr-2" aria-hidden="true" (click)="deleteFile(ri)"> </i>
                        <i style="padding-left: 3%;" *ngIf="document?.path" pTooltip="Uploader le document"
                            tooltipPosition="bottom" class="pi pi-cloud-upload" aria-hidden="true"
                            (click)="uploadFile(ri)"> </i>
                    </td>
                </tr>
            </ng-template>
        </p-table>

    </div>
    <div>
        <button pButton label={{buttonName}} (click)="onAddDocumment()"></button>
    </div><br><br>
    <div class="grid col-12">
    <div class="col-6">
        <button pButton label="Supprimer" (click)="deleteTaskFromSiderbar()" class="p-button-danger"></button>
    </div>
    <div  class="col-6">
        <button pButton label="Archiver"   icon="pi pi-check" class="p-button"></button>
    </div>
</div>

</p-sidebar>

<div *ngIf="showCreateticket" class="col-12 card grid">
    <i class="pi pi-times-circle" style="color: red; font-size: 20px; cursor: pointer; float: right;"
        (click)="showCreateticket = false; showOtherTextArea = false;"></i>
    <h4 class="col-12" style="text-align: center;">Créer un ticket </h4>
    <form [formGroup]="TicketForm" (ngSubmit)="onAdd()" class="p-fluid p-formgrid grid col-12">
        <div class="field col-12 md:col-6">
            <label For="project">Projet <span style="color: red;"> * </span></label>
            <p-dropdown [options]="projectListe" formControlName="project" placeholder="Choisissez un projet"
                (onChange)="onProjectSelected($event)"></p-dropdown>
        </div>
        <div class="field col-12 md:col-6">
            <label For="task_id">Activité <span style="color: red;"> * </span></label>
            <p-dropdown [options]="taskListe" formControlName="task_id" placeholder="Choisissez une activité"
                (onChange)="onSelectedTache($event)"></p-dropdown>
        </div>
        <div class="field col-12 md:col-4">
            <label For="service">Service <span style="color: red;"> * </span></label>
            <p-dropdown [options]="serviceDropdown" formControlName="service_id" placeholder="Choisissez un service"
                (onChange)="onSelectService()"></p-dropdown>
        </div>
        <div class="field col-12 md:col-4">
            <label For="sujet">Sujet <span style="color: red;"> * </span></label>
            <p-dropdown [options]="sujetDropdown" formControlName="sujet_id"
                placeholder="Choisissez un sujet"></p-dropdown>
        </div>
        <div class="field col-12 md:col-4">
            <label For="sujet">Priorité <span style="color: red;"> * </span></label>
            <p-dropdown [options]="prioriteDropdown" formControlName="priorite"
                placeholder="Choisissez une priorité"></p-dropdown>
        </div>
        <div class="field col-12">
            <label For="description">Description du ticket <span style="color: red;"> * </span></label>
            <textarea pInputTextarea placeholder="Description du ticket" formControlName="description" autoResize
                rows="3" cols="30"></textarea>
        </div>
        <div class="col-12">
            <label>Pièce Jointe:</label>
            <p-fileUpload (uploadHandler)="onUpload($event, fu)" #fu mode="basic" customUpload="true"
                maxFileSize="1000000" [style]="{'width':'100%'}" autoWidth="false" [auto]="true">
            </p-fileUpload>
            <div>
                <ul *ngIf="uploadedFiles.length">
                    <li *ngFor="let file of uploadedFiles">{{file.name}} - {{file.size}} bytes <i class="pi pi-trash"
                            style="float:right; color: red; cursor: pointer;" pTooltip="Supprimer le fichier"
                            tooltipPosition="bottom" (click)="uploadedFiles.splice(uploadedFiles.indexOf(file))"
                            aria-hidden="true"> </i> </li>
                </ul>
            </div>
        </div>
        <div></div>

        <div class="col-3"></div>
        <div class="col-6">
            <div></div>
            <button [style]="{'width':'100%'}" autoWidth="false" pButton label="Créer le ticket" type="submit"
                [disabled]="TicketForm.invalid"></button>
        </div>
    </form>
</div>


<!--
<div *ngIf="showtache" class="card">
    <i class="pi pi-times-circle" style="color: red; font-size: 20px; cursor: pointer; float: right;"
        (click)="showtache = false; showOtherTextArea = false;"></i>
    <div></div>
    <button pButton pRipple label="Nouvelle activité " style="float: right; margin-right: 2%;"
        class="p-button-outlined mb-2" (click)="showAddTacheForm = true"></button>
    <h5 class="text-center">Les activités</h5>

    <div style="float: right"></div>

    <p-table #dt2 dataKey="_id" [rows]="8" [rowHover]="true" [paginator]="true" [value]="task" [paginator]="true"
        rowExpandMode="single" [pageLinks]="5" selectionMode="single" class="col-12"
        [globalFilterFields]="['customid', 'prenom', 'nom','email']" responsiveLayout="scroll"
        styleClass="p-datatable-gridlines">

        <ng-template pTemplate="header">
            <tr>
                <th></th>
                <th> ID activité </th>
                <th> ID Ticket </th>
                <th> Libellé </th>
                <th> Affecté à </th>
                <th> Etat d'avancement </th>
                <th> Action </th>

            </tr>
        </ng-template>

        <ng-template pTemplate="body" let-task let-expandedt="expandedt" let-rit="rowIndex">
            <tr>
                <td>
                    <button type="button" pButton pRipple [pRowToggler]="task"
                        class="p-button-text p-button-rounded p-button-plain"
                        [icon]="expandedt ? 'pi pi-chevron-down' : 'pi pi-chevron-right'">
                    </button>
                </td>

                <td>{{ task.identifian }}</td>
                <td><ng-container *ngFor="let t of task.ticketId">{{ t.customid}} <br></ng-container></td>
                <td>{{ task.libelle}}</td>
                <td><ng-container *ngFor="let a of task.ticketId ">{{ a?.agent_id?.firstname}} {{a?.agent_id?.lastname
                        }}<br></ng-container></td>
                <td>{{ task.etat }}</td>
                <td>
                    <i pTooltip="Modifier" style="margin-left: 3%; cursor: pointer;" class="pi pi-pencil"
                        (click)="initialisation(task)" aria-hidden="true"></i>
                    <i pTooltip="Supprimer" style="margin-left: 3%; cursor: pointer;" class="pi pi-trash"
                        (click)="deleteTask(task._id,ri)" aria-hidden="true"></i>
                    <i pTooltip="créé un ticket" style="margin-left: 3%; cursor: pointer;" class="pi pi-tag"
                        (click)=" transformtask(task) ; showtache=true" aria-hidden="true"></i>
                </td>



            </tr>
        </ng-template>



        <ng-template pTemplate="rowexpansion" let-tache>

            <tr>
                <td colspan="9">
                    <p-table class="col-12" styleClass="p-datatable-gridlines">
                        <ng-template pTemplate="header">
            <tr>
                <th> Description </th>
                <th> Date de fin </th>
                <th> nombre d'heurs </th>
            </tr>
        </ng-template>
        <ng-template pTemplate="emptymessage">
            <tr>
                <td>{{tache.description_task}}</td>
                <td>{{tache.date_limite| date:'dd MMMM yy'}}</td>
                <td>{{tache.number_of_hour}}</td>

            </tr>

        </ng-template>


    </p-table>
    </td>

    </tr>

    <tr>


        </ng-template>



        </p-table>
</div>-->



<div *ngIf="showUpdateProjectForm">
    <i class="pi pi-times-circle" style="color: red; font-size: 20px; cursor: pointer; float: right;"
        (click)="showUpdateProjectForm = false; showOtherTextArea = false;"></i>
    <div style="float: right"></div>

    <h3 class="text-center">Modifier ce projet</h3>
    <form class="p-formgrid grid p-fluid" [formGroup]="formAddProject" (ngSubmit)="UpdateProject()">

        <div class="field col-12 md:col-12">
            <label htmlFor="titre">Titre du projet <span style="color: red">*</span></label>
            <textarea formControlName="titre" pInputTextarea placeholder="Donnez un titre à votre projet" autoResize
                rows="2" cols="40"></textarea>
        </div>

        <div class="field col-12">
            <label>Responsable <span style="color: red">*</span></label>
            <p-dropdown formControlName="responsable" [options]="responsableListe" filter="true"
                placeholder="responsable" [showClear]="true" (onChange)="onShowOtherTextArea($event)"></p-dropdown>
        </div>

        <div class="field col-12 md:col-6">
            <label htmlFor="debut">Début <span style="color: red">*</span></label>
            <p-calendar formControlName="debut" [showIcon]="true" [showButtonBar]="true"></p-calendar>
        </div>
        <div class="field col-12 md:col-6">
            <label htmlFor="fin">Fin <span style="color: red">*</span></label>
            <p-calendar formControlName="fin" [showIcon]="true" [showButtonBar]="true"></p-calendar>
        </div>

        <div class="field col-12 ">
            <label htmlFor="description">Description <span style="color: red">*</span></label>
            <textarea formControlName="description" pInputTextarea placeholder="Donnez une discription à votre projet"
                autoResize rows="4" cols="30"></textarea>
        </div>
        <div class="field col-12 md:col-10"></div>
        <div class="field col-12 md:col-2">
            <button pButton pRipple type="submit" class="my-2" label="Envoyer"
                [disabled]="formAddProject.invalid"></button>
        </div>
    </form>
</div>






<div *ngIf="showAddProjectForm" class="card">
    <i class="pi pi-times-circle" style="color: red; font-size: 20px; cursor: pointer; float: right;"
        (click)="showAddProjectForm = false; showOtherTextArea = false;"></i>
    <div style="float: right"></div>

    <h3 class="text-center">Nouveau projet</h3>
    <form class="p-formgrid grid p-fluid" [formGroup]="formAddProject" (ngSubmit)="addProject()">

        <div class="field col-12 md:col-12">
            <label htmlFor="titre">Titre du projet <span style="color: red">*</span></label>
            <textarea formControlName="titre" pInputTextarea placeholder="Donnez un titre à votre projet" autoResize
                rows="2" cols="40"></textarea>
        </div>

        <div class="field col-12">
            <label>Responsable <span style="color: red">*</span></label>
            <p-dropdown formControlName="responsable" [options]="responsableListe" filter="true"
                placeholder="responsable" [showClear]="true" (onChange)="onShowOtherTextArea($event)"></p-dropdown>
        </div>

        <div class="field col-12 md:col-6">
            <label htmlFor="debut">Début <span style="color: red">*</span></label>
            <p-calendar formControlName="debut" [showIcon]="true" [showButtonBar]="true"></p-calendar>
        </div>
        <div class="field col-12 md:col-6">
            <label htmlFor="fin">Fin <span style="color: red">*</span></label>
            <p-calendar formControlName="fin" [showIcon]="true" [showButtonBar]="true"></p-calendar>
        </div>

        <div class="field col-12 ">
            <label htmlFor="description">Description <span style="color: red">*</span></label>
            <textarea formControlName="description" pInputTextarea placeholder="Donnez une description à votre projet"
                autoResize rows="4" cols="30"></textarea>
        </div>
        <div class="field col-12 md:col-10"></div>
        <div class="field col-12 md:col-2">
            <button pButton pRipple type="submit" class="my-2" label="Envoyer"
                [disabled]="formAddProject.invalid"></button>
        </div>
    </form>
</div>
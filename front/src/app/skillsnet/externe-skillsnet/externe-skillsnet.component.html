<div *ngIf="showAdd" class="col-12 card">
    <h3 style="text-align: center;">Ajouter un nouvel Externe</h3>
    <form class="p-fluid p-formgrid grid" [formGroup]="formAddExterne" (ngSubmit)="onAddExterne();">
        <div class="field col-12 ">
            <small>Tout les champs marqués d'un astérisque <span style="color:red">*</span> sont
                obligatoires</small>
        </div>

        <div class="field col-6">
            <label For="classe">Nom<span style="color:red">*</span>:</label><br>
            <input type="text" formControlName="lastname" class="form-control col-12" pInputText>
        </div>
        <div class="field col-6">
            <label For="classe">Prénom<span style="color:red">*</span>:</label><br>
            <input type="text" formControlName="firstname" class="form-control col-12" pInputText>
        </div>

        <div class="field col-6">
            <label For="classe">Civilité<span style="color:red">*</span>:</label><br>
            <p-dropdown [options]="civiliteList" formControlName="civilite" optionLabel="label" optionValue="label"
                placeholder="Choisissez la civilite">
            </p-dropdown>
        </div>

        <div class="field col-6">
            <label For="classe">Email Perso<span style="color:red">*</span>:</label><br>
            <input type="text" formControlName="email_perso" placeholder="email.placeholder@gmail.com"
                class="form-control col-12" pInputText>
        </div>

        <div class="field col-12 md:col-6">
            <label For="Téléphone">Téléphone </label><br>
            <ngx-intl-tel-input class="pInputText" [preferredCountries]="preferredCountries"
                [enableAutoCountrySelect]="true" [enablePlaceholder]="true" [searchCountryFlag]="true"
                [searchCountryField]="[
              SearchCountryField.Iso2,
              SearchCountryField.Name
            ]" [selectFirstCountry]="false" [selectedCountryISO]="CountryISO.France" [phoneValidation]="true"
                [separateDialCode]="separateDialCode" [numberFormat]="PhoneNumberFormat.National" name="phone"
                formControlName="phone"> </ngx-intl-tel-input>

        </div>

        <div class="field col-12 md:col-6">
            <label For="pays">Pays</label>
            <p-dropdown [options]="paysList" formControlName="pays_adresse" optionLabel="value"
                optionValue="value"></p-dropdown>
        </div>

        <div class="field md:col-7 col-12">
            <label For="postal_adresse">Code postale</label>
            <input pInputText id="postal_adresse" formControlName="postal_adresse" type="number" placeholder="94200" />
        </div>


        <div class="field col-12 md:col-5">
            <label For="ville">Ville</label>
            <input pInputText id="ville" formControlName="ville_adresse" type="text" placeholder="Paris" />
        </div>
        <div class="field col-12 md:col-4">
            <label For="numero_adresse">Numéro de rue</label>
            <input pInputText id="numero_adresse" formControlName="numero_adresse" type="number" placeholder="15" />
        </div>
        <div class="field col-12 md:col-8">
            <label For="rue_adresse">Rue</label>
            <input pInputText id="rue_adresse" formControlName="rue_adresse" type="text" placeholder="rue du louvre" />
        </div>

        <div class="field col-12">
            <label>Disponibilité</label>
            <p-calendar formControlName="date_naissance" autoWidth="false" [style]="{'width':'100%'}"></p-calendar>
        </div>

        <div>
            <button pButton type="submit" label="Ajouter l'externe"
                [disabled]="formAddExterne.invalid || emailExist"></button>
        </div>
    </form>
</div>

<div *ngIf="showUpdate" class="col-12 card">
    <h3 style="text-align: center;">Modifier un Externe</h3>
    <form class="p-fluid p-formgrid grid" [formGroup]="formUpdateExterne" (ngSubmit)="onUpdateExterne();">
        <div class="field col-12 ">
            <small>Tout les champs marqués d'un astérisque <span style="color:red">*</span> sont
                obligatoires</small>
        </div>

        <div class="field col-6">
            <label For="classe">Nom<span style="color:red">*</span>:</label><br>
            <input type="text" formControlName="lastname" class="form-control col-12" pInputText>
        </div>
        <div class="field col-6">
            <label For="classe">Prénom<span style="color:red">*</span>:</label><br>
            <input type="text" formControlName="firstname" class="form-control col-12" pInputText>
        </div>

        <div class="field col-6">
            <label For="classe">Civilité<span style="color:red">*</span>:</label><br>
            <p-dropdown [options]="civiliteList" formControlName="civilite" optionLabel="label" optionValue="label"
                placeholder="Choisissez la civilite">
            </p-dropdown>
        </div>

        <div class="field col-6">
            <label For="classe">Email Perso<span style="color:red">*</span>:</label><br>
            <input type="text" formControlName="email_perso" placeholder="email.placeholder@gmail.com"
                class="form-control col-12" pInputText>
        </div>

        <div class="field col-12 md:col-6">
            <label For="Téléphone">Téléphone </label><br>
            <ngx-intl-tel-input class="pInputText" [preferredCountries]="preferredCountries"
                [enableAutoCountrySelect]="true" [enablePlaceholder]="true" [searchCountryFlag]="true"
                [searchCountryField]="[
              SearchCountryField.Iso2,
              SearchCountryField.Name
            ]" [selectFirstCountry]="false" [selectedCountryISO]="CountryISO.France" [phoneValidation]="true"
                [separateDialCode]="separateDialCode" [numberFormat]="PhoneNumberFormat.National" name="phone"
                formControlName="phone"> </ngx-intl-tel-input>

        </div>

        <div class="field col-12 md:col-6">
            <label For="pays">Pays</label>
            <p-dropdown [options]="paysList" formControlName="pays_adresse" optionLabel="value"
                optionValue="value"></p-dropdown>
        </div>

        <div class="field md:col-7 col-12">
            <label For="postal_adresse">Code postale</label>
            <input pInputText id="postal_adresse" formControlName="postal_adresse" type="number" placeholder="94200" />
        </div>


        <div class="field col-12 md:col-5">
            <label For="ville">Ville</label>
            <input pInputText id="ville" formControlName="ville_adresse" type="text" placeholder="Paris" />
        </div>
        <div class="field col-12 md:col-4">
            <label For="numero_adresse">Numéro de rue</label>
            <input pInputText id="numero_adresse" formControlName="numero_adresse" type="number" placeholder="15" />
        </div>
        <div class="field col-12 md:col-8">
            <label For="rue_adresse">Rue</label>
            <input pInputText id="rue_adresse" formControlName="rue_adresse" type="text" placeholder="rue du louvre" />
        </div>

        <div class="field col-12">
            <label For="pays">Type</label>
            <p-dropdown [options]="typeList" formControlName="type"></p-dropdown>
        </div>

        <div>
            <button pButton type="submit" label="Mettre à jour l'externe"
                [disabled]="formUpdateExterne.invalid"></button>
        </div>
    </form>
</div>

<div class="card">
    <div style="float: right;">
        <button pButton label="Ajouter un externe" icon="pi pi-plus-circle" (click)="showAdd=true"
            style="margin-right: 3px;"></button>
    </div>
    <h5>Liste des externes</h5>
    <p-table #dt1 rowExpandMode="single" [value]="externes" dataKey="_id" [rows]="8" [rowHover]="true"
        [globalFilterFields]="['user_id.lastname', 'user_id.firstname','user_id.email_perso','user_id.type']"
        styleClass="p-datatable-gridlines" [paginator]="true" [pageLinks]="5" responsiveLayout="scroll">

        <ng-template pTemplate="caption">
            <div class="flex justify-content-between flex-column sm:flex-row">
                <div class="field">
                    <span style="margin-left: 2px;">
                        <p-dropdown [options]="typeList" (onChange)="dt1.filter($event.value, 'type', 'equals')"
                            placeholder="Choisir le statut du compte IMS">
                        </p-dropdown>
                    </span>
                </div>
                <span class="p-input-icon-left mb-3">
                    <i class="pi pi-search"></i>
                    <input pInputText type="text" (input)="dt1.filterGlobal($event.target.value, 'contains')"
                        placeholder="Recherche" />
                </span>
            </div>
        </ng-template>
        <ng-template pTemplate="header">
            <tr>
                <th pSortableColumn="user_id.lastname" style="text-align:center">
                    Nom <p-sortIcon field="user_id.lastname"></p-sortIcon>
                </th>
                <th pSortableColumn="user_id.firstname" style="text-align:center">
                    Prénom <p-sortIcon field="user_id.firstname"></p-sortIcon>
                </th>
                <th pSortableColumn="user_id.type" style="text-align:center">
                    Statut <p-sortIcon field="user_id.type"></p-sortIcon>
                </th>
                <th pSortableColumn="created_by.lastname" style="text-align:center">
                    Crée par <p-sortIcon field="created_by.lastname"></p-sortIcon>
                </th>
                <th>Action</th>
        </ng-template>
        <ng-template pTemplate="body" let-extern let-expanded="expanded">
            <tr>
                <td>
                    {{ extern.user_id?.lastname | uppercase}}
                </td>
                <td>
                    {{ extern.user_id?.firstname | titlecase}}
                </td>
                <td>
                    {{ (extern.user_id?.type=='Externe-InProgress')?"Non complété":"Complété" }}
                </td>
                <td>
                    {{ extern.created_by?.firstname | titlecase}} {{ extern.created_by?.lastname|uppercase}}
                </td>
                <td>
                    <i pTooltip="Modifier" style="margin-left: 2%; cursor: pointer;" class="pi pi-pencil"
                        (click)="InitUpdateForm(extern)" aria-hidden="true"></i>
                    <i pTooltip="Voir les matchings" style="margin-left: 2%; cursor: pointer;" class="pi pi-link"
                        (click)="seeMatching(extern.user_id._id)" aria-hidden="true"></i>
                </td>
            </tr>
        </ng-template>
    </p-table>
</div>
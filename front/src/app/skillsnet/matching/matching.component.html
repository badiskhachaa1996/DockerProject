<div *ngIf="showUpdateStatut" class="col-12 card">
	<h3 style="text-align: center;">Mis à jour du matching</h3>
	<form class="p-fluid p-formgrid grid" [formGroup]="formUpdateStatut" (ngSubmit)="onUpdateStatut();">
		<div class="field col-12 ">
			<small>Tout les champs marqués d'un astérisque <span style="color:red">*</span> sont
				obligatoires</small>
		</div>

		<div class="field col-12">
			<label>Remarque<span style="color:red">*</span>:</label><br>
			<textarea type="text" formControlName="remarque" class="form-control col-12"
				placeholder="Vous devez expliquer la 2nd Loi de Newton grace à ce que vous avez vu durant le dernier cours"
				pInputTextarea>
                    </textarea>

		</div>

		<div class="field col-12">
			<label>Statut du Matching<span style="color:red">*</span>:</label><br>
			<p-dropdown [options]="statutList" formControlName="statut" optionLabel="value" optionValue="value"
				placeholder="Choissisez un statut">
			</p-dropdown>
		</div>
		<div>
			<button pButton type="submit" label="Mis à jour du matching" [disabled]="formUpdateStatut.invalid"></button>
		</div>
	</form>
</div>
<div class="card" *ngIf="offre && isNotWinner">
	<h5>Liste des matchings en cours pour {{offre.missionName}} de {{offre.entreprise_name}}</h5>
	<p-table #dt1 rowExpandMode="single" [value]="matching" dataKey="_id" [rows]="5" [rowHover]="true"
		[globalFilterFields]="['cv_id.user_id.lastname','cv_id.user_id.firstname']" styleClass="p-datatable-gridlines"
		[paginator]="true" [pageLinks]="5" responsiveLayout="scroll">

		<ng-template pTemplate="caption">
			<div class="flex justify-content-between flex-column sm:flex-row">
				<span class="p-input-icon-left mb-3">
					<i class="pi pi-search"></i>
					<input pInputText type="text" (input)="dt1.filterGlobal($event.target.value, 'contains')"
						placeholder="Recherche" />
				</span>
			</div>
		</ng-template>
		<ng-template pTemplate="header">
			<tr>
				<th style="width: 3rem"></th>
				<th pSortableColumn="cv_id.user_id.lastname" style="text-align:center">
					Nom <p-sortIcon field="cv_id.user_id.lastname"></p-sortIcon>
				</th>
				<th pSortableColumn="cv_id.user_id.firstname" style="text-align:center">
					Prénom <p-sortIcon field="cv_id.user_id.firstname"></p-sortIcon>
				</th>
				<th pSortableColumn="taux" style="text-align:center">
					Commercial <p-sortIcon field="taux"></p-sortIcon>
				</th>
				<th style="text-align:center">
					Type Matching
				</th>
				<th style="text-align:center">
					Statut du Matching
				</th>
				<th pSortableColumn="date_creation" style="text-align:center">
					Date du matching <p-sortIcon field="date_creation"></p-sortIcon>
				</th>
				<th>
					Action
				</th>
		</ng-template>
		<ng-template pTemplate="body" let-match let-expanded="expanded">
			<tr>
				<td>
					<button type="button" pButton pRipple [pRowToggler]="match"
						class="p-button-text p-button-rounded p-button-plain"
						[icon]="expanded ? 'pi pi-chevron-down' : 'pi pi-chevron-right'"></button>
				</td>
				<td>
					{{ match.cv_id.user_id?.lastname | uppercase}}
				</td>
				<td>
					{{ match.cv_id.user_id?.firstname | titlecase}}
				</td>
				<td>
					{{ match.matcher_id?.firstname | titlecase}} {{ match.matcher_id?.lastname | uppercase}}
				</td>
				<td>
					{{match.type_matching}}
				</td>
				<td>
					{{match.statut}}
				</td>
				<td>
					{{match.date_creation|date:medium}}
				</td>
				<td>
					<i *ngIf="isCommercial" pTooltip="Changer le statut" style="margin-left: 2%; cursor: pointer;" class="pi pi-pencil"
						(click)="InitUpdateStatut(match)" aria-hidden="true"></i>
					<i *ngIf="!isCommercial && match.statut=='Validé par l\'étudiant'" pTooltip="Accepter le matching" style="margin-left: 2%; cursor: pointer;" class="pi pi-check"
						(click)="UpdateStatut(match)" aria-hidden="true"></i>
				</td>
			</tr>
		</ng-template>
		<ng-template pTemplate="rowexpansion" let-match>
			<tr>
				<td colspan="7">
					<p>Remarque :</p>
					<p>{{match.remarque}}</p>
				</td>
			</tr>
		</ng-template>
	</p-table>
</div>
<div class="card" *ngIf="offre">
	<h5>Liste des matchings potentiels sur {{offre.missionName}} de {{offre.entreprise_name}}</h5>
	<p-table #dt1 rowExpandMode="single" [value]="matchingsPotentiel" dataKey="cv.user_id._id" [rows]="10"
		[rowHover]="true" [globalFilterFields]="['cv.user_id.lastname','cv.user_id.firstname']"
		styleClass="p-datatable-gridlines" [paginator]="true" [pageLinks]="5" responsiveLayout="scroll">

		<ng-template pTemplate="caption">
			<div class="flex justify-content-between flex-column sm:flex-row">
				<span class="p-input-icon-left mb-3">
					<i class="pi pi-search"></i>
					<input pInputText type="text" (input)="dt1.filterGlobal($event.target.value, 'contains')"
						placeholder="Recherche" />
				</span>
			</div>
		</ng-template>
		<ng-template pTemplate="header">
			<tr>
				<th style="width: 3rem"></th>
				<th pSortableColumn="cv.user_id.lastname" style="text-align:center">
					Nom <p-sortIcon field="cv.user_id.lastname"></p-sortIcon>
				</th>
				<th pSortableColumn="cv.user_id.firstname" style="text-align:center">
					Prénom <p-sortIcon field="cv.user_id.firstname"></p-sortIcon>
				</th>
				<th pSortableColumn="taux" style="text-align:center">
					Taux <p-sortIcon field="taux"></p-sortIcon>
				</th>
				<th>Action</th>
		</ng-template>
		<ng-template pTemplate="body" let-match let-expanded="expanded">
			<tr>
				<td>
					<button type="button" pButton pRipple [pRowToggler]="match"
						class="p-button-text p-button-rounded p-button-plain"
						[icon]="expanded ? 'pi pi-chevron-down' : 'pi pi-chevron-right'"></button>
				</td>
				<td>
					{{ match.cv.user_id?.lastname | uppercase}}
				</td>
				<td>
					{{ match.cv.user_id?.firstname | titlecase}}
				</td>
				<td>
					{{ match.taux |number:'1.0-0' }}%
				</td>
				<td>
					<i pTooltip="Accepter le matching" style="margin-left: 2%; cursor: pointer;" class="pi pi-check"
						(click)="AcceptMatching(match.cv)" aria-hidden="true"></i>
				</td>
			</tr>
		</ng-template>
		<ng-template pTemplate="rowexpansion" let-match>
			<tr>
				<td colspan="7">
					<p>A Afficher: Détails du CV</p>
					<p>Mettre en vert les compétences qui sont dans l'offre</p>
				</td>
			</tr>
		</ng-template>
	</p-table>
</div>
<p-toast></p-toast>
<div class="grid">
    <!-- partie affectation de l'agent-->
    <div class="col-12 card" *ngIf="showAffectation">
        <i class="pi pi-times-circle" style="float:right; color: red; cursor: pointer;" (click)="showAffectation = null"
            aria-hidden="true"> </i>
        <h3 *ngIf="showAffectation?.user_id" class="text-center" style="font-weight: bold;"> Affecter le lead : {{
            showAffectation?.user_id?.firstname }} {{
            showAffectation?.user_id?.lastname | uppercase }}
        </h3>
        <form class="p-fluid p-formgrid grid" [formGroup]="affectationForm">
            <div class="field col-6">
                <label>Affecté à un membre:</label>
                <p-dropdown [options]="agentSourcingList" formControlName="agent_sourcing_id"
                    placeholder="Choisissez un agent" [group]="true" filter="true"></p-dropdown>
            </div>
            <div class="field col-6">
                <label>Affecté à une équipe:</label>
                <p-dropdown [options]="equipeSourcingList" placeholder="Choisissez une équipe"
                    formControlName="team_sourcing_id" filter="true"></p-dropdown>
            </div>
            <div class="field col-12">
                <label>Affecté le:</label>
                <p>{{affectationForm.value.date_sourcing | date:'dd MMMM yy'}}</p>
            </div>
            <div class="col-12">
                <button pButton label="Changer l'affectation" (click)="saveAffectation()"></button>
            </div>
        </form>
    </div>
    <div class="col-12 card" *ngIf="showAffectationList">
        <i class="pi pi-times-circle" style="float:right; color: red; cursor: pointer;"
            (click)="showAffectationList = null" aria-hidden="true"> </i>
        <h3 class="text-center" style="font-weight: bold;"> Affecter les leads
        </h3>
        <form class="p-fluid p-formgrid grid" [formGroup]="affectationFormList">
            <div class="field col-6">
                <label>Affecté à un membre:</label>
                <p-dropdown [options]="agentSourcingList" formControlName="agent_sourcing_id"
                    placeholder="Choisissez un agent" [group]="true" filter="true"></p-dropdown>
            </div>
            <div class="field col-6">
                <label>Affecté à une équipe:</label>
                <p-dropdown [options]="equipeSourcingList" placeholder="Choisissez une équipe"
                    formControlName="team_sourcing_id" filter="true"></p-dropdown>
            </div>
            <div class="field col-12">
                <label>Affecté le:</label>
                <p>{{affectationFormList.value.date_sourcing | date:'dd MMMM yy'}}</p>
            </div>
            <div class="col-6">
                <button pButton label="Changer l'affectation" (click)="saveAffectationList()"></button>
            </div>
            <div class="col-6">
                <button pButton label="Supprimer les leads selectionnés" (click)="deleteList()"></button>
            </div>
        </form>
    </div>
    <div class="col-12 card" *ngIf="showEmail">
        <p-tabView>
            <p-tabPanel header="Email personnalisé">
                <form class="p-fluid p-formgrid grid col-12" [formGroup]="formEmailPerso">
                    <div class="field col-6">
                        <label>Objet: </label>
                        <input type="text" formControlName="objet" pInputText>
                    </div>
                    <div class="field col-6">
                        <label>Email du destinataire: </label>
                        <p>{{prospectSendTo.user_id.email_perso}}</p>
                    </div>
                    <div class="field col-12">
                        <p-editor formControlName="body" [style]="{'height':'320px'}"></p-editor>
                    </div>
                    <div class="field col-6">
                        <label>Email de l'envoyeur: </label>
                        <p-dropdown placeholder="Choisissez une adresse mail" filter="true" formControlName="send_from"
                            [options]="mailDropdown" autoWidth="false" [style]="{'width':'100%'}">
                        </p-dropdown>
                    </div>
                    <div class="field col-6">
                        <label>Email(s) en cc: (Écrivez un , après chaque email)</label>
                        <p-chips formControlName="cc" separator=","
                            placeholder="email1@email.com,email2.email.com"></p-chips>
                    </div>
                    <div class="field col-12">
                        <input type="file" (change)="FileUploadPJ($event.target.files)" id="selectedFile" #selectedFile
                            style="display: none;" pInputFile />
                        <p-table styleClass="p-datatable-gridlines" [value]="piece_jointes" responsiveLayout="scroll"
                            dataKey="_id" class="col-12" responsiveLayout="scroll">
                            <ng-template pTemplate="header" let-columns>
                                <tr>
                                    <th>
                                        Date d'upload
                                    </th>
                                    <th>
                                        Nom du document
                                    </th>
                                    <th>
                                        Lien de téléchargement
                                    </th>
                                    <th>
                                        Action
                                    </th>
                                </tr>
                            </ng-template>
                            <ng-template pTemplate="body" let-rowData let-editing="editing" let-ri="rowIndex">
                                <tr>
                                    <td>
                                        {{rowData.date | date:'dd MMMM yy'}}
                                    </td>
                                    <td *ngIf="rowData.nom && rowData.nom!='Téléverser le fichier s\'il vous plaît'">
                                        {{rowData.nom}}
                                    </td>
                                    <td
                                        *ngIf="(!rowData.nom || rowData.nom=='Téléverser le fichier s\'il vous plaît') && rowData.path">
                                        {{rowData?.path}}
                                    </td>
                                    <td
                                        *ngIf="(!rowData.nom || rowData.nom=='Téléverser le fichier s\'il vous plaît') && !rowData.path">
                                        Téléverser le fichier s'il vous plaît
                                    </td>
                                    <td *ngIf="rowData.path">
                                        <a style="cursor: pointer;" (click)="downloadPJFile(rowData)">Télécharger</a>
                                        {{rowData.path}}
                                    </td>
                                    <td *ngIf="!rowData.path">
                                        <a style="cursor: pointer;" (click)="onUploadPJ(rowData)">Upload</a>
                                    </td>
                                    <td>
                                        <i pTooltip="Uploader un fichier" tooltipPosition="bottom"
                                            class="pi pi-cloud-upload mr-2" style="cursor: pointer;"
                                            (click)="onUploadPJ(rowData)">
                                        </i>
                                        <i pTooltip="Supprimer un fichier" tooltipPosition="bottom"
                                            class="pi pi-trash mr-2" style="cursor: pointer;" (click)="onDeletePJ(ri)">
                                        </i>
                                    </td>
                                </tr>
                            </ng-template>
                        </p-table>
                        <div class="mt-2 col-12" style="text-align: center;">
                            <button pButton (click)="onAddPj()" label="Ajouter une nouvelle pièces jointe"
                                autoWidth="false" [style]="{'width':'80%'}"></button>
                        </div>
                    </div>
                    <button pButton [disabled]="formEmailPerso.invalid" label="Envoyer l'email"
                        (click)="onEmailPerso()"></button>
                </form>
            </p-tabPanel>
            <p-tabPanel header="Depuis un mail type">
                <form class="p-fluid p-formgrid grid col-12" [formGroup]="formEmailType">
                    <div class="field col-12">
                        <label>Email Type: </label>
                        <p-dropdown placeholder="Choisissez un mail type" filter="true"
                            (onChange)="onMailType($event.value)" [options]="mailTypeDropdown" autoWidth="false"
                            [style]="{'width':'100%'}">
                        </p-dropdown>
                    </div>
                    <div class="field col-6">
                        <label>Objet: </label>
                        <input type="text" formControlName="objet" pInputText>
                    </div>
                    <div class="field col-6">
                        <label>Email du destinataire: </label>
                        <p>{{prospectSendTo.user_id.email_perso}}</p>
                    </div>
                    <div class="field col-12">
                        <p-editor formControlName="body" [style]="{'height':'320px'}"></p-editor>
                    </div>
                    <div class="field col-6">
                        <label>Email de l'envoyeur: </label>
                        <p-dropdown placeholder="Choisissez une adresse mail" filter="true" formControlName="send_from"
                            [options]="mailDropdown" autoWidth="false" [style]="{'width':'100%'}">
                        </p-dropdown>
                    </div>
                    <div class="field col-6">
                        <label>Email(s) en cc: (Écrivez un , après chaque email)</label>
                        <p-chips formControlName="cc" separator=","
                            placeholder="email1@email.com,email2.email.com"></p-chips>
                    </div>
                    <div class="field col-12">
                        <input type="file" (change)="FileUploadPJ($event.target.files)" id="selectedFile" #selectedFile
                            style="display: none;" pInputFile />
                        <p-table styleClass="p-datatable-gridlines" [value]="piece_jointes" responsiveLayout="scroll"
                            dataKey="_id" class="col-12" responsiveLayout="scroll">
                            <ng-template pTemplate="header" let-columns>
                                <tr>
                                    <th>
                                        Date d'upload
                                    </th>
                                    <th>
                                        Nom du document
                                    </th>
                                    <th>
                                        Lien de téléchargement
                                    </th>
                                    <th>
                                        Action
                                    </th>
                                </tr>
                            </ng-template>
                            <ng-template pTemplate="body" let-rowData let-editing="editing" let-ri="rowIndex">
                                <tr>
                                    <td>
                                        {{rowData.date | date:'dd MMMM yy'}}
                                    </td>
                                    <td *ngIf="rowData.nom && rowData.nom!='Téléverser le fichier s\'il vous plaît'">
                                        {{rowData.nom}}
                                    </td>
                                    <td
                                        *ngIf="(!rowData.nom || rowData.nom=='Téléverser le fichier s\'il vous plaît') && rowData.path">
                                        {{rowData?.path}}
                                    </td>
                                    <td
                                        *ngIf="(!rowData.nom || rowData.nom=='Téléverser le fichier s\'il vous plaît') && !rowData.path">
                                        Téléverser le fichier s'il vous plaît
                                    </td>
                                    <td *ngIf="rowData.path">
                                        <a style="cursor: pointer;" (click)="downloadPJFile(rowData)">Télécharger</a>

                                    </td>
                                    <td *ngIf="!rowData.path">
                                        <a style="cursor: pointer;" (click)="onUploadPJ(rowData)">Upload</a>
                                    </td>
                                    <td>
                                        <i pTooltip="Uploader un fichier" tooltipPosition="bottom"
                                            class="pi pi-cloud-upload mr-2" style="cursor: pointer;"
                                            (click)="onUploadPJ(rowData)">
                                        </i>
                                        <i pTooltip="Supprimer un fichier" tooltipPosition="bottom"
                                            class="pi pi-trash mr-2" style="cursor: pointer;" (click)="onDeletePJ(ri)">
                                        </i>
                                    </td>
                                </tr>
                            </ng-template>
                        </p-table>
                        <div class="mt-2 col-12" style="text-align: center;">
                            <button pButton (click)="onAddPj()" label="Ajouter une nouvelle pièces jointe"
                                autoWidth="false" [style]="{'width':'80%'}"></button>
                        </div>
                    </div>
                    <button pButton [disabled]="formEmailType.invalid" label="Envoyer l'email"
                        (click)="onEmailPerso()"></button>
                </form>
            </p-tabPanel>
            <p-tabPanel header="Historique des emails">
                <p-table #dt1 dataKey="_id" [rows]="8" [rowHover]="true" [paginator]="true" [value]="historiqueEmails"
                    [paginator]="true" [pageLinks]="5" selectionMode="single" class="col-12" responsiveLayout="scroll"
                    styleClass="p-datatable-gridlines">
                    <ng-template pTemplate="header">
                        <tr>
                            <th style="width: 3rem" scope="col"></th>
                            <th pSortableColumn="date_creation" scope="col" style="text-align: center;">
                                Date de l'envoie <p-sortIcon field="date_creation"></p-sortIcon>
                            </th>
                            <th pSortableColumn="objet" scope="col" style="text-align: center;">
                                Objet du mail <p-sortIcon field="objet"></p-sortIcon>
                            </th>
                            <th pSortableColumn="send_by.firstname" scope="col" style="text-align: center;">
                                Envoyé par <p-sortIcon field="send_by.firstname"></p-sortIcon>
                            </th>
                            <th pSortableColumn="cc" scope="col" style="text-align: center;">
                                Envoyé à <p-sortIcon field="cc"></p-sortIcon>
                            </th>
                            <th pSortableColumn="send_from" scope="col" style="text-align: center;">
                                Envoyé depuis <p-sortIcon field="send_from"></p-sortIcon>
                            </th>
                        </tr>
                    </ng-template>
                    <ng-template pTemplate="body" let-email let-expanded="expanded">
                        <tr>

                            <td>
                                <button type="button" pButton pRipple [pRowToggler]="email"
                                    class="p-button-text p-button-rounded p-button-plain"
                                    [icon]="expanded ? 'pi pi-chevron-down' : 'pi pi-chevron-right'"></button>
                            </td>
                            <td>
                                {{email.date_creation|date:'dd MMMM yy'}}
                            </td>
                            <td>
                                {{email.objet}}
                            </td>
                            <td>
                                {{email?.send_by?.firstname | titlecase}} {{email?.send_by?.lastname | uppercase}}
                            </td>
                            <td>
                                <strong>{{prospectSendTo?.user_id?.email_perso }}</strong> {{cc}}
                            </td>
                            <td>
                                {{email.send_from}}
                            </td>
                        </tr>
                    </ng-template>
                    <ng-template pTemplate="rowexpansion" let-email>
                        <div [innerHTML]="email.body">

                        </div>
                    </ng-template>
                </p-table>
            </p-tabPanel>
        </p-tabView>
    </div>
    <!-- partie Modification des informations du prospect -->
    <div class="col-12 card" *ngIf="showDetails">
        <i class="pi pi-times-circle" style="float:right; color: red; cursor: pointer;" (click)="showDetails = null"
            aria-hidden="true"> </i>
        <h3 *ngIf="showDetails?.user_id" class="text-center" style="font-weight: bold;"> Détails de : {{
            showDetails?.user_id?.firstname }} {{
            showDetails?.user_id?.lastname | uppercase }}
        </h3>
        <p-tabView class="col-12">
            <p-tabPanel header="Informations Personnelles">
                <form class="grid" [formGroup]="detailsForm">
                    <div class="p-fluid p-formgrid grid">
                        <div class="field col-12">
                            <label For="Civilite">Civilité</label>
                            <p-dropdown [options]="civiliteList" formControlName="civilite"></p-dropdown>
                        </div>
                        <div class="field col-12 md:col-6">
                            <label For="lastname">Nom</label>
                            <input pInputText id="lastname" formControlName="lastname" type="text" placeholder="Nom" />
                        </div>
                        <div class="field col-12 md:col-6">
                            <label For="firstname">Prénom</label>
                            <input pInputText id="firstname" formControlName="firstname" type="text"
                                placeholder="Prénom" />
                        </div>
                        <div class="field col-12 md:col-4">
                            <label For="indicatif">Indicatif</label>
                            <input pInputText id="indicatif" formControlName="indicatif" type="text"
                                placeholder="0033" />
                        </div>
                        <div class="field col-12 md:col-8">
                            <label For="phone">Téléphone</label>
                            <input pInputText id="phone" formControlName="phone" type="tel" placeholder="0767987887" />
                        </div>
                        <div class="field col-12">
                            <label For="email_perso">Adresse Email</label>
                            <input pInputText id="phone" formControlName="email_perso" type="email"
                                placeholder="s.hue@gmail.com" />
                        </div>
                        <div class="field col-12 md:col-7">
                            <label For="pays">Pays de résidence</label>
                            <p-dropdown [options]="paysList" formControlName="pays_adresse" optionValue="value"
                                optionLabel="value"></p-dropdown>
                        </div>
                        <!--<div class="field col-12 md:col-5">
                                <label For="ville">Ville</label>
                                <input pInputText id="ville" formControlName="ville_adresse" type="text"
                                    placeholder="Paris" />
                            </div>
                            <div class="field col-12 md:col-4">
                                <label For="numero_adresse">Numéro de rue</label>
                                <input pInputText id="numero_adresse" formControlName="numero_adresse" type="number"
                                    placeholder="15" />
                            </div>
                            <div class="field col-12 md:col-8">
                                <label For="rue_adresse">Rue</label>
                                <input pInputText id="rue_adresse" formControlName="rue_adresse" type="text"
                                    placeholder="rue du louvre" />
                            </div>
                            <div class="field md:col-6 col-12">
                                <label For="postal_adresse">Code postale</label>
                                <input pInputText id="postal_adresse" formControlName="postal_adresse" type="number"
                                    placeholder="94200" />
                            </div>-->
                        <div class="field md:col-6 col-12">
                            <label For="postal_adresse">Date d'inscription</label>
                            <p>{{showDetails?.date_creation|date:'dd MMMM yy'}}</p>
                        </div>
                    </div>
                </form>
            </p-tabPanel>
            <p-tabPanel header="Programme d'étude">
                <form class="grid" [formGroup]="detailsForm">
                    <div class="p-fluid p-formgrid grid">
                        <div class="field md:col-6 col-12">
                            <label For="formation">Formation</label>
                            <p-dropdown [options]="dropdownFormation" placeholder="Choisissez une formation"
                                formControlName="formation"></p-dropdown>
                        </div>
                        <div class="field md:col-6 col-12">
                            <label For="campus_choix_1">Campus</label>
                            <p-dropdown [options]="dropdownCampus" placeholder="Choisissez un campus"
                                formControlName="campus_choix_1"></p-dropdown>

                        </div>
                        <div class="field col-12">
                            <label For="formation">Ecole</label>
                            <p-dropdown [options]="dropdownEcole" placeholder="Choisissez une école"
                                formControlName="type_form"></p-dropdown>
                        </div>
                    </div>
                </form>
            </p-tabPanel>
            <p-tabPanel header="Dossier d'admission">
                <div class="col-12">
                    <input type="file" (change)="uploadFile($event.target.files)" id="selectedFile" #selectedFile
                        style="display: none;" accept=".png, .jpg, .jpeg, .jfif" pInputFile />
                    <input type="file" (change)="uploadOtherFile($event.target.files)" id="selectedFileOther"
                        #selectedFileOther style="display: none;" accept=".png, .jpg, .jpeg, .jfif" pInputFile />
                </div>
                <div class="card grid">
                    <h3 class="col-12">Documents Requis</h3>
                    <p-table [value]="showDetails.documents_dossier" #dt1 dataKey="_id" class="col-12"
                        responsiveLayout="scroll" styleClass="p-datatable-gridlines">
                        <ng-template pTemplate="header">
                            <tr>
                                <th>Document</th>
                                <th>Lien</th>
                                <th>Action</th>
                            </tr>
                        </ng-template>
                        <ng-template pTemplate="body" let-doc>
                            <tr>
                                <td>{{doc.nom}}</td>
                                <td>
                                    <a *ngIf="doc.path" (click)="downloadFile(doc)">Télécharger le document</a>
                                </td>
                                <td>
                                    <i pTooltip="Ajouter un fichier" tooltipPosition="bottom" class="pi pi-file"
                                        (click)="initUpload(doc)" style="margin-left: 2%;" aria-hidden="true"></i>
                                    <i pTooltip="Supprimer" style="margin-left: 2%; cursor: pointer;"
                                        class="pi pi-trash" (click)="delete(doc)" aria-hidden="true"></i>
                                </td>
                            </tr>
                        </ng-template>
                    </p-table>
                    <h3 class="col-8">Autre documents</h3>
                    <div class="col-4">
                        <p-button [style]="{'width':'100%'}" (click)="addDoc()" icon="pi pi-plus" autoWidth="false"
                            label="Ajouter un autre document"></p-button>
                    </div>
                    <p-table [value]="showDetails.documents_autre" #dt1 dataKey="_id" [rows]="8" rowExpandMode="single"
                        [rows]="8" [rowHover]="true" class="col-12" [paginator]="true" [pageLinks]="5"
                        [globalFilterFields]="['libelle','email','site']" responsiveLayout="scroll" [filterDelay]="0"
                        styleClass="p-datatable-gridlines">
                        <ng-template pTemplate="header">
                            <tr>
                                <th>Document</th>
                                <th>Lien</th>
                                <th>Action</th>
                            </tr>
                        </ng-template>
                        <ng-template pTemplate="body" let-doc let-ri="rowIndex">
                            <tr [pEditableRow]="doc">
                                <td pEditableColumn>
                                    <p-cellEditor>
                                        <ng-template pTemplate="input">
                                            <input type="text" pInputText [(ngModel)]="doc.nom">
                                        </ng-template>
                                        <ng-template pTemplate="output">
                                            {{doc.nom}}
                                        </ng-template>
                                    </p-cellEditor>
                                </td>
                                <td>
                                    <a *ngIf="doc.path" (click)="downloadOtherFile(doc)">Télécharger le document</a>
                                </td>
                                <td>
                                    <i pTooltip="Ajouter un fichier" tooltipPosition="bottom" class="pi pi-file"
                                        *ngIf="doc.nom!='Cliquer pour modifier le nom du document ici'"
                                        (click)="initUpload(doc,'selectedFileOther')" style="margin-left: 2%;"
                                        aria-hidden="true"></i>
                                    <i pTooltip="Supprimer" style="margin-left: 2%; cursor: pointer;"
                                        class="pi pi-trash" (click)="deleteOther(doc)" aria-hidden="true"></i>
                                </td>
                            </tr>
                        </ng-template>
                    </p-table>
                </div>
            </p-tabPanel>
            <p-tabPanel header="Orientation, Admission et Phase de Candidature">
                <form class="grid" [formGroup]="detailsForm">
                    <div class="p-fluid p-formgrid grid">
                        <div class="field md:col-6 col-12">
                            <label For="formation">Décision orientation</label>
                            <p-multiSelect [options]="orientationList"
                                formControlName="decision_orientation"></p-multiSelect>
                            <!--<p-dropdown [options]="civiliteList" formControlName="formation"></p-dropdown>-->
                        </div>
                        <div class="field md:col-6 col-12">
                            <label For="formation">Décision admission</label>
                            <p-dropdown [options]="admissionList" formControlName="decision_admission"></p-dropdown>
                            <!--<p-dropdown [options]="civiliteList" formControlName="formation"></p-dropdown>-->
                        </div>
                        <div class="field col-12">
                            <label For="formation">Phase de candidature</label>
                            <p-dropdown [options]="dropdownPhase" placeholder="Choisissez une phase"
                                formControlName="phase_candidature"></p-dropdown>
                            <!--<p-dropdown [options]="civiliteList" formControlName="formation"></p-dropdown>-->
                        </div>
                    </div>
                </form>
            </p-tabPanel>
            <p-tabPanel header="Avancement consulaire">
                <form class="grid" [formGroup]="detailsForm">
                    <div class="p-fluid p-formgrid grid">
                        <div class="field md:col-6 col-12">
                            <label For="formation">A besoin d'un visa ?</label>
                            <p-dropdown [options]="abesoinvisaList" formControlName="a_besoin_visa"></p-dropdown>
                            <!--<p-dropdown [options]="civiliteList" formControlName="formation"></p-dropdown>-->
                        </div>
                        <div class="field md:col-6 col-12">
                            <label For="formation">Avancement Campus France</label>
                            <p-dropdown [options]="cflist" formControlName="avancement_cf"></p-dropdown>
                            <!--<p-dropdown [options]="civiliteList" formControlName="formation"></p-dropdown>-->
                        </div>
                        <div class="field md:col-6 col-12">
                            <label For="formation">Logement</label>
                            <p-dropdown [options]="logementList" formControlName="logement"></p-dropdown>
                            <!--<p-dropdown [options]="civiliteList" formControlName="formation"></p-dropdown>-->
                        </div>
                        <div class="field md:col-6 col-12">
                            <label For="formation">Finance</label>
                            <input pInputText formControlName="finance" />
                            <!--<p-dropdown [options]="civiliteList" formControlName="formation"></p-dropdown>-->
                        </div>
                        <div class="field col-12">
                            <label For="formation">Visa</label>
                            <p-dropdown [options]="visaList" formControlName="avancement_visa"></p-dropdown>
                            <!--<p-dropdown [options]="civiliteList" formControlName="formation"></p-dropdown>-->
                        </div>
                    </div>
                </form>
            </p-tabPanel>
            <p-tabPanel header="Paiements">
                <div class="grid">
                    <p-table #dt2 dataKey="ID" [value]="payementList" class="col-12" styleClass="p-datatable-gridlines">
                        <ng-template pTemplate="header">
                            <tr>
                                <th pSortableColumn="ID" style="text-align: center;"> ID <p-sortIcon field="ID">
                                    </p-sortIcon>
                                </th>
                                <th pSortableColumn="type" style="text-align: center;"> Type de Paiement <p-sortIcon
                                        field="type">
                                    </p-sortIcon>
                                </th>
                                <th pSortableColumn="montant" style="text-align: center;"> Montant <p-sortIcon
                                        field="montant"></p-sortIcon>
                                </th>
                                <th pSortableColumn="date" style="text-align: center;"> Date du réglement <p-sortIcon
                                        field="date"></p-sortIcon>
                                </th>

                                <th>
                                    <div class="flex justify-content-between align-items-center">
                                        Action
                                    </div>
                                </th>
                            </tr>
                        </ng-template>
                        <ng-template pTemplate="body" let-paiement let-ri="rowIndex">
                            <tr [pEditableRow]="paiement">
                                <td>
                                    {{paiement?.ID}}
                                </td>
                                <td pEditableColumn>
                                    <p-cellEditor>
                                        <ng-template pTemplate="input">
                                            <p-dropdown [options]="typePaiement" [(ngModel)]="paiement.type"
                                                placeholder="Choisissez la méthode de paiement"
                                                (onChange)="changeMontant(ri,$event,'type')"></p-dropdown>
                                        </ng-template>
                                        <ng-template pTemplate="output">
                                            {{paiement.type}}
                                        </ng-template>
                                    </p-cellEditor>
                                </td>
                                <td pEditableColumn>
                                    <p-cellEditor>
                                        <ng-template pTemplate="input">
                                            <input type="number" (change)="changeMontant(ri,$event,'montant')"
                                                [(value)]="paiement.montant" placeholder="20" value="0" pInputText>
                                        </ng-template>
                                        <ng-template pTemplate="output">
                                            {{paiement.montant}}€
                                        </ng-template>
                                    </p-cellEditor>
                                </td>
                                <td pEditableColumn>
                                    <p-cellEditor>
                                        <ng-template pTemplate="input">
                                            <input type="date" pInputText (change)="changeMontant(ri,$event,'date')"
                                                [(value)]="paiement.date">
                                        </ng-template>
                                        <ng-template pTemplate="output">
                                            {{paiement.date | date:'dd MMMM yy'}}
                                        </ng-template>
                                    </p-cellEditor>
                                </td>
                                <td>
                                    <i pTooltip="Supprimer le paiement" tooltipPosition="bottom" class="pi pi-trash"
                                        aria-hidden="true" (click)="deletePayement(ri)"> </i>
                                </td>
                            </tr>
                        </ng-template>
                    </p-table>
                    <div class="col-12">
                        <button type="button" (click)="onAddPayement()" pButton label="Ajouter un paiement"></button>
                    </div>
                </div>
            </p-tabPanel>
            <p-tabPanel header="Documents d'inscription">
                <div class="col-12 grid">
                    <div class="col-12">
                        <strong>Mes attestations disponibles:</strong>
                    </div>
                    <div class="col-12">
                        <p-table styleClass="p-datatable-gridlines" [value]="showDetails.documents_administrative"
                            responsiveLayout="scroll" responsiveLayout="scroll">
                            <ng-template pTemplate="header" let-columns>
                                <tr>
                                    <th>
                                        ID
                                    </th>
                                    <th>
                                        Type
                                    </th>
                                    <th>
                                        Date de délivrance
                                    </th>
                                    <th>
                                        Nom du document
                                    </th>
                                    <th>
                                        Traité par
                                    </th>
                                    <th>
                                        Lien de téléchargement
                                    </th>
                                    <th>
                                        Note
                                    </th>
                                </tr>
                            </ng-template>
                            <ng-template pTemplate="body" let-rowData>
                                <tr>
                                    <td>
                                        {{rowData.custom_id}}
                                    </td>
                                    <td>
                                        {{rowData.type}}
                                    </td>
                                    <td>
                                        {{rowData.date | date:'dd MMMM yy'}}
                                    </td>
                                    <td>
                                        {{rowData.nom}}
                                    </td>
                                    <td>
                                        {{rowData.traited_by}}
                                    </td>
                                    <td>
                                        <a (click)="downloadAdminFile(rowData.path)">Télécharger</a>
                                    </td>
                                    <td>
                                        {{rowData.note}}
                                    </td>
                                </tr>
                            </ng-template>
                        </p-table>
                    </div>
                </div>
                <p *ngIf="showDetails.documents_administrative==null || showDetails.documents_administrative.length==0">
                    Aucun document n'a été chargé !
                </p>
            </p-tabPanel>
        </p-tabView>
        <div class="grid col-12">
            <div class="col-12">
                <button pButton label="Sauvegardez les modifications" (click)="saveDetails()"></button>
            </div>
        </div>


    </div>
    <div class="col-12 card" *ngIf="leadHistorique">
        <i class="pi pi-times-circle" style="float:right; color: red; cursor: pointer;" (click)="leadHistorique = null"
            aria-hidden="true"> </i>
        <h3 *ngIf="leadHistorique?.user_id" class="text-center" style="font-weight: bold;"> Historique de : {{
            leadHistorique?.user_id?.firstname }} {{
            leadHistorique?.user_id?.lastname | uppercase }}
        </h3>
        <p-table #dthisto dataKey="_id" [rows]="8" [rowHover]="true" [paginator]="true" [value]="listHistorique"
            [paginator]="true" [pageLinks]="5" selectionMode="single" class="col-12" [globalFilterFields]="['detail']"
            responsiveLayout="scroll" styleClass="p-datatable-gridlines">
            <ng-template pTemplate="caption">
                <span class="p-input-icon-left mb-2">
                    <i class="pi pi-search"></i>
                    <input pInputText type="text" #filter (input)="dt1.filterGlobal($event.target.value, 'contains')"
                        placeholder="Recherche" class="w-full" />
                </span>
            </ng-template>
            <ng-template pTemplate="header">
                <tr>
                    <th>Date et Heure</th>
                    <th>Detail</th>
                    <th>Contribution</th>
                    <th>Agent</th>
                </tr>
            </ng-template>
            <ng-template pTemplate="body" let-histo>
                <tr>
                    <td>{{histo.date_creation | date:"dd MMMM yy"}}</td>
                    <td>{{histo.detail}}</td>
                    <td>{{getDiff(histo)}}</td>
                    <td>{{histo?.user_id?.lastname|uppercase}} {{histo?.user_id?.firstname|titlecase}}</td>
                </tr>
            </ng-template>
        </p-table>
    </div>
    <!-- partie ajout de document -->
    <div class="col-12" *ngIf="showUploadFile!=null">
        <div class="card">
            <i class="pi pi-times-circle" style="float:right; color: red; cursor: pointer;"
                (click)="showUploadFile = null" aria-hidden="true"> </i>
            <h3 *ngIf="showUploadFile.user_id" class="text-center" style="font-weight: bold;">Ajouter un document à : {{
                showUploadFile.user_id?.firstname }} {{
                showUploadFile.user_id?.lastname | uppercase }}
            </h3>

            <form class="p-fluid p-formgrid grid" [formGroup]="uploadFileForm">
                <div class="field col-12">
                    <label>Type de document</label>
                    <p-dropdown [options]="DocTypes" formControlName="typeDoc"></p-dropdown>
                </div>
                <div class="field col-12">
                    <p-fileUpload (uploadHandler)="FileUpload($event)" mode="basic" chooseLabel="Ajouter un Document"
                        customUpload="true" fileLimit="1" accept=".docx,.pdf,.doc,.jpg,.png,.jpeg"
                        maxFileSize="10000000" [auto]="true" #fileInput>
                    </p-fileUpload>
                </div>

            </form>
        </div>
    </div>
    <p-toast></p-toast>
    <!-- Table d'affichage de la liste des preinscription -->
    <div class="col-12 card" *ngIf="ecoleList.length!=0">
        <p-tabView> <!-- style="max-width: 100%;" -->
            <p-tabPanel [header]="ecole.titre" *ngFor="let ecole of ecoleList; let i = index" [selected]="i == 0">
                <div class="grid" *ngIf="prospects && prospects[ecole.url_form]">

                    <div class="col-12" style="text-align: right;"
                        *ngIf="AccessLevel=='Super-Admin' || AccessLevel=='Admin'">
                        <button pButton icon="pi pi-file" label="Exporter" (click)="exportExcel(ecole.url_form)"
                            type="button" style="margin-left: 2px;"
                            *ngIf="token && token.role!='user' && token.role!='Agent'">
                        </button>
                    </div>
                    <div class="field col-12 grid ">
                        <div *ngIf="Fpays" class="field col-4">
                            <p-dropdown filter="true" placeholder="Pays" [options]="filterPays" [ngModel]="Fpays"
                                [style]="{'width':'100%'}"
                                (onChange)="dt1.filter($event.value, 'user_id.pays_adresse','equals');Fpays=$event.value"
                                emptyFilterMessage="Pas de pays trouvé" filterPlaceholder="Pays"
                                >
                            </p-dropdown>
                        </div>
                        <div *ngIf="Fcampus" class="field col-4">
                            <p-dropdown filter="true" placeholder="Campus" [options]="filterCampus" [ngModel]="Fcampus"
                                [style]="{'width':'100%'}"
                                (onChange)="dt1.filter($event.value, 'campus_choix_1','equals');Fcampus=$event.value"
                                emptyFilterMessage="Pas de campus trouvé" filterPlaceholder="Campus"
                                >
                            </p-dropdown>
                        </div>
                        <div *ngIf="Fformation" class="field col-4">
                            <p-dropdown filter="true" placeholder="Formation" [options]="filterFormation"
                                [ngModel]="Fformation" [style]="{'width':'100%'}"
                                (onChange)="dt1.filter($event.value, 'formation','equals');Fformation=$event.value"
                                emptyFilterMessage="Pas de formation trouvé" filterPlaceholder="Formation"
                                >
                            </p-dropdown>
                        </div>
                        <div *ngIf="Frythme" class="field col-4">
                            <p-dropdown placeholder="Initiale/Alternance" [options]="filterRythmeFormation"
                                [ngModel]="Frythme" [style]="{'width':'100%'}"
                                (onChange)="dt1.filter($event.value, 'rythme_formation','equals');Frythme=$event.value"
                                >
                            </p-dropdown>
                        </div>
                        <div *ngIf="Flangue" class="field col-4">
                            <p-dropdown filter="true" placeholder="Anglais/Français" [options]="filterProgramme"
                                [ngModel]="Flangue" [style]="{'width':'100%'}"
                                (onChange)="dt1.filter($event.value, 'programme','equals');Flangue=$event.value"
                                emptyFilterMessage="Pas de programme trouvé" filterPlaceholder="Programme"
                                >
                            </p-dropdown>
                        </div>
                        <div *ngIf="Fstatus" class="field col-4">
                            <p-dropdown filter="true" placeholder="Dossier Lead" [options]="filterStatut"
                                [ngModel]="Fstatus" [style]="{'width':'100%'}"
                                (onChange)="dt1.filter($event.value, 'haveDoc','equals');Fstatus=$event.value"
                                emptyFilterMessage="Pas de statut trouvé" filterPlaceholder="Statut du dossier"
                                >
                            </p-dropdown>
                        </div>
                        <div *ngIf="Fsource" class="field col-4">
                            <p-dropdown filter="true" placeholder="Source" [options]="filterSource" [ngModel]="Fsource"
                                [style]="{'width':'100%'}"
                                (onChange)="dt1.filter($event.value, 'source','startsWith');Fsource=$event.value"
                                emptyFilterMessage="Pas de source trouvé" filterPlaceholder="Source"
                                >
                            </p-dropdown>
                        </div>
                        <div *ngIf="Forientation" class="field col-4">

                            <p-dropdown filter="true" placeholder="Decision Orientation"
                                [options]="dropdownDecisionOrientation" [ngModel]="Forientation"
                                [style]="{'width':'100%'}"
                                (onChange)="dt1.filter($event.value, 'decision_orientation','equals');Forientation=$event.value"
                                emptyFilterMessage="Pas de decision trouvé" filterPlaceholder="Decision Orientation"
                                >
                            </p-dropdown>
                        </div>
                        <div *ngIf="FDadmission" class="field col-4">
                            <p-dropdown filter="true" placeholder="Decision Admission"
                                [options]="dropdownDecisionAdmission" [ngModel]="FDadmission" [style]="{'width':'100%'}"
                                (onChange)="dt1.filter($event.value, 'decision_admission','equals');FDadmission=$event.value"
                                emptyFilterMessage="Pas de decision trouvé" filterPlaceholder="Decision Admission"
                                >
                            </p-dropdown>
                        </div>
                        <div *ngIf="FSPayement" class="field col-4">
                            <p-dropdown filter="true" placeholder="Paiement" [options]="filterPaiement"
                                [ngModel]="FSPayement" [style]="{'width':'100%'}"
                                (onChange)="dt1.filter($event.value, 'statut_payement','equals');FSPayement=$event.value"
                                emptyFilterMessage="Pas de paiement trouvé" filterPlaceholder="Paiement"
                                >
                            </p-dropdown>
                        </div>
                        <div *ngIf="FSvisa" class="field col-4">
                            <p-dropdown filter="true" placeholder="Visa" [options]="filterVisa" [ngModel]="FSvisa"
                                [style]="{'width':'100%'}"
                                (onChange)="dt1.filter($event.value, 'avancement_visa','equals');FSvisa=$event.value"
                                emptyFilterMessage="Pas de statut trouvé" filterPlaceholder="Statut du visa"
                                >
                            </p-dropdown>
                        </div>
                        <div *ngIf="FphaseC" class="field col-4">
                            <p-dropdown filter="true" placeholder="Phase de la candidature" [options]="filterPhase"
                                [ngModel]="FphaseC" [style]="{'width':'100%'}"
                                (onChange)="dt1.filter($event.value, 'phase_candidature','equals');FphaseC=$event.value"
                                emptyFilterMessage="Pas de phase trouvé" filterPlaceholder="Phase de la candidature"
                                >
                            </p-dropdown>
                        </div>

                    </div>
                    <div class="field col-12 grid ">
                        <div class="md:col-2 col-12" style="text-align: center;">
                            <button pButton label="Filtrer" class="p-button" icon="pi pi-filter"
                                (click)="displayFilter=true"></button>
                        </div>
                        <div class="md:col-2 col-12" style="text-align: center;">
                            <button pButton label="Vider&nbsp;" class="p-button" icon="pi pi-filter-slash"
                                (click)="clearFilter()"></button>
                        </div>
                        <div class="md:col-2 col-12" style="text-align: center;">
                            <input pInputText type="text" style="width: 100%;"
                                (input)="dt1.filterGlobal($event.target.value, 'contains')" placeholder="Recherche" />
                        </div>
                        <div class="md:col-2 col-12">
                            <p-dropdown [style]="{'width':'100%'}" [options]="filterCampus" filter="true"
                                [ngModel]="Fcampus"
                                (onChange)="dt1.filter($event.value, 'campus_choix_1', 'equals');Fcampus=$event.value"
                                emptyFilterMessage="Type non trouvé" filterPlaceholder="Type"></p-dropdown>
                        </div>
                        <div class="md:col-2 col-12">
                            <p-dropdown [style]="{'width':'100%'}" [options]="filterFormation" filter="true"
                                [ngModel]="Fformation"
                                (onChange)="dt1.filter($event.value, 'formation', 'equals');Fcampus=$event.value"
                                emptyFilterMessage="Type non trouvé" filterPlaceholder="Type"></p-dropdown>
                        </div>
                        <div class="md:col-2 col-12">
                            <p-dropdown [style]="{'width':'100%'}" [options]="filterRentreeScolaire" filter="true"
                                (onChange)="dt1.filter($event.value,'rentree_scolaire', 'equals')"
                                emptyFilterMessage="Role non trouvé" filterPlaceholder="Rôle"></p-dropdown>
                        </div>
                    </div>

                    <p-table #dt1 dataKey="_id" [rows]="8" [rowHover]="true" [paginator]="true"
                        [(selection)]="selectedLeads" [value]="prospects[ecole.url_form]" [paginator]="true"
                        [pageLinks]="5" selectionMode="single" class="col-12" (onRowSelect)="onRowSelect($event)"
                        (onHeaderCheckboxToggle)="onRowSelect($event)"
                        [globalFilterFields]="['customid', 'type_form', 'code_commercial', 'programme','user_id.firstname','user_id.lastname','formation','statut_dossier','campus_choix_1','campus_choix_2','campus_choix_3','user_id.email_perso','rythme_formation']"
                        responsiveLayout="scroll" styleClass="p-datatable-gridlines">


                        <ng-template pTemplate="header">
                            <tr>
                                <th style="width: 3rem">
                                    <p-tableHeaderCheckbox></p-tableHeaderCheckbox>
                                </th>
                                <th style="width: 3rem" scope="col"></th>

                                <th pSortableColumn="customid" scope="col" style="text-align: center;">
                                    ID Lead <p-sortIcon field="customid"></p-sortIcon>
                                </th>
                                <!--<th pSortableColumn="source" scope="col" style="text-align: center;">
                                    Source <p-sortIcon field="source"></p-sortIcon>
                                </th>-->
                                <th pSortableColumn="user_id.firstname" scope="col" style="text-align: center;">
                                    Prénom & Nom <p-sortIcon field="firstname"></p-sortIcon>
                                </th>
                                <th pSortableColumn="rentree_scolaire" scope="col" style="text-align: center;">
                                    Choix académique<p-sortIcon field="rentree_scolaire"></p-sortIcon>
                                </th>
                                <!--<th pSortableColumn="user_id.pays_adresse" scope="col" style="text-align: center;">
                                    Pays de résidence <p-sortIcon field="user_id.pays_adresse"></p-sortIcon>
                                </th>-->
                                <!--<th pSortableColumn="campus_choix_1" scope="col" style="text-align: center;">
                                    Campus <p-sortIcon field="campus_choix_1"></p-sortIcon>
                                </th>
                                <th pSortableColumn="formation" scope="col" style="text-align: center;">
                                    Formation <p-sortIcon field="formation"></p-sortIcon>
                                </th>
                                <th pSortableColumn="rentree_scolaire" scope="col" style="text-align: center;">
                                    Rentrée scolaire <p-sortIcon field="rentree_scolaire"></p-sortIcon>
                                </th>-->
                                <th pSortableColumn="rythme_formation" scope="col" style="text-align: center;">
                                    Rythme <p-sortIcon field="rythme_formation"></p-sortIcon>
                                </th>
                                <!--<th pSortableColumn="programme" scope="col" style="text-align: center;">
                                    Anglais/Français <p-sortIcon field="programme"></p-sortIcon>
                                </th>-->
                                <th pSortableColumn="phase_candidature" scope="col" style="text-align: center;">
                                    Phase de Candidature <p-sortIcon field="phase_candidature"></p-sortIcon>
                                </th>

                                <th pSortableColumn="decision_admission" scope="col" style="text-align: center;">
                                    Decision Admission<p-sortIcon field="decision_admission"></p-sortIcon>
                                </th>
                                <th pSortableColumn="statut_payement" scope="col" style="text-align: center;">
                                    Paiement <p-sortIcon field="statut_payement"></p-sortIcon>
                                </th>
                                <!--<th pSortableColumn="statut_dossier" scope="col" style="text-align: center;">
                                    Etat de dossier<p-sortIcon field="statut_dossier"></p-sortIcon>
                                </th>
                                <th pSortableColumn="decision_orientation" scope="col" style="text-align: center;">
                                    Decision Orientation<p-sortIcon field="decision_orientation"></p-sortIcon>
                                </th>
                                
                                <th pSortableColumn="haveDoc" scope="col" style="text-align: center;">
                                    Dossier Lead <p-sortIcon field="haveDoc"></p-sortIcon>
                                </th>
                                
                                <th pSortableColumn="avancement_visa" scope="col" style="text-align: center;">
                                    Visa <p-sortIcon field="avancement_visa"></p-sortIcon>
                                </th>
                                
                                <th scope="col" style="text-align: center;">
                                    Etat de Candidature
                                </th>-->
                                <th pSortableColumn="date_creation" scope="col" style="text-align: center;">
                                    Date Inscr. <p-sortIcon field="date_creation"></p-sortIcon>
                                </th>
                                <th *ngIf="AccessLevel=='Super-Admin' || AccessLevel=='Admin'" pSortableColumn="action"
                                    scope="col" style="text-align: center;">
                                    Action
                                </th>
                            </tr>
                        </ng-template>
                        <ng-template pTemplate="body" let-prospect>
                            <tr>
                                <td>
                                    <p-tableCheckbox [value]="prospect"></p-tableCheckbox>
                                </td>
                                <td>
                                    <button type="button" pButton pRipple [pRowToggler]="prospect"
                                        class="p-button-text p-button-rounded p-button-plain" [icon]="
                                    expanded
                                        ? 'pi pi-chevron-down'
                                        : 'pi pi-chevron-right'"></button>

                                </td>


                                <td>
                                    {{ prospect.customid }}
                                </td>

                                <!--<td>
                                    {{ prospect.source }}
                                </td>-->

                                <td>
                                    {{ prospect?.user_id?.firstname | titlecase }}
                                    {{ prospect?.user_id?.lastname | uppercase }}
                                </td>
                                <!--<td>
                                    {{ prospect?.user_id?.pays_adresse }}
                                </td>-->
                                <td>
                                    {{ prospect.campus_choix_1 }},

                                    {{ prospect.formation | titlecase }},

                                    {{ prospect.rentree_scolaire }},
                                </td>
                                <td>
                                    {{ prospect.rythme_formation }}
                                </td>
                                <td>
                                    {{ prospect.phase_candidature }}
                                </td>
                                <td>
                                    {{ (prospect.decision_admission)?prospect.decision_admission:"En attente detraitement" }}
                                </td>
                                <!--<td>
                                    {{ prospect.programme }}
                                </td>
                                <td>
                                    {{ prospect.statut_dossier }}
                                </td>

                                <td>
                                    {{ prospect.decision_orientation }}
                                </td>

                                <td *ngIf="prospect.haveDoc">
                                    <p-tag icon="pi pi-check" severity="success" [value]="'Oui'">
                                    </p-tag>
                                </td>
                                <td *ngIf="!prospect.haveDoc">
                                    <p-tag icon="pi pi-times" severity="danger" [value]="'Non'"></p-tag>
                                </td>-->
                                <td *ngIf="prospect.statut_payement">
                                    {{ prospect.statut_payement }}
                                </td>
                                <td *ngIf="!prospect.statut_payement">
                                    Non
                                </td>
                                <!--<td *ngIf="prospect.avancement_visa">
                                    Oui
                                </td>
                                <td *ngIf="!prospect.avancement_visa">
                                    Non
                                </td>

                                <td *ngIf="candidatureDic[prospect._id]">
                                    <p-tag icon="pi pi-check" severity="success" [value]="'Oui'">
                                    </p-tag>
                                </td>
                                <td *ngIf="!candidatureDic[prospect._id]">
                                    <p-tag icon="pi pi-times" severity="danger" [value]="'En attente'"></p-tag>
                                </td>-->
                                <td>
                                    {{prospect.date_creation | date :'dd MMMM yy' }}
                                </td>
                                <td *ngIf="AccessLevel=='Super-Admin' || AccessLevel=='Admin'">
                                    <i pTooltip="Affecter le lead" tooltipPosition="bottom" class="pi pi-search mr-2"
                                        (click)="initAffectation(prospect);scrollToTop()" aria-hidden="true"></i>
                                    <i pTooltip="Details" tooltipPosition="bottom" class="pi pi-user-edit mr-2"
                                        (click)="initDetails(prospect);scrollToTop()" aria-hidden="true"></i>
                                    <i pTooltip="Supprimer le Lead" tooltipPosition="bottom" class="pi pi-trash mr-2"
                                        aria-hidden="true" (click)="delete(prospect)"> </i>
                                    <i pTooltip="Envoyer un mail" tooltipPosition="bottom" class="pi pi-envelope mr-2"
                                        aria-hidden="true" (click)="initSendEmail(prospect);scrollToTop()"> </i>
                                    <i pTooltip="Voir l'historique des modifications" tooltipPosition="bottom"
                                        class="pi pi-align-center mr-2" (click)="initHistorique(prospect);scrollToTop()"
                                        aria-hidden="true"></i>
                                    <i pTooltip="Voir la candidature" tooltipPosition="bottom"
                                        class="pi pi-briefcase mr-2" (click)="goToCandidature(prospect._id)"
                                        aria-hidden="true"></i>
                                    <i pTooltip="Suivre l'avancement" tooltipPosition="bottom"
                                        class="pi pi-chart-line mr-2" (click)="onShowTimeline(prospect)"
                                        aria-hidden="true"></i>
                                </td>
                            </tr>
                        </ng-template>
                        <ng-template pTemplate="rowexpansion" let-selectedProspect>
                            <tr>
                                <td colspan="11">
                                    <h5 style="color: rgb(48, 121, 230);font-weight: bold;">
                                        Informations Lead
                                    </h5>
                                    <p-table responsiveLayout="scroll">
                                        <ng-template pTemplate="header">
                            <tr>

                                <th>Civilité</th>
                                <th>Prénom et Nom </th>
                                <th>Date de naissance</th>
                                <th>Nationalité</th>
                                <th>Pays de résidence</th>
                                <th>Adresse électronique</th>
                                <th>Numéro de téléphone</th>


                            </tr>
                        </ng-template>
                        <ng-template pTemplate="emptymessage">
                            <tr>
                                <td>{{selectedProspect?.user_id?.civilite }}</td>
                                <td>
                                    {{ selectedProspect.user_id.firstname | titlecase }}
                                    {{ selectedProspect.user_id.lastname | uppercase }}
                                </td>
                                <td>
                                    {{
                                    selectedProspect.date_naissance| date:'dd MMMM yy'
                                    }}
                                </td>
                                <td>{{ selectedProspect?.user_id?.nationnalite }}</td>
                                <td>
                                    {{ selectedProspect?.user_id?.pays_adresse }}
                                </td>

                                <td>{{ selectedProspect?.user_id?.email_perso }}</td>
                                <td>{{ selectedProspect?.user_id?.indicatif }} {{ selectedProspect?.user_id?.phone }}
                                </td>
                            </tr>

                        </ng-template>

                    </p-table>
                    <h5 style="color: rgb(48, 121, 230);font-weight: bold;">
                        Compétences et expériences
                    </h5>
                    <p-table responsiveLayout="scroll">
                        <ng-template pTemplate="header">
                            <tr>
                                <th>Niveau en Français</th>
                                <th>Niveau en Anglais</th>
                                <th>Expériences professionnelles</th>
                                <th>Description de l’expérience</th>

                            </tr>
                        </ng-template>
                        <ng-template pTemplate="emptymessage">
                            <tr>
                                <td>{{ selectedProspect?.languages_fr }}</td>
                                <td>
                                    {{ selectedProspect?.languages_en }}
                                </td>
                                <td>
                                    {{ selectedProspect.professional_experience?'Oui':'Non' }}
                                </td>
                                <td>{{ selectedProspect?.professional_experience }}
                                </td>
                            </tr>


                        </ng-template>

                    </p-table>
                    <h5 style="color: rgb(48, 121, 230);font-weight: bold;">
                        Choix académique
                    </h5>
                    <p-table responsiveLayout="scroll">
                        <ng-template pTemplate="header">
                            <tr>
                                <th>Rentrée scolaire</th>
                                <th>Campus</th>
                                <th>Formation</th>
                                <th>Programme</th>
                                <th>Rythme</th>

                            </tr>
                        </ng-template>
                        <ng-template pTemplate="emptymessage">
                            <tr>
                                <td>{{ selectedProspect?.rentree_scolaire }}</td>
                                <td>
                                    {{ selectedProspect?.campus_choix_1}}
                                </td>
                                <td>
                                    {{ selectedProspect?.formation }}
                                </td>
                                <td>
                                    {{ selectedProspect?.programme }}
                                </td>
                                <td>
                                    {{ selectedProspect?.rythme_formation }}
                                </td>

                            </tr>


                        </ng-template>

                    </p-table>
                    <h5 style="color: rgb(48, 121, 230);font-weight: bold;">
                        Source
                    </h5>
                    <p-table responsiveLayout="scroll">
                        <ng-template pTemplate="header">
                            <tr>
                                <th>Source</th>
                                <th>Commercial </th>
                                <th>Adresse mail</th>

                            </tr>
                        </ng-template>
                        <ng-template pTemplate="emptymessage">
                            <tr>
                                <td>{{ selectedProspect?.source }}</td>
                                <td>
                                    {{infoCommercial?.user_id?.lastname}}
                                    {{infoCommercial?.user_id?.firstname}}
                                </td>
                                <td>
                                    {{infoCommercial?.user_id?.email_perso}}

                                </td>
                            </tr>


                        </ng-template>

                    </p-table>
                    <h5 style="color: rgb(48, 121, 230);font-weight: bold;">
                        Démarches 
                    </h5>
                    <p-table responsiveLayout="scroll">
                        <ng-template pTemplate="header">
                            <tr>
                                <th>Date d’inscription</th>
                                <th>Date de contact </th>
                                <th>Phase de la candidature</th>
                                <th>Montant payé</th>
                                <th>Visa</th>

                            </tr>
                        </ng-template>
                        <ng-template pTemplate="emptymessage">
                            <tr>
                                <td>{{ selectedProspect?.date_creation | date :'dd MMMM yy'}}</td>
                                <td>
                                    {{ selectedProspect?.contact_date| date :'dd MMMM yy' }}
                                </td>
                                <td>{{ selectedProspect?.phase_candidature }}
                                </td>
                                <td>{{ selectedProspect?.statut_payement }}
                                </td>


                                <td>{{ selectedProspect?.avancement_visa }}</td>

                            </tr>


                        </ng-template>

                    </p-table>


                    </td>
                    </tr>
                    </ng-template>

                    </p-table>
                </div>
            </p-tabPanel>
        </p-tabView>

    </div>
    <div class="col-12 card" *ngIf="ecoleList.length==0">
        <h5>Chargement en cours des données...</h5>
        <p-skeleton width="100%" height="100vh"></p-skeleton>
    </div>
    <!-- Expand SideBar -->
    <p-sidebar [(visible)]="displayFilter" styleClass="w-30rem" position="right" (onHide)="selectedProspect=null">
        <p-dropdown filter="true" placeholder="Pays" [options]="filterPays"[style]="{'width':'100%'}"
            (onChange)="dt1.filter($event.value, 'user_id.pays_adresse','equals');Fpays=$event.value"
            emptyFilterMessage="Pas de pays trouvé" filterPlaceholder="Pays" >
        </p-dropdown><br><br>


        <p-dropdown placeholder="Initiale/Alternance" [options]="filterRythmeFormation"[style]="{'width':'100%'}"
            (onChange)="dt1.filter($event.value, 'rythme_formation','equals');Frythme=$event.value"
            >
        </p-dropdown><br><br>
        <p-dropdown filter="true" placeholder="Anglais/Français" [options]="filterProgramme"[style]="{'width':'100%'}"
            (onChange)="dt1.filter($event.value, 'programme','equals');Flangue=$event.value"
            emptyFilterMessage="Pas de programme trouvé" filterPlaceholder="Programme" >
        </p-dropdown><br><br>
        <p-dropdown filter="true" placeholder="Dossier Lead" [options]="filterStatut"[style]="{'width':'100%'}"
            (onChange)="dt1.filter($event.value, 'haveDoc','equals');Fstatus=$event.value"
            emptyFilterMessage="Pas de statut trouvé" filterPlaceholder="Statut du dossier"
            >
        </p-dropdown><br><br>
        <p-dropdown filter="true" placeholder="Source" [options]="filterSource"[style]="{'width':'100%'}"
            (onChange)="dt1.filter($event.value, 'source','startsWith');Fsource=$event.value"
            emptyFilterMessage="Pas de source trouvé" filterPlaceholder="Source"
            >
        </p-dropdown><br><br>


        <p-dropdown filter="true" placeholder="Decision Orientation" [options]="dropdownDecisionOrientation"[style]="{'width':'100%'}"
            (onChange)="dt1.filter($event.value, 'decision_orientation','equals');Forientation=$event.value"
            emptyFilterMessage="Pas de decision trouvé" filterPlaceholder="Decision Orientation"
            >
        </p-dropdown><br><br>
        <p-dropdown filter="true" placeholder="Decision Admission" [options]="dropdownDecisionAdmission"[style]="{'width':'100%'}"
            (onChange)="dt1.filter($event.value, 'decision_admission','equals');FDadmission=$event.value"
            emptyFilterMessage="Pas de decision trouvé" filterPlaceholder="Decision Admission"
            >
        </p-dropdown><br><br>
        <p-dropdown filter="true" placeholder="Paiement" [options]="filterPaiement"[style]="{'width':'100%'}"
            (onChange)="dt1.filter($event.value, 'statut_payement','equals');FSPayement=$event.value"
            emptyFilterMessage="Pas de paiement trouvé" filterPlaceholder="Paiement" >
        </p-dropdown><br><br>
        <p-dropdown filter="true" placeholder="Visa" [options]="filterVisa"[style]="{'width':'100%'}"
            (onChange)="dt1.filter($event.value, 'avancement_visa','equals');FSvisa=$event.value"
            emptyFilterMessage="Pas de statut trouvé" filterPlaceholder="Statut du visa"
            >
        </p-dropdown><br><br>
        <p-dropdown filter="true" placeholder="Phase de la candidature" [options]="filterPhase"
        [style]="{'width':'100%'}"
            (onChange)="dt1.filter($event.value, 'phase_candidature','equals');FphaseC=$event.value"
            emptyFilterMessage="Pas de phase trouvé" filterPlaceholder="Phase de la candidature">
        </p-dropdown><br><br><br>



    </p-sidebar>
</div>
<p-dialog header="Suivre l'avancement" [(visible)]="showTimeline" [style]="{width: '75vw'}">
    <p-timeline [value]="dataTimeline">
        <ng-template pTemplate="content" let-event>
            <small class="p-text-secondary">{{event.date| date:'medium'}}</small>
        </ng-template>
        <ng-template pTemplate="opposite" let-event>
            <p *ngIf="event.date" style="font-weight: bold;">{{event.status }}</p>
            <p *ngIf="!event.date" style="color: gray; text-decoration-line: line-through;">{{event.status }}</p>
        </ng-template>
    </p-timeline>
</p-dialog>
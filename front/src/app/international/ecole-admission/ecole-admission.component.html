<div class="grid">
    <div class="col-12 grid" *ngIf="selectedEcole">
        <div class="card col-12">
            <h4 style="text-align: center">
                Modifier les informations de {{ selectedEcole.titre }}
            </h4>
            <div style="text-align: center">
                <small style="text-align: center; font-size: 12px">Tous les champs marqués d'un astérix
                    <span style="color: red"> * </span> sont obligatoires</small>
            </div>

            <i class="pi pi-times-circle" style="
                    float: right;
                    font-size: 20px;
                    color: red;
                    cursor: pointer;
                " (click)="selectedEcole = null; updateForm.reset()" aria-hidden="true"></i>

            <form class="p-fluid p-formgrid grid" [formGroup]="updateForm" (ngSubmit)="onUpdate()">
                <div class="field col-8">
                    <label>Nom de l'école
                        <span style="color: red"> * </span></label>
                    <input pInputText type="text" placeholder="ESTYA" formControlName="titre" />
                </div>
                <div class="field col-4">
                    <label>Params URL <span style="color: red"> * </span></label>
                    <input pInputText type="text" placeholder="estya" formControlName="url_form" />
                </div>
                <div class="field col-12">
                    <label>Adresse </label>
                    <textarea pInputTextarea placeholder="20 Rue du Président 14000 Caen"
                        formControlName="adresse"></textarea>
                </div>

                <div class="field col-6">
                    <label>Adresse mail de contact</label>
                    <input pInputText type="text" placeholder="contact@ecole.com" formControlName="email" />
                </div>
                <div class="field col-6">
                    <label>Site Web </label>
                    <input pInputText type="text" placeholder="https://ims.intedgroup.com/#/"
                        formControlName="site_web" />
                </div>

                <div class="field col-6">
                    <label>Langue du Formulaire </label>
                    <p-selectButton formControlName="langue" [options]="langueList"></p-selectButton>
                </div>
                <div class="field col-6">
                    <label>Campus </label>
                    <p-multiSelect formControlName="campus" [options]="campusList"
                        placeholder="Choissisez les campus"></p-multiSelect>
                </div>
                <div class="field col-6">
                    <label>NDA
                        <span style="color: red"> * </span></label>
                    <input pInputText type="NDA" placeholder="NDA" formControlName="NDA" />
                </div>
                <div class="field col-6">
                    <label>UAI
                        <span style="color: red"> * </span></label>
                    <input pInputText type="UAI" placeholder="UAI" formControlName="UAI" />
                </div>


                <div>
                    <button pButton label="Valider" type="submit" [disabled]="updateForm.invalid"></button>
                </div>
            </form>
        </div>
    </div>

    <div class="col-12 grid" *ngIf="addForm">
        <div class="card col-12">
            <h4 style="text-align: center">Ajout d'une nouvelle école</h4>
            <div style="text-align: center">
                <small style="text-align: center; font-size: 12px">Tous les champs marqués d'un astérix
                    <span style="color: red"> * </span> sont obligatoires</small>
            </div>

            <i class="pi pi-times-circle" style="
                    float: right;
                    font-size: 20px;
                    color: red;
                    cursor: pointer;
                " (click)="addForm = false; createForm.reset()" aria-hidden="true"></i>

            <form class="p-fluid p-formgrid grid" [formGroup]="createForm" (ngSubmit)="onCreate()">
                <div class="field col-8">
                    <label>Nom de l'école
                        <span style="color: red"> * </span></label>
                    <input pInputText type="text" placeholder="ESTYA" formControlName="titre" />
                </div>
                <div class="field col-4">
                    <label>Params URL <span style="color: red"> * </span></label>
                    <input pInputText type="text" placeholder="estya" formControlName="url_form" />
                </div>
                <div class="field col-12">
                    <label>Adresse </label>
                    <textarea pInputTextarea placeholder="20 Rue du Président 14000 Caen"
                        formControlName="adresse"></textarea>
                </div>

                <div class="field col-6">
                    <label>Adresse mail de contact</label>
                    <input pInputText type="text" placeholder="contact@ecole.com" formControlName="email" />
                </div>
                <div class="field col-6">
                    <label>Site Web </label>
                    <input pInputText type="text" placeholder="https://ims.intedgroup.com/#/"
                        formControlName="site_web" />
                </div>
                <div class="field col-6">
                    <label>Campus </label>
                    <p-multiSelect formControlName="campus" [options]="campusList"
                        placeholder="Choissisez les campus"></p-multiSelect>
                </div>
                <div class="field col-6">
                    <label>NDA
                        <span style="color: red"> * </span></label>
                    <input pInputText type="NDA" placeholder="NDA" formControlName="NDA" />
                </div>
                <div class="field col-6">
                    <label>UAI
                        <span style="color: red"> * </span></label>
                    <input pInputText type="UAI" placeholder="UAI" formControlName="UAI" />
                </div>
                <div class="field col-6">
                    <label>Langue du Formulaire </label>
                    <p-selectButton formControlName="langue" [options]="langueList"></p-selectButton>
                </div>
                <div>
                    <button pButton label="Valider" type="submit" [disabled]="createForm.invalid"></button>
                </div>
            </form>
        </div>
    </div>

    <div class="col-12 grid" *ngIf="affectedFormations">
        <div class="card col-12">
            <h4 style="text-align: center">
                Attribuer les formations à {{ affectedFormations.titre }}
            </h4>
            <div style="text-align: center">
                <small style="text-align: center; font-size: 12px">Tous les champs marqués d'un astérix
                    <span style="color: red"> * </span> sont obligatoires</small>
            </div>

            <i class="pi pi-times-circle" style="
                    float: right;
                    font-size: 20px;
                    color: red;
                    cursor: pointer;
                " (click)="affectedEcole = null; affectedForm.reset()" aria-hidden="true"></i>

            <form class="p-fluid p-formgrid grid" [formGroup]="affectedForm" (ngSubmit)="onAffect()">
                <div class="field col-12">
                    <label>Formations <span style="color: red"> * </span></label>
                    <p-multiSelect [options]="formationsList" optionLabel="nom" filter="true"
                        formControlName="formations"></p-multiSelect>
                </div>
                <div>
                    <button pButton label="Valider" type="submit" [disabled]="affectedForm.invalid"></button>
                </div>
            </form>
        </div>
    </div>
    <!-- Listing des équipes -->
    <div class="col-12">
        <div class="card">
            <div style="float: right" *ngIf="seeAction">
                <button style="margin-left: 2px" pButton icon="pi pi-plus-circle" label="Crée une école"
                    (click)="initCreate()"></button>
            </div>
            <h5 *ngIf="seeAction">Liste des écoles</h5>
            <p-toast></p-toast>
            <p-table #dt1 [value]="ecoles" dataKey="_id" responsiveLayout="scroll"
                [globalFilterFields]="['titre', 'email', 'adresse', 'site_web']" [rows]="5" [pageLinks]="5"
                [paginator]="true" rowExpandMode="single" [totalRecords]="ecoles.length"
                styleClass="p-datatable-gridlines">
                <ng-template pTemplate="caption">
                    <input pInputText type="text" #filter (input)="
                dt1.filterGlobal($event.target.value, 'contains')
            " placeholder="Recherche" />
                    <p-dropdown filter="true" [options]="campusFilter"
                        (onChange)="dt1.filter($event.value, 'campus','contains')"
                        emptyFilterMessage="Pas de campus trouvé" filterPlaceholder="Campus"
                        [style]="{'margin':'5px'}"></p-dropdown>
                </ng-template>
                <ng-template pTemplate="header">
                    <tr>
                        <th>

                        </th>
                        <th pSortableColumn="titre">
                            Ecole<p-sortIcon field="titre">
                            </p-sortIcon>
                        </th>

                        <th pSortableColumn="campus">
                            Campus<p-sortIcon field="campus"> </p-sortIcon>
                        </th>

                        <th pSortableColumn="email">
                            Email<p-sortIcon field="email">
                            </p-sortIcon>
                        </th>
                        <th pSortableColumn="site_web">
                            Site internet<p-sortIcon field="site_web"> </p-sortIcon>
                        </th>
                        <th pSortableColumn="NDA">
                            NDA<p-sortIcon field="NDA"> </p-sortIcon>
                        </th>
                        
                        <th *ngIf="seeAction">Action</th>
                    </tr>
                </ng-template>
                <ng-template pTemplate="body" let-ecole>
                    <tr>
                        <td>
                            <button type="button" pButton pRipple [pRowToggler]="ecole"
                                class="p-button-text p-button-rounded p-button-plain" [icon]="
                            dt1.isRowExpanded(ecole)
                                ? 'pi pi-chevron-down'
                                : 'pi pi-chevron-right'
                        "></button>
                        </td>
                        <td>
                            {{ ecole.titre }}
                        </td>
                        <td>
                            {{ ecole.campus }}
                        </td>

                        <td>
                            {{ ecole.email }}
                        </td>

                        <td>
                            {{ ecole.site_web }}
                        </td>
                        <td>
                            {{ecole?.NDA}}
                        </td>
                       
                        <td *ngIf="seeAction">

                            <i style="cursor: pointer; color: rgb(22, 225, 22)" class="pi pi-list m-1"
                                (click)="initFormations(ecole); scrollToTop()" pTooltip="Attribuer les formations"
                                aria-hidden="true" tooltipPosition="bottom"></i>
                            <i style="color: #3b82f6; cursor: pointer" class="pi pi-pencil m-1"
                                (click)="initUpdate(ecole); scrollToTop()" pTooltip="Modifier l'école"
                                aria-hidden="true" tooltipPosition="bottom"></i>
                            <i class="pi pi-trash m-1" pTooltip="Supprimer" (click)="onDeleteEcole(ecole._id)"
                                style="cursor: pointer; color: #ef4444"></i>
                        </td>
                    </tr>
                    <tr *ngIf="dt1.isRowExpanded(ecole)">
                        <td colspan="9">
                            <div class="col-12">
                                <h5 style="color: rgb(48, 121, 230); font-weight: bold;">Etablissement</h5>
            <p-table responsiveLayout="scroll" styleClass="p-datatable-gridlines" >
                                    <ng-template pTemplate="header">
                    <tr>
                        <th>Campus</th>
                        <th>Adresse</th>
                        <th>UAI</th>
                    </tr>
                </ng-template>
                <ng-template pTemplate="body" let-formation>
                </ng-template>
                <ng-template pTemplate="emptymessage">
                    <tr >
                        <td>{{ ecole?.campus }}</td>
                        <td>{{ ecole?.adresse }}</td>
                        
                        <td>{{ ecole?.UAI }}</td>
                    </tr>
                </ng-template>
            </p-table>
            <h5 *ngIf="ecole.formations.length != 0" style="color: rgb(48, 121, 230); font-weight: bold;">Listes des
                formations</h5>
            <ul>
                <li *ngFor="let f of ecole.formations">{{ f?.nom }}</li>
            </ul>
        </div>
        </td>
        </tr>
        </ng-template>
        </p-table>

    </div>
</div>
</div>

<p-sidebar [(visible)]="showSideBar" styleClass="w-30rem" position="right" (onHide)="selectedEcoleDetails=null">


</p-sidebar>
<div class="grid">
    <div class="col-12" *ngIf="showAddFactureMensuel">
        <div class="card">
            <i class="pi pi-times-circle" style="float:right; font-size: 20px; color: red;"
                (click)="showAddFactureMensuel = false;" aria-hidden="true">
            </i>
            <h3 class="text-center" style="font-weight: bold;">
                Ajout d'une Facture Mensuel
            </h3>
            <p style="text-align: center; font-size: 12px;">Tous les champs marqués d'un astérix <span
                    style="color: red;"> * </span> sont obligatoires</p>

            <form class="p-fluid p-formgrid grid" [formGroup]="formAddFactureMensuel"
                (ngSubmit)="onAddFactureMensuel()">
                <div class="field col-12 md:col-6">
                    <label For="contrat">Formateur<span style="color: red;"> * </span></label>
                    <p-dropdown [options]="formateurList" filter="true" formControlName="formateur_id"
                        (onChange)="calculMensuel()" placeholder="Choissisez un formateur">
                    </p-dropdown>
                </div>
                <div class="field col-12 md:col-6">
                    <label For="contrat">Mois<span style="color: red;"> * </span></label>
                    <p-dropdown [options]="dropdownMonth" filter="true" formControlName="mois"
                        (onChange)="calculMensuel()" placeholder="Choissisez le mois">
                    </p-dropdown>
                </div>
                <!--<div class="field col-3">
                    <label For="contrat">Facture<span style="color: red;"> * </span></label>
                    <p-fileUpload #fileUpload1 mode="basic" chooseLabel="Télécharger la Facture" maxFileSize="10000000"
                        [auto]="true" (uploadHandler)="FileUploadMensuel($event.files,fileUpload1)"
                        [customUpload]="true"></p-fileUpload>
                </div>
                <div class="field col-3">
                    <label>&nbsp;</label>
                    {{formAddFactureMensuel.value.file?.name}}
                </div>-->
                <div class="field col-12">
                    <p-accordion *ngIf="formAddFactureMensuel.value.mois && formAddFactureMensuel.value.formateur_id">
                        <p-accordionTab header="Séance du mois de {{convert[formAddFactureMensuel.value.mois]}}">
                            <p-table [value]="seances">
                                <ng-template pTemplate="header">
                                    <tr>
                                        <th pSortableColumn="libelle" style="text-align: center;">
                                            Libelle
                                            <p-sortIcon field="libelle"></p-sortIcon>
                                        </th>

                                        <th pSortableColumn="classe_id" style="text-align: center;">
                                            Groupe
                                            <p-sortIcon field="classe_id"> </p-sortIcon>
                                        </th>
                                        <th pSortableColumn="matiere_id.nom" style="text-align: center;">
                                            Module
                                            <p-sortIcon field="matiere_id.nom"> </p-sortIcon>
                                        </th>
                                        <th pSortableColumn="date_debut">
                                            Date<p-sortIcon field="date_debut"></p-sortIcon>
                                        </th>
                                        <th pSortableColumn="presence">
                                            Présence<p-sortIcon field="presence"></p-sortIcon>
                                        </th>
                                        <th pSortableColumn="presence">
                                            Coût
                                        </th>
                                    </tr>
                                </ng-template>
                                <ng-template pTemplate="body" let-data>
                                    <tr>
                                        <td>
                                            {{data.libelle}}
                                        </td>
                                        <td>
                                            {{data.classes}}
                                        </td>
                                        <td>
                                            {{data.matiere}}
                                        </td>
                                        <td>
                                            {{data.date_debut | date : 'dd/MM/yyyy'}}
                                            {{data.matin}}
                                        </td>
                                        <td>
                                            {{data.presence}}
                                        </td>
                                        <td>
                                            {{data.calcul}}*{{formateurDic[formAddFactureMensuel.value.formateur_id]?.taux_h}}={{data.calcul*formateurDic[formAddFactureMensuel.value.formateur_id]?.taux_h}}
                                        </td>
                                    </tr>
                                </ng-template>
                            </p-table>
                        </p-accordionTab>
                    </p-accordion>
                </div>
                <div>
                    <button pButton label="Ajouter la Facture Mensuel" type="submit"
                        [disabled]="formAddFactureMensuel.invalid"></button>
                </div>
            </form>
        </div>
    </div>
    <div class="col-12">
        <div class="card">
            <div style="float: right;">
                <button pButton icon="pi pi-plus" label="Ajouter une Facture du mois"
                    (click)="showAddFactureMensuel=true"></button>
            </div>
            <h5>Liste des factures mensuel des formateurs</h5>
            <p-table #dt2
                [globalFilterFields]="['formateur_id.user_id.lastname','formateur_id.user_id.firstanme','seance_id.libelle']"
                [totalRecords]="facturesMensuel.length" [pageLinks]="5" [paginator]="true" rowExpandMode="single"
                [rows]="10" styleClass="p-datatable-gridlines" [value]="facturesMensuel" dataKey="_id"
                responsiveLayout="scroll">
                <ng-template pTemplate="caption">
                    <div class="flex justify-content-between flex-column sm:flex-row">
                        <span class="p-input-icon-left mb-2">
                            <i class="pi pi-search"></i>
                            <input pInputText type="text" #filter
                                (input)="dt2.filterGlobal($event.target.value, 'contains')" placeholder="Recherche"
                                class="w-full" />
                        </span>
                    </div>
                </ng-template>
                <ng-template pTemplate="header">
                    <tr>
                        <th pSortableColumn="formateur_id.lastname" style="text-align: center;">
                            Formateur
                            <p-sortIcon field="formateur_id.lastname"></p-sortIcon>
                        </th>

                        <th pSortableColumn="mois" style="text-align: center;">
                            Mois
                            <p-sortIcon field="mois"> </p-sortIcon>
                        </th>
                        <th pSortableColumn="date_creation" style="text-align: center;">
                            Date d'Upload
                            <p-sortIcon field="date_creation"> </p-sortIcon>
                        </th>
                        <th style="text-align: center;">Action</th>
                    </tr>
                </ng-template>
                <ng-template pTemplate="body" let-facture>
                    <tr *ngIf="facture.formateur_id">
                        <td>
                            {{facture.formateur_id.lastname | uppercase}}
                            {{facture.formateur_id.firstname | titlecase}}
                        </td>
                        <td>
                            {{convert[facture.mois]}}
                        </td>
                        <td>
                            {{facture.date_creation | date : 'dd/MM/yyyy à hh:mm'}}
                        </td>
                        <td>
                            <i (click)="downloadFactureMensuel(facture)" class="pi pi-upload" aria-hidden="true"
                                pTooltip="Télécharger la facture">
                            </i>
                        </td>
                    </tr>
                </ng-template>
            </p-table>
        </div>
    </div>
</div>
<div class="grid" *ngIf="presence==null || presence.justificatif">
    <div class="col-10 col-offset-1 card shadow-lg">
        <h3 *ngIf="seance">Signature de la séance: {{seance.libelle}} du {{seance.date_debut | date : "dd/MM"}}</h3>
        <div class="col-12" *ngIf="showCanvas">
            <i class="pi pi-times" style="font-size: 20px;" (click)="clearCanvas()" aria-hidden="true" pTooltip="Effacer la signature" tooltipPosition="bottom"></i><br>
            <canvas class="card" #canva></canvas><br>
            <button pButton class="ui-button-raised ui-button-success" label="Envoyer"
                (click)="getSignature();"></button>
        </div>
        <div class="p-grid"  *ngIf="!showCanvas && presence==null">
            <h4>Fournir un justificatif d'absence</h4>
            <div class="col-12">
                <div class="md:col-offset-5">
                    <p-fileUpload #justificatif (uploadHandler)="onFileChange($event)" mode="basic"
                        chooseLabel="Joindre un fichier" customUpload="true" fileLimit="1" accept=".pdf,.jpg,.png,.jpeg"
                        maxFileSize="20000000" [auto]="true" >
                    </p-fileUpload>
                </div>
                <i *ngIf="uploadFile" class="pi pi-spin pi-spinner col-2" style="font-size: 2rem"
                    aria-hidden="true"></i><br>
                <button [disabled]="justif_file_value==null || justif_file_value>20000000 || uploadFile" pButton
                    class="ui-button-raised ui-button-success col-12 md:col-6 md:col-offset-3" label="Envoyer"
                    (click)="sendJustif();"></button>
            </div>
        </div>
        <div *ngIf="presence && presence.justificatif">
            <i *ngIf="loadingFile" class="pi pi-spin pi-spinner" style="font-size: 2rem" aria-hidden="true"></i>
            <button pButton [disabled]="loadingFile" class="ui-button-raised ui-button-success"
                label="Télécharger votre justificatif" (click)="downloadFile(presence);"></button>
        </div>
    </div>
</div>
<div class="grid" *ngIf="presence && seance">
    <div class="col-10 col-offset-1 card shadow-lg"
        [ngStyle]="{'background-color': presence.isPresent ? 'white' : 'tomato'}">
        <h3 *ngIf="seance">Signature de la séance: {{seance.libelle}} du {{seance.date_debut | date : "dd/MM"}}</h3>
        <div *ngIf="!presence.isPresent">
            <p>Vous avez été noté absent lors de cette séance</p>
            <p *ngIf="presence.justificatif && presence.isPresent">Votre justificatif a été accepté</p>
        </div>
        <div *ngIf="presence.isPresent">
            <p>Vous avez été noté présent lors de cette séance</p>
        </div>
    </div>
</div>
<div class="grid">
    <p-fieldset class="col-12" *ngIf="seance" legend="{{seance.libelle}}">
        <div class="p-fluid grid" style="color: black;font-weight:normal;">
            <div class="col-12 md:col-6 grid"
                *ngIf="userList && userList[seance.formateur_id] && dataRole.type!='Formateur'">
                <div class="col-6 md:col-6">
                    <strong style="text-align:left !important;">Formateur :</strong>
                </div>
                <div class="col-6 md:col-6" style="text-align:left !important;">
                    <span style="color: black;">
                        {{userList[seance.formateur_id].lastname | uppercase}} {{userList[seance.formateur_id].firstname
                        | titlecase}}
                    </span>
                </div>
            </div>
            <div class="col-12 md:col-6 grid" *ngIf="seance.classe_id && diplomeList">
                <div class="col-6 md:col-6">
                    <strong style="text-align:left !important;">Diplome :</strong>
                </div>
                <div class="col-6 md:col-6" style="text-align:left !important;">
                    {{affichageDiplome}}
                </div>
            </div>
            <div class="col-12 md:col-6 grid" *ngIf="classeList && seance.classe_id">
                <div class="col-6 md:col-6">
                    <strong style="text-align:left !important;">Groupe :</strong>
                </div>
                <div class="col-6 md:col-6" style="text-align:left !important;">
                    <span style="color: black;" *ngFor="let cid of seance.classe_id; let index = index">
                        <span *ngIf="classeList[cid] && classeList[cid].nom && index==0">{{classeList[cid].nom}}</span>
                        <span
                            *ngIf="classeList[cid] && classeList[cid].nom && index!=0">,<br>{{classeList[cid].nom}}</span>
                    </span>
                </div>
            </div>
            <div class="col-12 md:col-6 grid" *ngIf="matiereList && matiereList[seance.matiere_id]">
                <div class="col-6 md:col-6">
                    <strong style="text-align:left !important;">Matière :</strong>
                </div>
                <div class="col-6 md:col-6" style="text-align:left !important;">
                    <span style="color: black;">
                        {{matiereList[seance.matiere_id].nom}}
                    </span>
                </div>
            </div>
            <div class="col-12 md:col-6 grid">
                <div class="col-6 md:col-6">
                    <strong style="text-align:left !important;">Numéro de Salle :</strong>
                </div>
                <div *ngIf="seance.isPresentiel" class="col-6 md:col-6" style="text-align:left !important;">
                    <span style="color: black;">
                        {{seance.salle_name}}
                    </span>
                </div>
                <div *ngIf="!seance.isPresentiel" class="col-6 md:col-6" style="text-align:left !important;">
                    <span style="color: black;">
                        Distanciel
                    </span>
                </div>
            </div>
            <div class="col-12 md:col-6 grid" *ngIf="seance.date_debut && seance.date_fin">
                <div class="col-6 md:col-6">
                    <strong style="text-align:left !important;">Date :</strong>
                </div>
                <div class="col-6 md:col-6" style="text-align:left !important;">
                    <span style="color: black;">
                        {{seance.date_debut | date:'dd/MM HH:mm'}} - {{seance.date_fin | date:'dd/MM HH:mm'}}
                    </span>
                </div>
            </div>
        </div>
    </p-fieldset>
</div>

<div class="col-12" *ngIf="token.role!='user'">

    <div class="card">
        <button *ngIf="token.role!='user'" pButton class="ui-button-raised ui-button-success" label="Export en PDF"
            style="float:right;" (click)="getPDF();"></button>
        <h3 *ngIf="seance">Liste des présence de la séance: {{seance.libelle}} du {{seance.date_debut | date : "dd/MM"}}
        </h3>
        <div class="col-12 card shadow-lg my-5 ">
            <p-table #dt1 *ngIf="presences" [columns]="cols" [value]="presences" rowExpandMode="single" [rows]="10"
                [paginator]="true" [pageLinks]="5" [responsive]="true" [totalRecords]="presences.length">
                <ng-template pTemplate="header" let-columns>
                    <tr>
                        <th pSortableColumn="user_id" scope="col">
                            Nom <p-sortIcon field="user_id"></p-sortIcon>
                        </th>
                        <th pSortableColumn="user_id" scope="col">
                            Prénom <p-sortIcon field="user_id"></p-sortIcon>
                        </th>
                        <th pSortableColumn="isPresent" scope="col">
                            Présent <p-sortIcon field="isPresent"></p-sortIcon>
                        </th>
                        <th pSortableColumn="date_signature" scope="col">
                            Date de présence <p-sortIcon field="date_signature"></p-sortIcon>
                        </th>
                        <th scope="col">
                            Action
                        </th>
                    </tr>
                </ng-template>
                <ng-template pTemplate="body" let-rowData let-columns="columns">
                    <tr class="bandeau-show">
                        <td *ngIf="userList[rowData.user_id]">
                            {{userList[rowData.user_id].lastname}}
                        </td>
                        <td *ngIf="userList[rowData.user_id]">
                            {{userList[rowData.user_id].firstname}}
                        </td>
                        <td>
                            {{(rowData.isPresent)?"Oui":"Non"}}
                        </td>
                        <td *ngIf="seance" [style]="colorDate(rowData)">
                            {{rowData.date_signature| date:'dd/MM/yyyy HH:mm'}}
                        </td>
                        <td>
                            <i *ngIf="rowData.justificatif" pTooltip="Télécharger la justification"
                                tooltipPosition="bottom" class="pi pi-download" (click)="downloadFile(rowData)"
                                aria-hidden="true"></i>
                            <i *ngIf="!rowData.isPresent" pTooltip="Marquer comme présent" tooltipPosition="bottom"
                                class="pi pi-check" (click)="acceptJustif(rowData)" aria-hidden="true"></i>
                        </td>
                    </tr>
                </ng-template>
            </p-table>
        </div>
    </div>
</div>
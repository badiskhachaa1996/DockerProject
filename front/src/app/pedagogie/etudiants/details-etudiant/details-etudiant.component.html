<p-toast></p-toast>
<div class="grid">
    <div class="grid card col-12 ">
        <div class=" col-12 md:col-6 ">
            Details assiduité {{Etudiant_userdata?.civilite}} {{Etudiant_userdata?.firstname }}
            {{Etudiant_userdata?.lastname
            }}
            <p-chart #chart type="bar" [data]="barDataAJ" [options]="barOptions" width="full-vw" height="40vh">
            </p-chart>
        </div>
        <p-divider class="col-1" layout="vertical"></p-divider>
        <div class=" col-12 md:col-5">
            <p-chart #chart2 type="pie" [data]="barDataHorAJ" [options]="horizontalOptions" width="full-vw"
                height="40vh">
            </p-chart>

        </div>
        <div class="col-12" *ngIf="pourcentageAssiduite<80">

            <span>Taux d'assiduité : </span>
            <p-progressBar class="customProgress" [value]="pourcentageAssiduite">
            </p-progressBar>
        </div>
        <div class="col-11 sd:col-11 " *ngIf="pourcentageAssiduite>=80">
            <span>Taux d'assiduité : </span>
            <p-progressBar class="customProgress2" [value]="pourcentageAssiduite">
            </p-progressBar>
        </div>
        <div class="col-1 sd:col-1 text-align:center" *ngIf="pourcentageAssiduite>=80">
            <button pButton label="" icon="pi pi-file"
                style="width:50px ;height:2px;margin-top: 14px;" class="p-button-success"
                pTooltip="Telecharger Attestation d'assiduité" tooltipPosition="bottom" aria-hidden="true"
                [loading]="PDFisLoading"></button>

        </div>

    </div>
    <div class="card col-12">
        <p-toast></p-toast>
        <p-table #dt1 [value]="AssiduiteListe" dataKey="_id" responsiveLayout="scroll" [globalFilterFields]="[]"
            [rows]="10" [pageLinks]="5" [paginator]="true" [totalRecords]="AssiduiteListe?.length">
            <ng-template pTemplate="caption">
                <div class="grid p-fluid">
                    <div class="col-5 ">
                        <h4>Listes des seances</h4>
                    </div>
                    <div class="col-3 sd:col-1">
                    </div>
                    <div class="p-inputgroup col-2 sd:col:6">
                        <p-calendar [(ngModel)]="RangeDateForPDF" showIcon=true view="month"
                            onClickOutside="console.log(RangeDateForPDF)" selectionMode="range" dateFormat="mm/yy">
                        </p-calendar>

                    </div>
                    <div class="p-inputgroup col-2 sd:col-6">
                        <p-button label="Fiche de présence" pTooltip="Telecharger Fiche de présence"
                            tooltipPosition="bottom"
                            (click)="getAssiduitePDF(EtudiantDetail.user_id, RangeDateForPDF);load()" aria-hidden="true"
                            [loading]="PDFisLoading" [disabled]="!RangeDateForPDF"></p-button>
                    </div>


                </div>
            </ng-template>
            <ng-template pTemplate="header">
                <tr>
                    <th>Module </th>

                    <th pSortableColumn="_id">Date de la seance <p-sortIcon field="_id"></p-sortIcon>
                    </th>
                    <th pSortableColumn="seance_id">Seance<p-sortIcon field="seance_id">
                        </p-sortIcon>
                    </th>
                    <th>Présent/Absent</th>
                    <th>Heure d'arrivé</th>
                    <th>Justificatif </th>


                    <th>Action </th>
                </tr>
            </ng-template>
            <ng-template pTemplate="body" let-Assiduit>
                <tr>
                    <td>{{matiereDic[Assiduit.seance_id.matiere_id]?.abbrv}}</td>

                    <td>
                        {{ Assiduit.seance_id.date_debut | date : "dd/MM/yyyy hh:mm:ss"}} </td>
                    <td> {{ Assiduit.seance_id.libelle}}</td>

                    <td *ngIf="Assiduit.isPresent">
                        <p-tag class="p-tag-icon" icon="pi pi-plus" severity="success" value="Present"
                            icon="pi pi-check"></p-tag>
                    </td>
                    <td *ngIf="!Assiduit.isPresent">
                        <p-tag class="p-tag-icon" *ngIf="!Assiduit.justificatif" severity="danger" value="Absent"
                            icon="pi pi-exclamation-circle"></p-tag>
                        <p-tag class="p-tag-icon" *ngIf="Assiduit.justificatif" severity="warning" value="Absent"
                            icon="pi pi-exclamation-circle"></p-tag>
                    </td>

                    <td>{{ (Assiduit.date_signature) ? (Assiduit.date_signature | date : "hh:mm:ss":'locale' ) :'--' }}
                    </td>
                    <td *ngIf="Assiduit.isPresent">--</td>
                    <td *ngIf="!Assiduit.isPresent && Assiduit.justificatif">
                        <p-tag value="Justifié" icon="pi pi-check" class="p-tag-icon" severity="success"></p-tag>
                    </td>
                    <td *ngIf="!Assiduit.isPresent && !Assiduit.justificatif">
                        <p-tag class="p-tag-icon" value="Non Justifié" icon="pi pi-exclamation-circle"
                            severity="danger"></p-tag>
                    </td>
                    <td>

                        <i *ngIf="Assiduit.justificatif" pTooltip="Voir le justificatif" tooltipPosition="bottom"
                            class="pi pi-file" style="margin-left: 2%;" (click)="VoirJustificatif(Assiduit._id)"
                            aria-hidden="true"></i>
                    </td>
                </tr>
            </ng-template>

        </p-table>
    </div>

</div>
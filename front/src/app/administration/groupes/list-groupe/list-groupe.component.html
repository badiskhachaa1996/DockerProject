<p-toast></p-toast>
<div class="grid">
	<!-- Formulaire de modification du groupe -->
	<div class="col-12" *ngIf="showFormUpdateClasse">
        <div class="card">
			<i class="pi pi-times-circle" style="float:right; font-size: 20px; color: red; cursor: pointer;" (click)="showFormUpdateClasse = null; formUpdateClasse.reset()"> </i>
            <h4 style="text-align: center;">Modifier un groupe</h4>
            <form class="p-fluid p-formgrid grid" [formGroup]="formUpdateClasse" (ngSubmit)="modifyClasse()">
                <div class="field col-12">
                    <label For="libelle">Diplôme</label>
                    <p-dropdown [options]="dropdownDiplome" optionLabel="libelle" formControlName="diplome_id" (onChange)="chooseDiplome($event.value,'Add')"></p-dropdown>

                </div>
                <div class="field col-12 md:col-6">
                    <label For="nom_groupe">Nom du groupe</label>
                    <input pInputText id="nom_groupe" placeholder="Nom du groupe" type="text" formControlName="libelle" />

                    <div *ngIf="libelle_m.invalid && (libelle_m.touched || libelle_m.dirty)">
						<span *ngIf="libelle_m.errors?.pattern" style="color: red;">
							Le nom du groupe n'est pas dans le bon format
						</span>
					</div>
                </div>
                <div class="field col-12 md:col-6">
                    <label For="abreviation">Abréviation</label>
                    <input pInputText id="abreviation" type="text" formControlName="abbrv" placeholder="MCI A" />
                </div>
                <div style="justify-content: right;">
                    <button pButton label="Modifier" type="submit" [disabled]="formUpdateClasse.invalid"></button>
                </div>
            </form>
        </div>
    </div>

    <div class="col-12">
		<div class="card">
			<div style="float: right;">
				<button pButton icon="pi pi-plus" label="Ajouter" (click)="onRedirect();"></button>
			</div>
			<h5>Liste des groupes</h5>
			<p-table #dt1 *ngIf="classes" [value]="classes" rowExpandMode="single"
                     dataKey="_id" [rows]="10" 
                     [rowHover]="true" [totalRecords]="classes.length"
                     [paginator]="true" [pageLinks]="5"
                     [globalFilterFields]="['nom']"
                     responsiveLayout="scroll" styleClass="p-datatable-gridlines">

				<ng-template pTemplate="caption">
					<div class="flex justify-content-between flex-column sm:flex-row">
						<span class="p-input-icon-left mb-2">
							<i class="pi pi-search"></i>
							<input pInputText type="text" #filter (input)="dt1.filterGlobal($event.target.value, 'contains')" placeholder="Recherche" class="w-full"/>
						</span>
					</div>
				</ng-template>
				<ng-template pTemplate="header">
					<tr>
						<th pSortableColumn="nom_groupe" style="text-align: center;"> Nom du groupe <p-sortIcon field="nom_groupe"></p-sortIcon></th>
						<th pSortableColumn="diplome" style="text-align: center;"> Diplôme <p-sortIcon field="diplome"></p-sortIcon></th>    
						<th pSortableColumn="abreviation" style="text-align: center;"> Abréviation <p-sortIcon field="diplome"></p-sortIcon></th>
                        <th pSortableColumn="nb_etudiant" > Nombres d'étudiants <p-sortIcon field="nb_etudiant"></p-sortIcon></th>
                        <th>
							<div class="flex justify-content-between align-items-center">
								Action
							</div>
                        </th>
					</tr>    
				</ng-template>
				<ng-template pTemplate="body" let-rowData>
					<tr>
						<td style="min-width: 12rem;">
							{{rowData.nom}}
						</td>
						<td style="min-width: 12rem;">
							{{ diplomes[rowData.diplome_id]?.titre }}
						</td>
						<td style="min-width: 14rem;">
							{{ rowData.abbrv }}
						</td>
						<td *ngIf='numberClasse[rowData._id]'>
                            {{ numberClasse[rowData._id] }}
                        </td>
                        <td *ngIf='!numberClasse[rowData._id]'>
                            0
                        </td>
						<td style="min-width: 10rem;">
							<i aria-hidden="true" pTooltip="Modifier" tooltipPosition="bottom" class="pi pi-pencil"
                                (click)="idClasseToUpdate = rowData._id; onGetById(); showFormUpdateClasse = true; showFormAddClasse = false; diplomeToUpdate = diplomes[rowData.diplome_id]?.titre;"></i>
                            <i class="pi pi-calendar" aria-hidden="true" (click)="showCalendar(rowData)"
                                pTooltip="Voir le calendrier du groupe"></i>
                            <i class="pi pi-calendar" aria-hidden="true" (click)="sendCalendar(rowData)"
                                pTooltip="Envoyer le calendrier au groupe"></i>
                            <i class="pi pi-file" pTooltip="Lister les notes de la classe" (click)="sendNotes(rowData)" aria-hidden="true"></i>
						</td>
					</tr>
				</ng-template>
    		</p-table>
		</div>

	</div>
</div>

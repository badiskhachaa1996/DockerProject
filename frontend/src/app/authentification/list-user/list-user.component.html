<div *ngIf="showFormAdd">

    <app-register></app-register>

</div>

<div *ngIf="showFormModify">
    <app-upduser></app-upduser>
</div>

<div class="grid">
    <div class="col-10 col-offset-1">
        <button pButton type="button" label="Ajouter" style="float:right;" (click)="showFormAdd=true"
            *ngIf="!showFormAdd"> </button>
        <h3>Liste des agents</h3>
        <div class="card card-w-title table col-12  shadow-lg my-5">

            <p-table #dt1 
            *ngIf="tabUser" 
            [columns]="cols" 
            [value]="tabUser" 
            dataKey="email"
            [rows]="4" 
            [paginator]="true" 
            [pageLinks]="5" 
            [responsive]="true" 
            [totalRecords]="tabUser.length"
            rowExpandMode="single"
            (sortFunction)="customSort($event)" [customSort]="true"
            [globalFilterFields]="['firstname','lastname','email','phone','Adresse']">

                <ng-template pTemplate="caption">
                    <div class="p-d-flex" >
                        <div class="p-input-icon-left p-ml-auto" style="display: flex;">
                            <p-dropdown [options]="filterRole"
                        (onChange)="dt1.filter($event.value, 'role', 'equals')"></p-dropdown>
                        <span style="margin-left: 2%;">
                        <p-dropdown filter="true" placeholder="Tous" [options]="dropdownService"
                        (onChange)="dt1.filter($event.value, 'service_id', 'equals')"></p-dropdown></span>
                        <input style="margin-left:2%;" pInputText type="text"
                                (input)="dt1.filterGlobal($event.target.value, 'contains')" placeholder="Recherche" />
                        </div>
                    </div>
                </ng-template>


                <ng-template pTemplate="header" let-columns>
                    <th style="width: 3rem"></th>
                    <th style="text-decoration: underline;" pSortableColumn="lastname" > Nom & Prénom <p-sortIcon field="lastname"></p-sortIcon>
                        
                    </th>
                    <th style="text-decoration: underline;"pSortableColumn="service">  Service <p-sortIcon field="service"></p-sortIcon>
                        
                        
                    </th>
                    <th style="text-decoration: underline;" pSortableColumn="role">  Role <p-sortIcon field="role"></p-sortIcon>
                        
                    </th>
                    <th style="text-decoration: underline;" pSortableColumn="email">  Email <p-sortIcon field="email"></p-sortIcon>
                       
                    </th>
                    <th>
                        Action
                    </th>
                </ng-template>

                <ng-template pTemplate="body" let-rowData let-columns="columns" let-expanded="expanded">
                    <tr [pSelectableRow]="rowData" class="bodytab">
                        <td>
                            <button type="button" pButton [pRowToggler]="rowData" class="expanded"
                                [icon]="expanded ? 'pi pi-chevron-down' : 'pi pi-chevron-right'"
                                ></button>
                        </td>
                        <td *ngIf="rowData.civilite">
                            {{rowData.civilite | i18nSelect: genderMap}} {{rowData.lastname | titlecase}} {{rowData.firstname | titlecase}}
                        </td>
                        <td *ngIf="rowData.service_id && serviceDic[rowData.service_id]!=undefined">
                            {{ serviceDic[rowData.service_id].label }}
                        </td>
                        <td *ngIf="!rowData.service_id || serviceDic[rowData.service_id]==undefined">
                            Sans Service
                        </td>
                        <td>
                            {{rowData.role}}
                        </td>
                        <td>
                            {{rowData.email}}
                        </td>
                        <td>
                            <i pTooltip="Modifier" tooltipPosition="bottom" class="pi pi-user-edit" (click)="modify(rowData);"></i>
                        </td>
                    </tr>
                </ng-template>

                <ng-template pTemplate="rowexpansion" let-rowData>
                    <tr style="text-align: left; margin-left: 2em; background-color:white;">
                        <td [attr.colspan]="6">
                            <p-fieldset legend="Informations de l'agent"
                                [style]="{'color':'green','font-weight': 'bold'}">
                                <div class="p-grid ui-fluid" style="color: black;font-weight:normal;">
                                    <div *ngIf="rowData.phone" class="ui-g-6 ui-md-6">
                                        <div class="ui-g-6 ui-md-6"><b style="text-align:left !important;">Téléphone:</b>
                                        </div>
                                        <div class="ui-g-6 ui-md-6" style="text-align:left !important;">
                                            {{rowData.phone}} </div>
                                    </div>
                                    <div *ngIf="rowData.adresse" class="ui-g-6 ui-md-6">
                                        <div class="ui-g-6 ui-md-6"><b
                                                style="text-align:left !important;">Adresse:</b> </div>
                                        <div class="ui-g-6 ui-md-6" style="text-align:left !important;">
                                            {{rowData.adresse}}</div>
                                    </div>
                                </div>
                                <div class="ui-g-12 ui-md-12" *ngIf="rowData.type" style="color: black;font-weight:normal;">
                                    <div class="ui-g-6 ui-md-6"><b style="text-align:left !important;">Statut:</b>
                                    </div>
                                    <div class="ui-g-6 ui-md-6" style="text-align:left !important;">
                                        {{rowData.type}}</div>
                                </div>

                                <div class="ui-g-12 ui-md-12"
                                    *ngIf="rowData.type && (rowData.type=='Salarié' || rowData.type=='Alternant/Stagiaire') && rowData.entreprise" style="color: black;font-weight:normal;">
                                    <div class="ui-g-6 ui-md-6"><b
                                            style="text-align:left !important;">Entreprise:</b>
                                    </div>
                                    <div class="ui-g-6 ui-md-6" style="text-align:left !important;">
                                        {{rowData.entreprise}}
                                    </div>
                                </div>

                                <div class="ui-g-12 ui-md-12"
                                    *ngIf="rowData.type && (rowData.type=='Etudiant' || rowData.type=='Alternant/Stagiaire')" style="color: black;font-weight:normal;">
                                    <div *ngIf="rowData.campus" class="ui-g-12 ui-md-6">
                                        <div class="ui-g-6 ui-md-6" style="text-align:left !important;">
                                            <b style="text-align:left !important;">Campus:</b>
                                        </div>
                                        <div class="ui-g-6 ui-md-6" style="text-align:left !important;">
                                            {{rowData.campus}}</div>
                                    </div>
                                    <div *ngIf="rowData.formation" class="ui-g-12 ui-md-6">
                                        <div class="ui-g-6 ui-md-6" style="text-align:left !important;">
                                            <b style="text-align:left !important;">Classe :</b>
                                        </div>
                                        <div class="ui-g-6 ui-md-6" style="text-align:left !important;">
                                            {{formationDic[rowData.formation].nom_court}}</div>
                                    </div>
                                </div>
                            </p-fieldset>
                        </td>
                    </tr>
                </ng-template>
            </p-table>
        </div>
    </div>
</div>